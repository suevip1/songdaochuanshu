---
layout: post
title: "æè·³è·³ä½¿ç”¨ã€é€†å‘ã€è„±å£³å’ŒåŸç†ä»‹ç»"
date: "2023-09-08T00:56:25.330Z"
---
æè·³è·³ä½¿ç”¨ã€é€†å‘ã€è„±å£³å’ŒåŸç†ä»‹ç»
================

å‰è¨€
--

> ä½ å¯ä»¥ç‹¬å–„å…¶èº« ä½†ä½ ä¸èƒ½å…¼æµå¤©ä¸‹

ç®€ä»‹
--

å…¶å®è¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨æ•™ç¨‹ï¼Œgithubä¸Šé¢æœ‰å¤‡ä»½çš„ä¸‹è½½é“¾æ¥ï¼Œåªæ˜¯å¯èƒ½ä¸æ›´æ–°äº†ï¼ŒV2.2å®‰è£…ä¹‹å  
![100a1565ff1581ce70cfe9290ab015d.jpg](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035512065.png)  
ä¸€æŠŠå¿«åˆ€ï¼Œå¾ˆç®€æ´çš„ç•Œé¢  
![6105fa532260202636383961fc9538c.jpg](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035535940.png)  
ç‚¹å‡»ç•Œé¢é‡Œé¢çš„å¼€å¯æŒ‰é’®å³å¯ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯åœ¨æ— éšœç¢é‡Œé¢è®¾ç½®äº†  
![9c72d6b41ab06a6033cf82cb5815f15.jpg](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035544210.png)  
ç°åœ¨æ‰“å¼€æ·˜å®äº¬ä¸œä¹‹åå°±åªä¼šçœ‹åˆ°ä¸€é—ªè€Œè¿‡æˆ–è€…æ²¡æœ‰å¼€å±å¹¿å‘Šçš„æƒ…å†µäº†

åç¼–è¯‘
---

è½¬æˆjar  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035557597.png)  
ä»£ç å¦‚ä¸‹  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035561147.png)  
è§£å‹APKä¹‹åç›®å½•ä¸º  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035565194.png)  
è’½....è¿˜æœ‰libåº“å’Œkotlinæ–‡ä»¶ï¼Œæ€ä¹ˆè¿˜æœ‰JNIç¼–ç¨‹å•Š~  
resæ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶ç›´æ¥ä¹±æˆä¸€å †äº†ï¼Œåç¼–è¯‘é—®é¢˜  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035575219.png)  
è€ƒè™‘æ¢ä¸€ä¸ªå·¥å…·æ¥ä¿®å¤é™æ€æ–‡ä»¶ apktool  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035586594.png)  
ç„¶åå°±å¾—åˆ°äº†æ­£å¸¸çš„ resï¼Œç»ˆäºæ•´æ´äº†ä¸€ç‚¹orz  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035581360.png)  
æºä»£ç çš„è¯è¿˜æ˜¯çœ‹ä» jd-gui è§£æå‡ºæ¥çš„å§ å„éƒ¨åˆ†æ¯”è¾ƒå®Œæ•´  
ç»“æœå‘ç°è¿›è¡Œäº†åŠ å›ºï¼Œå…¶å®æˆ‘ä¹‹å‰æ˜¯æ²¡æœ‰è„±åŠ å›ºAPKçš„ç»éªŒçš„ï¼Œä¸ºå•¥å‘ç°äº†åŠ å›º æ˜¯å› ä¸ºæˆ‘æŠŠä»£ç æ”¾åˆ°è‡ªå·±çš„Androidå·¥ç¨‹ä¹‹åçœ‹äº†åŠå¤©æ²¡çœ‹æ‡‚ï¼Œæ„Ÿè§‰å°±æ˜¯å®ç°äº†ä¸€ä¸ªç±»åŠ è½½å™¨  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035597310.png)  
ä¸»å·¥ç¨‹ä»£ç å°±åªæ˜¯å»ç»§æ‰¿ WrapperProxyApplication æŠ½è±¡ç±»ï¼Œç»™æˆ‘æ•´ä¸ä¼šäº†ï¼Œæˆ‘ä»¥ä¸ºè¿™æ˜¯ä»€ä¹ˆé«˜ç«¯å†™æ³•  
ä¸»å·¥ç¨‹è¿˜åŸä¸º

    public class MyWrapperProxyApplication extends WrapperProxyApplication {
        protected void initProxyApplication(Context paramContext) {
            String str = (paramContext.getApplicationInfo()).sourceDir;
            ZipFile zipFile = null;
            try {
                ZipFile zipFile1 = new ZipFile(str);
                zipFile = zipFile1;
            } catch (IOException iOException) {
                iOException.printStackTrace();
            }
            if (zipFile == null) {
                Process.killProcess(Process.myPid());
                System.exit(0);
            }
            Util.PrepareSecurefiles(paramContext, zipFile);
            try {
                zipFile.close();
            } catch (IOException iOException) {
                iOException.printStackTrace();
            }
            System.loadLibrary(Util.libname);
        }
    
        public void onCreate() {
            super.onCreate();
        }
    }
    

ç„¶åæˆ‘è§‰å¾—è¿™ä¸ªç±»åŠ è½½å™¨å¯èƒ½æ˜¯ä¸€ä¸ªå…¬ç”¨åº“ ç»“æœå°±  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1035595203.png)  
åŸæ¥æ˜¯è…¾è®¯çš„ï¼Œè¿˜æ˜¯é€†å‘APKçš„ç»éªŒå¤ªå°‘äº†orz  
ä¸ºä»€ä¹ˆæè·³è·³è¦åŠ å£³ï¼Œåº”è¯¥ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢åº”ç”¨å•†åº—æˆ–è€…æ‰‹æœºå‚å•†é‚£æ‰¹äººé€šè¿‡ç‰¹å¾æ£€æµ‹åˆ°APKç„¶åæŠ¥æ¯’  
ä¸ºäº†é˜²æ­¢æˆ‘è‡ªå·±çœ‹é”™ ç”¨å·¥å…·æ£€æµ‹ä¸€ä¸‹ ç»“æœPKIDå±…ç„¶æ£€æµ‹ä¸å‡ºæ¥ï¼Œé¢  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036005456.png)  
æ‰“å¼€MTç®¡ç†å™¨  
![](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036008578.png)  
å¯ä»¥çœ‹åˆ°ç¡®å®è…¾è®¯å¾¡å®‰å…¨

åˆ¤æ–­åŠ å£³
----

æ‰‹åŠ¨åˆ¤æ–­æ˜¯è…¾è®¯å¾¡å®‰å…¨åŠ å£³çš„ç‰¹å¾æœ‰ä¸‰ç§æ–¹å¼

### step1

å°†APKè§£å‹ç¼©  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036015553.png)

### step2 ç‰¹å¾ä¸€

æ ¹ç›®å½•ä¸‹å­˜åœ¨ tencent\_stub æ–‡ä»¶  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036026560.png)

### step3 ç‰¹å¾äºŒ

assetsç›®å½•å­˜åœ¨

*   0OO00l111l1l
*   o0oooOO0ooOo.dat
*   t86
*   tosversion

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036025566.png)

### step4 ç‰¹å¾ä¸‰

libæ–‡ä»¶å¤¹ä¸‹å­˜åœ¨

*   libshell-super.2019.so
*   libshella-x.so (xä»£è¡¨ç‰ˆæœ¬)

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036031668.png)

MTè„±å£³
----

æŸ¥äº†ä¸€ä¸‹èµ„æ–™æ€ä¹ˆéƒ½éœ€è¦ç”¨MTç®¡ç†å™¨~  
MTç®¡ç†å™¨ä½¿ç”¨æ–‡æ¡£

> [https://mt2.cn/guide/](https://mt2.cn/guide/)

adb å®‰è£…åˆ°æµ‹è¯•æœºä¸Šé¢  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036036068.png)  
è¿è¡Œä¹‹  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036041212.png)  
æ¥ä¸‹æ¥å®‰è£…æè·³è·³  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036047962.png)  
åœ¨MTç®¡ç†å™¨é‡Œé¢å®‰è£…åŒ…æå–å¯»æ‰¾æè·³è·³  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036059822.png)  
å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯ä½¿ç”¨è…¾è®¯å¾¡å®‰å…¨è¿›è¡ŒåŠ å£³çš„  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036064219.png)  
ç‚¹å‡»dexé€‰æ‹©dex++  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036069692.png)  
æ‰¾åˆ°è¿™ä¸ªä¸œè¥¿  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036077889.png)  
å¤åˆ¶åŒ…å  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036071604.png)  
ç²˜è´´åˆ° AndroidManifest.xml é‡Œé¢ï¼Œä¿å­˜  
ç”¨blackdexè„±dexçš„å£³  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036087019.png)  
ç„¶ååˆ°MTç®¡ç†å™¨ ï¼Œå³è¾¹æ˜¯å·²è„±çš„  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036098114.png)  
åˆ é™¤å·¦è¾¹çš„classes.dexï¼ŒæŠŠå³è¾¹çš„ç§»è¿‡å»ï¼Œç„¶åä¿å­˜  
å·²ç»å®ç°äº†è„±å£³  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036094833.png)  
æœ€åå®‰è£…ä¸ä¸Š orz ï¼Œæµæ³ªäº†  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036102387.png)  
éš¾é“æ˜¯æˆ‘å·¥å…·ç”¨çš„æœ‰é—®é¢˜~

frida
-----

åªå¥½æå‡ºå¤§æ€å™¨ frida äº†

> fridaæ˜¯å¹³å°åŸç”Ÿappçš„Greasemonkeyï¼Œè¯´çš„ä¸“ä¸šä¸€ç‚¹ï¼Œå°±æ˜¯ä¸€ç§åŠ¨æ€æ’æ¡©å·¥å…·ï¼Œå¯ä»¥æ’å…¥ä¸€äº›ä»£ç åˆ°åŸç”Ÿappçš„å†…å­˜ç©ºé—´å»ï¼Œï¼ˆåŠ¨æ€åœ°ç›‘è§†å’Œä¿®æ”¹å…¶è¡Œä¸ºï¼‰ï¼Œè¿™äº›åŸç”Ÿå¹³å°å¯ä»¥æ˜¯Winã€Macã€Linuxã€Androidæˆ–è€…iOSã€‚è€Œä¸”fridaè¿˜æ˜¯å¼€æºçš„

Fridaå®˜ç½‘ï¼š[https://www.frida.re/](https://www.frida.re/)  
Fridaæºç ï¼š[https://github.com/frida](https://github.com/frida)

### å®‰è£…frida

#### windowså®‰è£…å®¢æˆ·ç«¯

> pip3 install frida

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036112995.png)

å®‰è£…frida-tools

> pip3 install frida-tools

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036118086.png)  
å®‰è£… frida-dexdump

> pip3 install frida-dexdump

å®‰è£…æˆåŠŸ

> frida --version

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036126065.png)

#### å®‰å“å®‰è£…fridaæœåŠ¡ç«¯

æŸ¥çœ‹Androidæ‰‹æœºçš„cpuæ¶æ„

> adb shell getprop ro.product.cpu.abi

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036129444.png)  
æ ¹æ®CPUç‰ˆæœ¬ä¸‹è½½å¯¹åº”çš„Frida server [https://github.com/frida/frida/releases](https://github.com/frida/frida/releases)  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036138237.png)  
ä¸‹è½½è§£å‹æ¨åˆ°æ‰‹æœºç›®å½•ä¸‹  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036148219.png)  
è®¾ç½®ç«¯å£è½¬å‘

> adb forward tcp:27042 tcp:27042  
> adb forward tcp:27043 tcp:27043

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036148219.png)  
è®¾ç½®æƒé™å¹¶è¿è¡Œ

> chmod 777 frida-server64  
> ./frida-server64

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036156576.png)  
å‡ºç°æŠ¥é”™

> ./frida-server64

æŸ¥çœ‹å½“å‰æ˜¯å¦å…³é—­äº†SELINUX

> getenforce

ç¡®å®å¼€ç€çš„  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036153708.png)

> setenforce 0

å…³é—­selinuxï¼Œè¿è¡Œfrida-server  
ç„¶åé‡æ–°æ‰“å¼€ä¸€ä¸ªshellæŸ¥çœ‹æ˜¯å¦å­˜åœ¨  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036167036.png)  
è¿è¡ŒæˆåŠŸ

### fridaå‡çº§

    pip3 install -U frida
    pip3 install -U frida-tools
    

### fridaè„±å£³

æ‰‹æœºä¸Šæ‰“å¼€éœ€è¦è„±å£³çš„è½¯ä»¶  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036165988.png)  
adb shellå¯åŠ¨frida-server  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036176348.png)  
å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·é…ç½®äº†python scriptçš„ç¯å¢ƒå˜é‡ï¼Œé‚£å°±å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œå¯åŠ¨frida-dexdump  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036185694.png)  
è¾“å…¥å‘½ä»¤ frida-dexdump -FUï¼Œå¦‚ä¸‹å›¾ï¼ˆå‚æ•°è¯´æ˜ï¼Œå‚æ•° U æ˜¯usbï¼Œå‚æ•° Fæ˜¯å‰å°æ´»åŠ¨appï¼‰  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036189447.png)  
å¾—åˆ°è„±å£³çš„dexæ–‡ä»¶  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036197667.png)  
æ£€æŸ¥ä¹‹åå‘ç°æ˜¯classes.dexä¸ºæºdexæ–‡ä»¶

### è¿˜åŸAPK

è„±å£³ä¹‹åå¯¹APKè¿›è¡Œè¿˜åŸ  
ç”¨baksmaliå·¥å…·ï¼ŒæŠŠdexè½¬æ¢æˆsmali

> java -jar baksmali.jar d classes.dex

![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036209375.png)  
ç”¨ apktool d ./com.xxx.mobile.apkï¼Œåç¼–è¯‘ï¼Œå¾—åˆ°åŠ å›ºçš„apkè§£å‹åŒ…  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036209750.png)  
æ›¿æ¢ smali æ–‡ä»¶å¤¹ï¼Œç”¨å‰é¢çš„ smali æ–‡ä»¶å¤¹æ›¿æ¢æ‰ è§£å‹åŒ…ä¸­çš„ smaliï¼Œæ›¿æ¢  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036217060.png)  
æ‰“å¼€åŸæ–‡ä»¶çš„dexï¼Œæ‰¾åˆ°com/wrapper/proxyapplication/WrapperProxyApplication  
è¿›å»å¤åˆ¶å…¥å£ååˆ°AndroidManifest.xmlä¸­æ›¿æ¢å…¥å£  
è¿™é‡Œæ˜¯åŸæœ¬çš„AndroidManifest.xml  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036214875.png)  
å…¥å£æˆ‘ç›´æ¥ç”¨MTç®¡ç†å™¨çœ‹å§  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036223505.png)  
æˆ‘ä»¬éœ€è¦æ›¿æ¢æˆ hello.litiaotiao.app.LttApp  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036237116.png)  
ç„¶ååˆ é™¤è…¾è®¯åŠ å›ºçš„ç›¸å…³æ–‡ä»¶ï¼Œä¸€èˆ¬åœ¨assetsã€libç›®å½•ä¸‹  
ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„é‚£äº›ç‰¹å¾

*   tencent\_stub
*   tosversion
*   0OO00l111l1l
*   o0oooOO0ooOo
*   æ–‡ä»¶åå¸¦æœ‰shellçš„

ç”¨ apktool b com.xxx.mobile ç¼–è¯‘apk  
æœ€åå°±æ˜¯ä½¿ç”¨AndroidKillerè¿›è¡Œé‡æ‰“åŒ…  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036249567.png)  
æ‰“åŒ…å®Œæˆè¿›è¡Œå®‰è£…å³å¯  
ç»“æœè¿˜æ˜¯å®‰è£…ä¸äº†  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036248787.png)  
èœæ˜¯åŸç½ª~

åŸç†
--

> åˆ©ç”¨å®‰å“ç³»ç»Ÿçš„**æ— éšœç¢**æƒé™ï¼Œå¸®åŠ©ç”¨æˆ·**è‡ªåŠ¨ç‚¹å‡»**å¹¿å‘Šä¸Šçš„**è·³è¿‡æŒ‰é’®**

å…³äºæ— éšœç¢æœåŠ¡

> AccessibilityServiceï¼ˆæ— éšœç¢æœåŠ¡ï¼‰æ˜¯ Android æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·å…·æœ‰è§†è§‰ã€å¬è§‰æˆ–è¿åŠ¨ä¸Šçš„éšœç¢æ›´è½»æ¾åœ°ä½¿ç”¨è®¾å¤‡ã€‚å®ƒæ˜¯ Android æä¾›çš„ä¸€ç§ç‰¹æ®ŠæœåŠ¡ï¼Œå¯ä»¥æ¥æ”¶è®¾å¤‡ä¸Šå‘ç”Ÿçš„å„ç§äº‹ä»¶ï¼Œå¹¶æä¾›è‡ªå®šä¹‰çš„åé¦ˆæˆ–å¤„ç†æ–¹å¼ã€‚
> 
> AccessibilityService å¯ä»¥åœ¨ç”¨æˆ·ç•Œé¢ä¸Šç›‘æ§å’Œæ“ä½œåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›é¢å¤–çš„è¾…åŠ©åŠŸèƒ½ã€‚å®ƒå¯ä»¥æ¥æ”¶ç³»ç»Ÿçº§åˆ«çš„äº‹ä»¶ï¼Œå¦‚æŒ‰é”®ã€è§¦æ‘¸ã€é€šçŸ¥ç­‰ï¼Œè¿˜å¯ä»¥è®¿é—®åº”ç”¨ç¨‹åºçš„è§†å›¾å±‚æ¬¡ç»“æ„ï¼Œä»¥ä¾¿åˆ†æå’Œæ“ä½œåº”ç”¨ç¨‹åºçš„ç•Œé¢å…ƒç´ 

æè·³è·³çš„å¹¿å‘Šè·³è¿‡åŒ…å«äº†ä¸¤ä¸ªéƒ¨åˆ†

*   å¼€å±å¹¿å‘Šè·³è¿‡
*   åº”ç”¨å†…å¼¹çª—è·³è¿‡

### å¼€å±å¹¿å‘Šè·³è¿‡

æœ‰ä¸€ä¸ªç®€å•çš„è§„åˆ™ ä¹Ÿå°±æ˜¯å­—ç¬¦ä¸² `è·³è¿‡`  
é€†å‘æè·³è·³çš„æºä»£ç æŸ¥çœ‹è§„åˆ™  
hashSeté‡Œé¢å­˜å‚¨äº†ä¸€äº›å…³é”®å­—  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036257505.png)  
å¦å¤–è¿˜æœ‰åœ¨æ–‡ä»¶å†…éƒ¨çš„ 2131755075 ä½ç½® ï¼Œè½¬æˆåå…­è¿›åˆ¶æ˜¯ 7F100043  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036267286.png)  
å¯ä»¥çœ‹å‡ºè¿™é‡Œçš„hashSeté‡Œé¢è£…çš„å°±æ˜¯å¼€å±è·³è¿‡çš„å…³é”®å­—  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036262390.png)  
ä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªæ˜¯ä»æ–‡ä»¶è¯»å–çš„ï¼Œè½¬æ¢ä¸€ä¸‹å¯ä»¥åœ¨public.xmlé‡Œé¢æ‰¾åˆ°  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036275113.png)  
åœ¨æè·³è·³æ˜é‡‘çš„ä¸»é¡µä¸­å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆ  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036282763.png)  
æ‰€ä»¥è¿™é‡Œæ˜¯ç”¨æˆ·è‡ªå·±å¯¼å…¥çš„è§„åˆ™ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æŠŠè¿™å‡ ä¸ªè·³è¿‡çš„å…³é”®å­—éƒ½åŠ åˆ°æˆ‘ä»¬çš„é€»è¾‘é‡Œé¢ï¼Œä»¥åé‡åˆ°äº†å…¶ä»–çš„å†å¤„ç†  
ç¿»ç¿»xmlæ–‡ä»¶é‡Œé¢è¿˜å‘ç°æœ‰ä¸€ä¸ªç™½åå•åˆ—è¡¨  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036282142.png)  
åº”è¯¥æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜è¿›è¡Œäº†ä¸€æ¬¡åŒ…ååˆ¤æ–­  
æ‰€ä»¥å¯¹äºå¼€å±å¹¿å‘Šçš„æ£€æµ‹æ ¸å¿ƒæ˜¯

    @Override
    public void onAccessibilityEvent(AccessibilityEvent accessibilityEvent) {
        onAccessibilityEventPre();
        AccessibilityNodeInfo source = accessibilityEvent.getSource();
        if (source == null)
            return;
    
        // åˆ¤æ–­æ˜¯å¦å¼€å¯äº†æ£€æµ‹
        if (!mMKV.decodeBool(SWITCHMAIN_KEY))
            return;
    
        CharSequence packageName = accessibilityEvent.getPackageName();
        if (packageName == null)
            return ;
        String currentPackageName = packageName.toString();
    
        // è¯»å–ç™½åå•æ•°ç»„
        String[] whiteListArray = getResources().getStringArray(R.array.whitelist);
        List<String> whiteList = Arrays.asList(whiteListArray);
    
        if (whiteList.contains(currentPackageName)) {
            return; // å¦‚æœæ˜¯ç™½åå•å†…çš„åŒ…åï¼Œåˆ™ä¸æ‰§è¡Œåç»­çš„æ£€æµ‹é€»è¾‘
        }
    
        for (int i = 0; i < source.getChildCount(); i++) {
            AccessibilityNodeInfo childNode = source.getChild(i);
            if (childNode.getText() == null) {
                continue;
            }
    
            String text = childNode.getText().toString();
    
            for (String keyword : keywords) {
                if (text.contains(keyword)) {
                    Log.i(TAG, "æ£€æµ‹åˆ°å¼€å±å¹¿å‘Šå…³é”®å­—ï¼š" + keyword);
                    childNode.performAction(AccessibilityNodeInfo.ACTION_CLICK);
                    Toast.makeText(this, SKIP_PROMPT, Toast.LENGTH_LONG).show();
                    break;
                }
            }
        }
    }
    

å¾€ AndroidManifestï¼ˆæ¸…å•æ–‡ä»¶ï¼‰ä¸Šé…ç½®ï¼š

    <service android:exported="false" android:label="â™¥å¼ å¾—ä¹–1.0" android:name="hello.beautifulz.app.ZdgService" android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE">
        <intent-filter>
            <action android:name="android.accessibilityservice.AccessibilityService"/>
        </intent-filter>
        <meta-data android:name="android.accessibilityservice" android:resource="@xml/accessibility_service_config"/>
    </service>
    

labelæ˜¯è¿™ä¸ªæ— éšœç¢æœåŠ¡çš„åç§°  
serviceconfig é…ç½®æ–‡ä»¶å¦‚ä¸‹

    <?xml version="1.0" encoding="utf-8"?>
    <accessibility-service android:description="@string/accessibility_service_description" android:settingsActivity="hello.beautifulz.app.MainActivity" android:accessibilityEventTypes="typeAllMask" android:accessibilityFeedbackType="feedbackGeneric" android:notificationTimeout="100" android:accessibilityFlags="flagDefault" android:canRetrieveWindowContent="true" android:canPerformGestures="true" android:isAccessibilityTool="true"
      xmlns:android="http://schemas.android.com/apk/res/android" />
    

### åº”ç”¨å†…å¼¹çª—è·³è¿‡

ç¬¬äºŒç§æ˜¯åº”ç”¨å†…çš„å¼¹çª—è§„åˆ™  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036295138.png)  
å…³äºè¿™ä¸€ç‚¹åœ¨ [https://github.com/Snoopy1866/LiTiaotiao-Custom-Rules](https://github.com/Snoopy1866/LiTiaotiao-Custom-Rules) ä¸Šé¢æœ‰ç›¸å…³è§„åˆ™  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036299888.png)  
è·³è¿‡åº”ç”¨å†…çš„å¼¹çª—éœ€è¦è‡ªå·±ç¼–å†™è§£æè§„åˆ™çš„æ¡†æ¶ï¼Œç±»ä¼¼äºä¸‹é¢è¿™ç§

    public class MyAccessibilityService extends AccessibilityService {
    
        @Override
        public void onAccessibilityEvent(AccessibilityEvent accessibilityEvent) {
            // è·å–å¼¹çª—å†…å®¹
            CharSequence popupContent = accessibilityEvent.getText();
            if (popupContent != null) {
                String popupText = popupContent.toString();
    
                // è°ƒç”¨è§„åˆ™åŒ¹é…å‡½æ•°
                boolean matched = checkPopupRules(popupText);
    
                if (matched) {
                    // æ‰§è¡Œå…³é—­å¼¹çª—çš„æ“ä½œï¼Œä¾‹å¦‚æ‰§è¡Œè¿”å›é”®åŠ¨ä½œ
                    performGlobalAction(GLOBAL_ACTION_BACK);
                }
            }
        }
    
        private boolean checkPopupRules(String popupText) {
            // å°†è§„åˆ™å­—ç¬¦ä¸²è§£æä¸ºè§„åˆ™å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ JSON æˆ–å…¶ä»–æ ¼å¼è¿›è¡Œè§£æ
            // è¿™é‡Œå‡è®¾è§„åˆ™å·²ç»è§£æä¸º Rule å¯¹è±¡
    
            Rule rule = new Rule("+æ£€æµ‹åˆ°&-ç”¨æˆ·ä½“éªŒ", "=ä»¥åå†è¯´");
    
            // è¿›è¡Œè§„åˆ™åŒ¹é…åˆ¤æ–­
            if (popupText.startsWith(rule.getKeywordStart()) &&
                popupText.endsWith(rule.getKeywordEnd())) {
                if (rule.getAction().equals("=ä»¥åå†è¯´")) {
                    return true;
                }
            }
    
            return false;
        }
    
        // å…¶ä»–å›è°ƒæ–¹æ³•...
    
    }
    

è¿™ä¸ªæš‚æ—¶ä½œä¸ºä¿ç•™èŠ‚ç›®å§~

åå°ä¿æ´»
----

APPçš„åå°ä¿æ´»æ˜¯ä¸€é—¨æ™ºæ…§~ä¸ºäº†è®©APPä¸€ç›´åœ¨åå°è¿è¡Œæ¥è·³è¿‡å¹¿å‘Šï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒä¸è¢«ç³»ç»Ÿæ€æ­»  
æ— éšœç¢æœåŠ¡æœ¬èº«æƒé™å°±å¾ˆå¤§ï¼Œå€ŸåŠ©æ— éšœç¢æœåŠ¡æˆ‘ä»¬æ¥å®ç°å¼ºåŠ›ä¿æ´»ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹å‘å…¥æ‰‹ï¼š

*   å‰å°æœåŠ¡ä¿æ´»
*   ç”³è¯·REQUEST\_IGNORE\_BATTERY\_OPTIMIZATIONS å¿½ç•¥ç”µæ± ä¼˜åŒ–å¼€å…³
*   å¼€å¯è‡ªå¯åŠ¨æ— éšœç¢æœåŠ¡

è¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´æ˜äº†

æ•ˆæœ
--

æœ€åå®ç°çš„å°demoå¯ä»¥è¯´æ˜¯æè·³è·³çš„é—ºèœœäº†  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036308921.png)  
æŠŠé‡Œé¢çš„å¾ˆå¤šåœ°æ–¹éƒ½è£å‰ªäº†ï¼Œåªç•™ä¸‹äº†å¼€å¯å¹¿å‘Šè·³è¿‡çš„æŒ‰é’®  
![image.png](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang//20230907_1036309791.png)  
è¿™ä¸ªæ—¶å€™å†æ‰“å¼€çŸ¥ä¹å°±å¯ä»¥çœ‹åˆ°æœ‰è·³è¿‡æ•ˆæœäº†

å‚è€ƒé“¾æ¥
----

*   [https://mp.weixin.qq.com/s/MvpIvmQtha0glvvcApZqsA](https://mp.weixin.qq.com/s/MvpIvmQtha0glvvcApZqsA)
*   [https://www.cnblogs.com/gezifeiyang/p/16229721.html](https://www.cnblogs.com/gezifeiyang/p/16229721.html)
*   [https://www.52pojie.cn/thread-1453091-1-1.html](https://www.52pojie.cn/thread-1453091-1-1.html)
*   [https://www.freebuf.com/articles/system/190565.html](https://www.freebuf.com/articles/system/190565.html)
*   [https://www.cnblogs.com/gezifeiyang/p/16207042.html](https://www.cnblogs.com/gezifeiyang/p/16207042.html)
*   [https://www.jianshu.com/p/c349471bdef7](https://www.jianshu.com/p/c349471bdef7)
*   [https://juejin.cn/post/6938590373740544007](https://juejin.cn/post/6938590373740544007)
*   [https://www.bilibili.com/read/cv12200073/](https://www.bilibili.com/read/cv12200073/)
*   [https://www.bilibili.com/read/cv11826368/](https://www.bilibili.com/read/cv11826368/)
*   è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„èµ„æ–™

END
---

å»ºäº†ä¸€ä¸ªå¾®ä¿¡çš„å®‰å…¨äº¤æµç¾¤ï¼Œæ¬¢è¿æ·»åŠ æˆ‘å¾®ä¿¡å¤‡æ³¨`è¿›ç¾¤`ï¼Œä¸€èµ·æ¥èŠå¤©å¹æ°´å“‡ï¼Œä»¥åŠä¸€ä¸ªä¼šå‘å¸ƒå®‰å…¨ç›¸å…³å†…å®¹çš„å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨ ğŸ˜ƒ

åŠ æˆ‘æ‹‰ä½ å…¥ç¾¤

é»‘ç³–å®‰å…¨å…¬ä¼—å·

![](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang/1a1f7894a170bec207e61bf86a01592.jpg)

![](https://springbird3.oss-cn-chengdu.aliyuncs.com/lianxiang/qrcode_for_gh_cead8e1080d6_430.jpg)