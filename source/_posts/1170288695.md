---
layout: post
title: "vue + canvas å®ç°æ¶‚é¸¦é¢æ¿"
date: "2023-08-04T01:08:51.666Z"
---
vue + canvas å®ç°æ¶‚é¸¦é¢æ¿
===================

![vue + canvas å®ç°æ¶‚é¸¦é¢æ¿](https://img2023.cnblogs.com/blog/2180164/202308/2180164-20230803193424259-2058100516.png) æˆ‘ä»¬åŸºäº canvas å®ç°äº†ä¸€æ¬¾ç®€å•çš„æ¶‚é¸¦é¢æ¿ï¼Œç”¨äºåœ¨ç½‘é¡µä¸Šè¿›è¡Œç»˜å›¾å’Œåˆ›ä½œã€‚æ­¤ç¯‡æ–‡ç« ç”¨äºè®°å½•æŸæˆä»é›¶å¼€å‘ä¸€ä¸ªcanvasæ¶‚é¸¦é¢æ¿çš„å†ç¨‹ã€‚

å‰è¨€
==

> ä¸“æ åˆ†äº«ï¼š[vue2æºç ä¸“æ ](https://juejin.cn/column/7205144461922435128)ï¼Œ[vue routeræºç ä¸“æ ](https://juejin.cn/column/7233620479470633017)ï¼Œ[ç©å…·é¡¹ç›®ä¸“æ ](https://juejin.cn/column/7239264646916735037)ï¼Œç¡¬æ ¸ ğŸ’ª æ¨è ğŸ™Œ  
> æ¬¢è¿å„ä½ ITer å…³æ³¨ç‚¹èµæ”¶è— ğŸŒ¸ğŸŒ¸ğŸŒ¸

æ­¤ç¯‡æ–‡ç« ç”¨äºè®°å½•æŸæˆä»é›¶å¼€å‘ä¸€ä¸ª`canvasæ¶‚é¸¦é¢æ¿`çš„å†ç¨‹ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š

![](https://img2023.cnblogs.com/blog/2180164/202307/2180164-20230731182151524-2006464198.gif)

ä»‹ç»
==

æˆ‘ä»¬åŸºäº canvas å®ç°äº†ä¸€æ¬¾ç®€å•çš„æ¶‚é¸¦é¢æ¿ï¼Œç”¨äºåœ¨ç½‘é¡µä¸Šè¿›è¡Œç»˜å›¾å’Œåˆ›ä½œã€‚å…¶æ”¯æŒä»¥ä¸‹å¿«æ·é”®ï¼š

**åŠŸèƒ½**

**å¿«æ·é”®**

æ’¤é”€

Ctrl + Z

æ¢å¤

Ctrl + Y

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `new Board` åˆ›å»ºä¸€ä¸ªç©ºç™½ç”»æ¿ï¼Œå…¶æ¥æ”¶ä¸€ä¸ªå®¹å™¨ä½œä¸ºå‚æ•°ï¼Œä¸‹é¢æ˜¯ä¸ªåŸºæœ¬ä¾‹å­ï¼š

    <template>
      <div class="drawing-board">
        <div id="container" ref="container" style="width: 100%; height: 100%"></div>
      </div>
    </template>
    
    <script setup>
      import { ref, onMounted } from 'vue'
      import Board from '@/canvas/board.js'
    
      const container = ref(null)
      onMounted(() => {
        // åˆ›å»ºä¸€ä¸ªç©ºç™½ç”»æ¿
        new Board(container.value)
      })
    </script>
    

åˆå§‹åŒ–
===

Board çš„å®ç°æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨ `src/canvas/board.js`ä¸­å®šä¹‰

`new Board(container)`æ—¶åšäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ª canvas ç”»å¸ƒè¿½åŠ åˆ°äº† container å®¹å™¨ä¸­ï¼Œå¹¶å®šä¹‰äº†ä¸€ç³»åˆ—å±æ€§ï¼Œæœ€åæ‰§è¡Œäº† init åˆå§‹åŒ–æ–¹æ³•

åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ç”»ç¬”æ ·å¼ï¼ˆå…¶å®å¯ä»¥åŠ¨æ€å»è®¾ç½®ï¼Œè®©ç”¨æˆ·é€‰æ‹©ç”»ç¬”é¢œè‰²ã€ç²—ç»†ã€çº¿æ¡æ ·å¼ç­‰ï¼Œæ—¶é—´æœ‰é™ï¼Œæœªå®ç°æ­¤åŠŸèƒ½ï¼‰ï¼›æ³¨å†Œç›‘å¬äº†é¼ æ ‡é”®ç›˜äº‹ä»¶ï¼Œç”¨äºç»˜åˆ¶ç”»ç¬”è½¨è¿¹å’Œå®ç°æ’¤é”€æ¢å¤å¿«æ·é”®æ“ä½œ

    export default class BoardCanvas {
      constructor(container) {
        // å®¹å™¨
        this.container = container
        // canvasç”»å¸ƒ
        this.canvas = this.createCanvas(container)
        // ç»˜åˆ¶å·¥å…·
        this.ctx = this.canvas.getContext('2d')
        // èµ·å§‹ç‚¹ä½ç½®
        this.startX = 0
        this.stateY = 0
        // ç”»å¸ƒå†å²æ ˆ
        this.pathSegmentHistory = []
        this.index = 0
    
        // åˆå§‹åŒ–
        this.init()
      }
      // åˆ›å»ºç”»å¸ƒ
      createCanvas(container) {
        const canvas = document.createElement('canvas')
        canvas.width = container.clientWidth
        canvas.height = container.clientHeight
        canvas.style.display = 'block'
        canvas.style.backgroundColor = 'antiquewhite'
        container.appendChild(canvas)
        return canvas
      }
    
      // åˆå§‹åŒ–
      init() {
        this.addPathSegment()
        this.setContext2DStyle()
        // é˜»æ­¢é»˜è®¤å³å‡»äº‹ä»¶
        this.canvas.addEventListener('contextmenu', (e) => e.preventDefault())
        // è‡ªå®šä¹‰é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
        this.canvas.addEventListener('mousedown', this.mousedownEvent.bind(this))
        // è‡ªå®šä¹‰é”®ç›˜æŒ‰ä¸‹äº‹ä»¶
        window.document.addEventListener('keydown', this.keydownEvent.bind(this))
      }
    
      // è®¾ç½®ç”»ç¬”æ ·å¼
      setContext2DStyle() {
        this.ctx.strokeStyle = '#EB7347'
        this.ctx.lineWidth = 3
        this.ctx.lineCap = 'round'
        this.ctx.lineJoin = 'round'
      }
    }
    

è‡ªå®šä¹‰é¼ æ ‡äº‹ä»¶
=======

æˆ‘ä»¬ä¹‹å‰åœ¨ init åˆå§‹åŒ–æ–¹æ³•ä¸­æ³¨å†Œäº† onmousedown é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œ**éœ€è¦åœ¨æ­¤å¤„å®ç°é¼ æ ‡æŒ‰ä¸‹æ‹–æ‹½å¯ä»¥ç»˜åˆ¶ç”»ç¬”è½¨è¿¹çš„é€»è¾‘**

    mousedownEvent(e) {
      const that = this
      const ctx = this.ctx
      ctx.beginPath()
      ctx.moveTo(e.offsetX, e.offsetY)
      ctx.stroke()
    
      this.canvas.onmousemove = function (e) {
        ctx.lineTo(e.offsetX, e.offsetY)
        ctx.stroke()
      }
      
      this.canvas.onmouseup = this.canvas.onmouseout = function () {
        that.addPathSegment()
        this.onmousemove = null
        this.onmouseup = null
        this.onmouseout = null
      }
    }
    

è‡ªå®šä¹‰é”®ç›˜äº‹ä»¶
=======

æˆ‘ä»¬ä¹‹å‰åœ¨ init åˆå§‹åŒ–æ–¹æ³•ä¸­æ³¨å†Œäº† onkeydown é”®ç›˜æŒ‰ä¸‹äº‹ä»¶ï¼Œ**éœ€è¦åœ¨æ­¤å¤„å®ç°æ’¤é”€æ¢å¤çš„é€»è¾‘**

    // é”®ç›˜äº‹ä»¶
    keydownEvent(e) {
      if (!e.ctrlKey) return
      switch (e.keyCode) {
        case 90:
          this.undo()
          break
        case 89:
          this.redo()
          break
      }
    }
    

è¦å®ç°æ’¤é”€æ¢å¤æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­˜å‚¨ç”»å¸ƒå¿«ç…§çš„æ ˆï¼è¿™åˆæ¶‰åŠåˆ°ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¦‚ä½•è·å–åˆ°å½“å‰ç”»å¸ƒå¿«ç…§ï¼Ÿå¦‚ä½•æ ¹æ®å¿«ç…§æ•°æ®æ¢å¤ç”»å¸ƒï¼Ÿ

æŸ¥é˜… [canvaså®˜æ–¹APIæ–‡æ¡£](https://www.canvasapi.cn/) å¾—çŸ¥ï¼Œè·å–å¿«ç…§ API ä¸º [getImageData](https://www.canvasapi.cn/CanvasRenderingContext2D/getImageData)ï¼›é€šè¿‡å¿«ç…§æ¢å¤ç”»å¸ƒçš„ API ä¸º [putImageData](https://www.canvasapi.cn/CanvasRenderingContext2D/putImageData)

    /*
     * @name è¿”å›ä¸€ä¸ª ImageData å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å« Canvas ç”»å¸ƒéƒ¨åˆ†æˆ–å®Œæ•´çš„åƒç´ ç‚¹ä¿¡æ¯
     * @param { Number } sx å°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„å·¦ä¸Šè§’ x åæ ‡
     * @param { Number } sy å°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„å·¦ä¸Šè§’ y åæ ‡
     * @param { Number } sWidth  å°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„å®½åº¦
     * @param { Number } sHeight å°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„é«˜åº¦
     * @return { Object } è¿”å›ä¸€ä¸ª ImageData å¯¹è±¡ï¼ŒåŒ…å« Canvas ç»™å®šçš„çŸ©å½¢å›¾åƒåƒç´ ç‚¹ä¿¡æ¯
     */
    context.getImageData(sx, sy, sWidth, sHeight);
     
     /*
     * @name å°†ç»™å®š ImageData å¯¹è±¡çš„æ•°æ®ç»˜åˆ¶åˆ°ä½å›¾ä¸Š
     * @param { Object } ImageData å¯¹è±¡ï¼ŒåŒ…å« Canvas ç»™å®šçš„çŸ©å½¢å›¾åƒåƒç´ ç‚¹ä¿¡æ¯
     * @param { Number } dx ç›®æ ‡ Canvas ä¸­è¢«å›¾åƒæ•°æ®æ›¿æ¢çš„èµ·ç‚¹æ¨ªåæ ‡
     * @param { Number } dy ç›®æ ‡ Canvas ä¸­è¢«å›¾åƒæ•°æ®æ›¿æ¢çš„èµ·ç‚¹çºµåæ ‡
     */
     context.putImageData(ImageData, dx, dy);
    

æˆ‘ä»¬å¯¹ä¿å­˜ç”»å¸ƒå¿«ç…§çš„é€»è¾‘è¿›è¡Œäº†ä¸€æ¬¡å°è£…ï¼Œå¦‚ä¸‹ï¼š

    // æ·»åŠ è·¯å¾„ç‰‡æ®µ
    addPathSegment() {
      const data = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height)
      
      // åˆ é™¤å½“å‰ç´¢å¼•åçš„è·¯å¾„ç‰‡æ®µï¼Œç„¶åè¿½åŠ ä¸€ä¸ªæ–°çš„è·¯å¾„ç‰‡æ®µï¼Œæ›´æ–°ç´¢å¼•
      this.pathSegmentHistory.splice(this.index + 1)
      this.pathSegmentHistory.push(data)
      this.index = this.pathSegmentHistory.length - 1
    }
    

æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰äº†ä¸€ä¸ªå­˜å‚¨ç”»å¸ƒå¿«ç…§çš„æ ˆ - pathSegmentHistoryï¼›ä¸€ä¸ªæŒ‡å‘æ ˆä¸­å½“å‰å¿«ç…§çš„ç´¢å¼• - index

åœ¨åˆå§‹åŒ–å’Œç»˜åˆ¶ä¸€ä¸ªè·¯å¾„ç‰‡æ®µç»“æŸæ—¶éƒ½ä¼šè°ƒç”¨ addPathSegment æ–¹æ³•ï¼Œç”¨äºä¿å­˜å½“å‰ç”»å¸ƒå¿«ç…§åˆ°æ ˆä¸­ï¼Œå¹¶å°†ç´¢å¼•æŒ‡å‘æ ˆä¸­çš„æœ€åä¸€ä¸ªæˆå‘˜

**Tipï¼šåœ¨ä¿å­˜å¿«ç…§æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šå…ˆåˆ é™¤æ ˆä¸­ä½äºç´¢å¼•ä¹‹åçš„å…¨éƒ¨å¿«ç…§æ•°æ®ï¼Œç›®çš„æ˜¯æ‰§è¡Œæ’¤é”€æ“ä½œåå†ç»˜åˆ¶è½¨è¿¹ï¼Œè¦æ¸…ç©ºæ ˆä¸­çš„å¤šä½™æ•°æ®ã€‚ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœæˆ‘ä»¬å…ˆæ‰§è¡Œ3æ¬¡undoï¼Œå†æ‰§è¡Œä¸€æ¬¡redoï¼Œæœ€åç»˜åˆ¶ä¸€æ¡æ–°çš„è½¨è¿¹ï¼Œåˆ™éœ€è¦å…ˆæ¸…é™¤æ ˆä¸­çš„æœ€åä¸¤æ¡å¿«ç…§æ•°æ®ï¼Œå†æ·»åŠ ä¸€æ¡æ–°çš„å½“å‰ç”»å¸ƒå¿«ç…§æ•°æ®ï¼Œç¤ºæ„å›¾å¦‚ä¸‹**

![](https://img2023.cnblogs.com/blog/2180164/202307/2180164-20230731182954658-865205155.png)

æ’¤é”€ï¼ˆundoï¼‰
--------

å½“æ‰§è¡Œ undo æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å…ˆå°†ç´¢å¼•å‰ç§»ï¼Œ ç„¶åå–å‡ºå½“å‰ç´¢å¼•æŒ‡å‘çš„å¿«ç…§æ•°æ®ï¼Œé‡æ–°ç»˜åˆ¶ç”»å¸ƒ

    // æ’¤é”€
    undo() {
      if (this.index <= 0) return
      this.index--
      this.ctx.putImageData(this.pathSegmentHistory[this.index], 0, 0)
    }
    

![](https://img2023.cnblogs.com/blog/2180164/202307/2180164-20230731182848257-780950968.svg)

æ¢å¤ï¼ˆredoï¼‰
--------

å½“æ‰§è¡Œ redo æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å…ˆå°†ç´¢å¼•åç§»ï¼Œ ç„¶åå–å‡ºå½“å‰ç´¢å¼•æŒ‡å‘çš„å¿«ç…§æ•°æ®ï¼Œé‡æ–°ç»˜åˆ¶ç”»å¸ƒ

    // æ¢å¤
    redo() {
      if (this.index >= this.pathSegmentHistory.length - 1) return
      this.index++
      this.ctx.putImageData(this.pathSegmentHistory[this.index], 0, 0)
    }
    
    

![](https://img2023.cnblogs.com/blog/2180164/202307/2180164-20230731182859013-321365334.svg)

æºç 
==

æ¶‚é¸¦é¢æ¿demoä»£ç ï¼š[vue-canvas](https://gitee.com/lbcjs/vue-canvas)

äººé—´ä¸æ­£ç»ç”Ÿæ´»æ‰‹å†Œ