---
layout: post
title: "ä¸€æ–‡è§£é”vue3ä¸­hooksçš„ä½¿ç”¨å§¿åŠ¿"
date: "2023-09-06T00:56:46.551Z"
---
ä¸€æ–‡è§£é”vue3ä¸­hooksçš„ä½¿ç”¨å§¿åŠ¿
===================

vue3 ä¸­çš„ hooks æ˜¯ä»€ä¹ˆ?
------------------

ç®€å•æ¥è¯´å¦‚æœä½ çš„å‡½æ•°ä¸­ç”¨åˆ°äº†è¯¸å¦‚ ref,reactive,onMounted ç­‰ vue æä¾›çš„ api çš„è¯,é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª hooks å‡½æ•°,å¦‚æœæ²¡ç”¨åˆ°å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šå·¥å…·å‡½æ•°ã€‚è‡³äºå®ƒä¸ºä»€ä¹ˆå« hooks,æˆ‘çš„ç†è§£åˆ™æ˜¯

> å®ƒå¯ä»¥é€šè¿‡ç‰¹å®šçš„å‡½æ•°å°†é€»è¾‘ "é’©å…¥" ç»„ä»¶ä¸­ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´çµæ´»åœ°æ„å»ºå’Œç®¡ç†ç»„ä»¶çš„åŠŸèƒ½ä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§ä»¥åŠå¯ç»´æŠ¤æ€§ç­‰

æœ¬ç¯‡æ–‡ç« å°†ä»‹ç»hookså¦‚ä½•åœ¨vue3ä¸­ä½¿ç”¨ä»¥åŠå®ƒçš„ä¸€äº›å®é™…ä½¿ç”¨ä¾‹å­,è®©å¤§å®¶èƒ½æ›´å¥½çš„äº†è§£å’Œä½¿ç”¨hooks

åœ¨ vue3 ä¸­ä½¿ç”¨
----------

ä¸Šé¢è¯´åˆ° hooks å‡½æ•°é‡ŒåŒ…å«äº† vue æä¾›çš„ api,ä¸‹é¢æˆ‘ä»¬å°±ç®€å•çš„æ¥ä¸¾ä¸ªä¾‹å­çœ‹ä¸€ä¸‹ vue3 ä¸­çš„ hooks å‡½æ•°ã€‚ä¸€èˆ¬æ¥è¯´,å¦‚æœä¸€ä¸ªä½ å¾—å‡½æ•°ä¸º hooks å‡½æ•°,é‚£ä¹ˆä½ éœ€è¦å°†å…¶ä»¥ use å¼€å¤´å‘½åã€‚åœ¨ src ä¸‹æ–°å»ºä¸€ä¸ª hooks ç›®å½•ä¸“é—¨å­˜æ”¾ hooks å‡½æ•°,ç„¶åå†™ä¸‹ç¬¬ä¸€ä¸ªéå¸¸ç®€å•çš„ hooks å‡½æ•° useAdd

    import { ref } from "vue";
    export const useAdd = () => {
      const a = ref(1);
      setInterval(() => {
        a.value++;
      }, 1000);
      return a;
    };
    

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ hooks å‡½æ•°,æ¯éš”ä¸€ç§’å°±è®© a.value åŠ  1,æœ€åè¿”å›ä¸€ä¸ªå“åº”å¼çš„ a,æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­å¼•ç”¨ä¸€ä¸‹

    <template>
      <div>{{ a }}</div>
    </template>
    
    <script lang='ts' setup>
    import { useAdd } from "../hooks/useAdd"
    const a = useAdd()
    </script>
    
    

æ­¤æ—¶æˆ‘ä»¬ä¼šçœ‹åˆ°æ¯éš”ä¸€ç§’é¡µé¢ä¸Šçš„å€¼å°±ä¼šåŠ  1,æ‰€ä»¥è¯´ a è¿˜æ˜¯ä¿æŒäº†å®ƒçš„å“åº”å¼ç‰¹æ€§

![GIF555.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/667946104afc482f9143b9d08ba17fd0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=294&h=233&s=1197&e=gif&f=5&b=ffffff)

å½“ç„¶è¿™åªæ˜¯ä¸ªç®€å•çš„ä¾‹å­,åé¢ä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸ª hooks å®é™…åº”ç”¨çš„åœºæ™¯

mixin ä¸ hooks
-------------

æˆ‘ä»¬éƒ½çŸ¥é“ Vue 3 å¼•å…¥ `Composition API`çš„å†™æ³•,å½“æˆ‘ä»¬å¼•å…¥ä¸€ä¸ª hooks å‡½æ•°çš„æ—¶å€™å…¶å®å°±åƒåœ¨ vue2 ä¸­ä½¿ç”¨ä¸€ä¸ª mixin ä¸€æ ·,hooks å‡½æ•°ä¸­çš„`ref`,`reactive`å°±ç›¸å½“äº mixin ä¸­çš„`data`,åŒæ—¶ hooks è¿˜å¯ä»¥å¼•å…¥ä¸€äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°,watch ç­‰åœ¨ mixin ä¸­éƒ½æœ‰ä½“ç°ã€‚ä¸‹é¢å±•ç¤ºä¸€ä¸‹ mixin çš„å†™æ³•,è¿™é‡Œä¸è¿‡å¤šçš„è®²è§£ mixin

    export const mixins = {
      data() {
        return {
          msg: "",
        };
      },
      computed: {},
      created() {
        console.log("æˆ‘æ˜¯mixinä¸­çš„createdç”Ÿå‘½å‘¨æœŸå‡½æ•°");
      },
      mounted() {
        console.log("æˆ‘æ˜¯mixinä¸­çš„mountedç”Ÿå‘½å‘¨æœŸå‡½æ•°");
      },
      methods: {
        clickMe() {
          console.log("æˆ‘æ˜¯mixinä¸­çš„ç‚¹å‡»äº‹ä»¶");
        },
      },
    };
    

ç»„ä»¶ä¸­å¼•å…¥

    export default {
      name: "App",
      mixins: [mixins],
      components: {},
      created() {
        console.log("ç»„ä»¶è°ƒç”¨minxiæ•°æ®", this.msg);
      },
      mounted() {
        console.log("æˆ‘æ˜¯ç»„ä»¶çš„mountedç”Ÿå‘½å‘¨æœŸå‡½æ•°");
      },
    };
    

ç”¨è¿‡ vue2 çš„ mixin çš„éƒ½çŸ¥é“å®ƒè™½ç„¶å¯ä»¥å°è£…ä¸€äº›é€»è¾‘,ä½†æ˜¯å®ƒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜.æ¯”å¦‚ä½ å¼•å…¥å¤šä¸ª mixin å®ƒä»¬çš„ data,methods å‘½åå¯èƒ½ä¼šå†²çª,å½“ mixin å¤šäº†å¯èƒ½ä¼šå‡ºç°ç»´æŠ¤æ€§é—®é¢˜,å¦å¤– mixin ä¸æ˜¯ä¸€ä¸ªå‡½æ•°,å› æ­¤ä¸èƒ½ä¼ é€’å‚æ•°æ¥æ”¹å˜å®ƒçš„é€»è¾‘,å…·æœ‰ä¸€å®šçš„å±€é™æ€§ç­‰,ä½†è¿™äº›é—®é¢˜åˆ°äº† vue3 çš„ hooks ä¸­åˆ™è¿åˆƒè€Œè§£

hooks ä¸­ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº
---------------

hooks ä¸­ç”Ÿå‘½å‘¨æœŸä¸ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåºå…¶å®å¾ˆå¥½åˆ¤æ–­,å°±çœ‹å®ƒä»¬è°çš„åŒçº§ç”Ÿå‘½å‘¨æœŸå‡½æ•°å…ˆåˆ›å»ºé‚£å°±å…ˆæ‰§è¡Œè°çš„,æ¯”å¦‚åœ¨ useAdd ä¸­åŠ å‡ ä¸ªç”Ÿå‘½å‘¨æœŸ

    import { ref, onMounted, onBeforeUnmount, onUnmounted } from "vue";
    export const useAdd = () => {
      const a = ref(1);
      setInterval(() => {
        a.value++;
      }, 1000);
      onMounted(() => {
        console.log("hooks---onMounted");
      });
      onBeforeUnmount(() => {
        console.log("hooks---onMounted");
      });
      onUnmounted(() => {
        console.log("hooks---onUnmounted");
      });
    
      return a;
    };
    

ç„¶ååœ¨ç»„ä»¶ä¸­ä¹Ÿå¼•å…¥è¿™äº›ç”Ÿå‘½å‘¨æœŸ

    <template>
      <div>{{ a }}</div>
    </template>
    
    <script lang='ts' setup>
    import { useAdd } from "../hooks/useTest"
    import { onMounted, onBeforeUnmount, onUnmounted } from "vue";
    
    onMounted(() => {
      console.log("ç»„ä»¶---onMounted");
    });
    onBeforeUnmount(() => {
      console.log("ç»„ä»¶---onMounted");
    });
    onUnmounted(() => {
      console.log("ç»„ä»¶---onUnmounted");
    });
    const a = useAdd()
    </script>
    
    

å¦‚æœå°† hooks æ”¾åˆ°æœ€åé‚£ä¹ˆå®ƒä»¬çš„é¡ºåºæ˜¯è¿™æ ·çš„

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e9e16ee417542c1a43f4ce2cd200527~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=297&h=189&s=5012&e=png&b=fefefe)

å¦‚æœæ”¾åˆ°å‰é¢é‚£å°±æ˜¯è¿™æ ·çš„

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff75a1cf38cc48dfbce750fe361c56de~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=382&h=259&s=6331&e=png&b=ffffff)

ok,vue3 çš„ hooks å°±ä»‹ç»è¿™äº›,æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸¤ä¸ªå®é™…åº”ç”¨ä¸­çš„ hooks å‡½æ•°è®©å¤§å®¶ä½“éªŒä¸€ä¸‹

å°è£…ä¸€ä¸ªå‘é€çŸ­ä¿¡éªŒè¯ç å€’è®¡æ—¶ hooks
--------------------

æˆ‘ä»¬å…ˆç›´æ¥åœ¨ç»„ä»¶ä¸­å®ç°ä¸€ä¸ªå‘é€çŸ­ä¿¡çš„åŠŸèƒ½,æ³¨æ„ä¸‹é¢åªå†™äº†ä¸€äº›ä¸»è¦é€»è¾‘,å¾ˆå¤šç»†èŠ‚å¹¶æœªå¤„ç†

    <template>
        <div>
            <input type="text" placeholder="è¯·è¾“å…¥éªŒè¯ç " v-model="code">
            <button @click="sendCode">{{ sendBtnText }}</button>
        </div>
    </template>
    
    <script lang='ts' setup>
    import { ref } from 'vue';
    
    const code = ref('')
    const sendBtnText = ref('å‘é€éªŒè¯ç ')
    const countDownNum = ref(60)
    const sendCode = () => {
        //è¿™é‡Œçœç•¥è°ƒç”¨å‘é€çŸ­ä¿¡æ¥å£é€»è¾‘,çœç•¥ç¦æ­¢ç‚¹å‡»é€»è¾‘
        sendBtnText.value = countDownNum.value + 's'
        const timer = setInterval(() => {
            countDownNum.value--
            sendBtnText.value = countDownNum.value + 's'
            if (countDownNum.value === 0) {
                clearInterval(timer)
                sendBtnText.value = 'å‘é€éªŒè¯ç '
                countDownNum.value = 60
            }
        }, 1000)
    }
    </script>
    <style lang="css">
    button {
        font-size: 14px;
        background: #23A7F2;
        color: #fff;
    }
    
    input {
        height: 30px;
    }
    </style>
    
    

è¿™é‡Œé€»è¾‘å¾ˆç®€å•,å°±æ˜¯ç‚¹å‡»å‘é€æŒ‰é’®å¼€å¯å®šæ—¶å™¨å‡ºç°å€’è®¡æ—¶çš„åŠŸèƒ½

![GIF888.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b86a8c95cbb444349719f19d5b22f874~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=350&h=233&s=6194&e=gif&f=8&b=fffafc)

å‡å¦‚æˆ‘ä»¬è¿˜æœ‰å…¶å®ƒåœ°æ–¹ç”¨åˆ°å‘é€çŸ­ä¿¡é¡µé¢,æˆ‘ä»¬å¯ä»¥å°†çŸ­ä¿¡å‘é€å°è£…æˆä¸€ä¸ªç»„ä»¶ã€‚ä½†æ˜¯å¦‚æœå…¶å®ƒé¡µé¢æƒ³è¦ä½¿ç”¨çš„å‘é€çŸ­ä¿¡é¡µé¢å’Œè¿™ä¸ªç»„ä»¶ä¸ä¸€æ ·çš„è¯,æˆ‘ä»¬å°±éœ€è¦å°†å®ƒçš„é€»è¾‘æŠ½ç¦»å°è£…æˆä¸€ä¸ª hooks å‡½æ•°äº†,ä¸‹é¢æˆ‘ä»¬å°±å°†è¿™ä¸ªå€’è®¡æ—¶åŠŸèƒ½å°è£…æˆä¸€åä¸º useCountDown çš„ hooks

    import { Ref, ref } from "vue";
    export default (
      downNum: number
    ): ({ sendBtnText: Ref<string>, sendCode: () => void }) => {
      const sendBtnText = ref("å‘é€éªŒè¯ç ");
      const countDownNum = ref(downNum);
    
      //è¿™é‡Œçœç•¥è°ƒç”¨å‘é€çŸ­ä¿¡æ¥å£é€»è¾‘,çœç•¥ç¦æ­¢ç‚¹å‡»é€»è¾‘
      const sendCode = () => {
        sendBtnText.value = countDownNum.value + "s";
        const timer = setInterval(() => {
          countDownNum.value--;
          sendBtnText.value = countDownNum.value + "s";
          if (countDownNum.value === 0) {
            clearInterval(timer);
            sendBtnText.value = "å‘é€éªŒè¯ç ";
            countDownNum.value = downNum;
          }
        }, 1000);
      };
      return { sendBtnText, sendCode };
    };
    

é€»è¾‘å’Œä¸Šé¢ä¸€æ ·,åªä¸è¿‡æ˜¯è¿”å›äº†ä¸€ä¸ªæŒ‰é’®è¦æ˜¾ç¤ºçš„æ–‡æœ¬ä»¥åŠä¸€ä¸ªç‚¹å‡»å‘é€éªŒè¯ç è°ƒç”¨çš„å‡½æ•°ã€‚ç„¶ååœ¨ç»„ä»¶ä¸­ä½¿ç”¨

    import { ref } from "vue";
    import useCountDown from "../hooks/useCountDown";
    const code = ref("");
    const { sendBtnText, sendCode } = useCountDown(60);
    

è¿™æ ·çš„è¯åœ¨å…¶å®ƒç»„ä»¶ä¸­å°±ä¹Ÿèƒ½å¤Ÿä½¿ç”¨å®ƒäº†

å†™åœ¨æœ€å
----

Vue 3ä¸­çš„Hookså‡½æ•°æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½,åœ¨ç»„ä»¶å¼€å‘ä¸­ä»–èƒ½å¤Ÿå°†ä¸€äº›é€šç”¨é€»è¾‘æŠ½ç¦»å®ç°é€»è¾‘çš„å¤ç”¨,å¤§å¤§æé«˜äº†æˆ‘ä»¬ä»£ç çš„å¯è¯»æ€§åŠå¯ç»´æŠ¤æ€§ã€‚é€šè¿‡æœ¬ç¯‡æ–‡ç« ç›¸ä¿¡å¤§å®¶å·²ç»å¯¹hooksçš„ä½¿ç”¨æœ‰äº†ä¸€å®šçš„ç†è§£,å¾ˆå¤šå¼€æºé¡¹ç›®ä¸­éƒ½å°è£…äº†å¤§é‡çš„hookså‡½æ•°,å¤§å®¶å¯ä»¥å»æŸ¥çœ‹å­¦ä¹ ä»–ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨hookså‡½æ•°çš„

> éƒ½çœ‹åˆ°æœ€åäº†,ç‚¹ä¸ªèµå§ğŸ‘