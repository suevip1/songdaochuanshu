---
layout: post
title: "Python å¼•ç”¨é—®é¢˜ - ImportError: attempted relative import with no known parent package"
date: "2023-07-08T01:24:42.425Z"
---
Python å¼•ç”¨é—®é¢˜ - ImportError: attempted relative import with no known parent package
=================================================================================

é—®é¢˜æè¿°
----

è¿‘æ—¥åœ¨å°è¯•å¼•ç”¨å…¶ä»–æ–‡ä»¶çš„ä»£ç æ—¶ï¼Œé‡åˆ°äº†é”™è¯¯: _ImportError: attempted relative import with no known parent package_.  
é—®é¢˜å¤§è‡´æ˜¯è¿™æ ·çš„ï¼šæˆ‘æƒ³åœ¨ `code2.py` ä¸­å¼•ç”¨ `code1.py` çš„å‡½æ•°ï¼Œå¦‚ `from ..folder1.code1 import xxx`ï¼Œè¿è¡Œ `code2.py` æ—¶å‡ºç°é”™è¯¯ã€‚

    root
    â”œâ”€â”€ folder1
    â”‚   â””â”€â”€ code1.py
    â”œâ”€â”€ folder2
    â”‚   â””â”€â”€ code2.py
    â””â”€â”€ main.py
    

å¤ªé•¿ä¸çœ‹ç‰ˆ
-----

å¦‚æœä½ è¦åœ¨ `code2.py` ä¸­å¼•ç”¨ `code1.py` çš„å‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥ï¼š

*   æ”¹å˜æ–‡ä»¶ç»“æ„ï¼Œè€ƒè™‘åœ¨ `main.py` ä¸­è°ƒç”¨ï¼Œè¿è¡Œ `main.py`
*   `code2.py` ä¸­å¢åŠ  `root` çš„ä½ç½®åˆ°æœç´¢è·¯å¾„ `sys.path.append`, ä»£ç ä½¿ç”¨ `from folder1.code1 import xxx`
*   ç”¨ `-m` é€‰é¡¹è¿è¡Œ: `python -m root.folder2.code2`ï¼Œä»£ç å¯ä»¥ä½¿ç”¨ `from folder1.code1 import xxx` æˆ– `from ..folder1.code1 import xxx` \[æˆ‘è®¤ä¸ºè¿™æ˜¯æœ€ä¼˜è§£ï¼ğŸ˜ƒ\]

è¯¦ç»†è§£é‡Š
----

å¦‚æœå¯¹å¯¼å…¥çš„æ¦‚å¿µä¸æ˜¯å¾ˆç†è§£çš„è¯ï¼Œå¯èƒ½ä¼šé‡åˆ°ï¼š

*   ModuleNotFoundError: No module named 'xxx'
*   ImportError: attempted relative import with no known parent package

é¦–å…ˆæ˜ç¡®ä¸¤ç§å¯¼å…¥æ–¹æ³•ï¼š

1.  `from xxx import yyy` åˆ™æ˜¯ä»å·²çŸ¥çš„æ¨¡å—å¯¼å…¥
2.  â€œrelative importâ€ å³ `from .xxx import yyy`ï¼Œæ ¹æ®ä»å½“å‰æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å¯¼å…¥ã€‚

### ç¬¬ä¸€ç§æ–¹æ³•

> å…·ä½“å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ [the-module-search-path](https://docs.python.org/3/tutorial/modules.html#the-module-search-path)

ä»…é€‚ç”¨äºæ¨¡å—ï¼ˆæ–‡ä»¶å¤¹ï¼‰æˆ–è„šæœ¬ï¼ˆæ–‡ä»¶ï¼‰å­˜åœ¨äºæœç´¢è·¯å¾„ä¸­ï¼Œå¯¼å…¥æ—¶ï¼ŒPython è§£é‡Šå™¨ä¼šé¦–å…ˆæœç´¢å†…ç½®æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å»ä»¥ä¸‹ä¸‰ä¸ªä½ç½®æœç´¢ï¼š

1.  å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•
2.  ç¯å¢ƒå˜é‡ `PYTHONPATH` æŒ‡å®šçš„ç›®å½•
3.  Python é»˜è®¤çš„å®‰è£…ç›®å½•

å¯ä»¥æŸ¥çœ‹ `sys.path`ï¼Œæ˜¾ç„¶ï¼Œå½“å‰è¿è¡Œè„šæœ¬æ‰€åœ¨çš„æ–‡ä»¶å¤¹è¢«æ”¾åœ¨äº†æœç´¢è·¯å¾„çš„é¦–ä½ï¼Œå› æ­¤è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹å‡å¯è¢«å¼•å…¥ã€‚

    import sys
    print(sys.path)
    # ['/.../path-to-this-folder', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/home/thor/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']
    

è¦è§£å†³å¼€å¤´æå‡ºçš„é—®é¢˜ï¼Œå³å¼•å…¥å…¶ä»–æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ï¼Œå¯ä»¥æŠŠ root çš„ä½ç½®æ·»åŠ åˆ°æœç´¢è·¯å¾„ä¸­ï¼šï¼ˆå¥½å§ï¼Œè¿™æ ·å¾ˆä¸ä¼˜é›…â€¦â€¦ï¼‰

    import sys
    sys.path.join("/path/to/root") # ç”¨ç»å¯¹è·¯å¾„ï¼Œéœ€è¦ä»æ ¹ç›®å½•å¼€å§‹
    sys.path.join("..") # ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä½†æ˜¯å‘½ä»¤è¡Œå½“å‰ä½ç½®ä¸èƒ½å‡ºé”™
    
    from folder1.code1 import xxx
    

å¯ä»¥å‚è€ƒè¿™æ®µä»£ç [\[1\]](#fn1)ï¼š

    if __package__:
        from .. import config
    else:
        sys.path.append(os.dirname(__file__) + '/..')
        import config
    

### ç¬¬äºŒç§æ–¹æ³•

> å…·ä½“å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ [packages](https://docs.python.org/3/tutorial/modules.html#packages)

éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•åªé€‚ç”¨äº package å†…éƒ¨ï¼  
å½“ä½ æŠŠ `code2.py` ä½œä¸ºè„šæœ¬è¿è¡Œæ—¶ï¼Œå³ `python code2.py`ï¼Œæ­¤æ—¶ python å¹¶ä¸ä¼šè®¤ä¸ºå®ƒå±äºæŸä¸€ä¸ª package, å³ä½¿å­˜åœ¨ `__init__.py`ã€‚å¯ä»¥ `print(__package__)` è¿›è¡ŒéªŒè¯ï¼Œä½œä¸ºè„šæœ¬è¿è¡Œæ—¶ä¸º `None`ï¼Œå¦åˆ™åˆ™åº”è¯¥ä¸º `xxx.yyy` çš„å½¢å¼[\[1:1\]](#fn1)ã€‚  
ï¼ˆç½‘ç»œä¸Šæœ‰å¾ˆå¤šåœ°æ–¹éƒ½è¯´æ·»åŠ  `__init__.py` å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†äº‹å®æ˜¯å¹¶ä¸ä¼š ğŸ˜…ï¼Œåœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œåœ¨æœ¬æ–‡æåˆ°çš„æ‰€æœ‰çš„è§£å†³æ–¹æ³•ä¸­ï¼Œæ·»åŠ  `__init__.py` ä¸å¦ä¼¼ä¹ä¸ä¼šå¸¦æ¥ä»€ä¹ˆå½±å“ã€‚ï¼‰

å› æ­¤ï¼Œå¼€å¤´æè¿°çš„é—®é¢˜ä¸­ï¼Œè¦ä½¿ç”¨ç›¸å¯¹å¯¼å…¥çš„å½¢å¼åœ¨ `code2.py` ä¸­å¼•ç”¨ `code1.py` çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨:

    python -m root.folder1.code1
    

*   è¿™é‡ŒæŠŠ root åŠå…¶å†…éƒ¨å½“ä½œä¸€ä¸ªå®Œæ•´çš„ packageï¼Œè€Œ package å†…çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ç›¸å¯¹å¯¼å…¥äº’ç›¸å¼•ç”¨ã€‚
*   â—è¿™é‡Œä¸å¸¦ `.py` åç¼€ã€‚
*   â—ä¸å¯ä»¥ä¸º `python -m folder1.code1`ï¼Œæ­¤æ—¶æŠŠ folder1 åŠå…¶å†…éƒ¨å½“ä½œä¸€ä¸ªå®Œæ•´çš„ package, æ— æ³•å¼•ç”¨åˆ°ä»¥å¤–çš„å†…å®¹ï¼Œä¼šé‡åˆ° _ImportError: attempted relative import beyond top-level package_

é™¤äº†å‘½ä»¤è¡Œè°ƒç”¨æ—¶è¿›è¡Œè°ƒæ•´ï¼Œåœ¨è„šæœ¬ä¸­ import ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼š

    newroot
    â”œâ”€â”€ root
    â”‚Â Â  â”œâ”€â”€ folder1
    â”‚Â Â  â”‚Â Â  â””â”€â”€ code1.py
    â”‚Â Â  â”œâ”€â”€ folder2
    â”‚Â Â  â”‚Â Â  â””â”€â”€ code2.py
    â”‚Â Â  â””â”€â”€ main.py
    â””â”€â”€ upper_main.py
    

*   åœ¨ `upper_main.py` ä¸­æ·»åŠ  `from root.folder2 import code2` å¹¶è¿è¡Œæ—¶ï¼Œå®ƒä¼šæŠŠ `root` å½“ä½œä¸€ä¸ªåŒ…ï¼Œæ­¤æ—¶`code2.py`ä¸­çš„ `from ..folder1.code1 import xxx` å¯ä»¥æ­£å¸¸æ‰§è¡Œ
*   åœ¨ `main.py` ä¸­æ·»åŠ  `import folder2.code2` å¹¶è¿è¡Œæ—¶ï¼Œå®ƒä¼šæŠŠ `folder2` å½“ä½œä¸€ä¸ªåŒ…ï¼Œæ­¤æ—¶ `code2.py` ä¸­çš„ `from .xx import` å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œè€Œ `from ..folder1.code1 import xxx` ä¼šé‡åˆ° _ImportError: attempted relative import beyond top-level package_.

å…¶ä»–
--

è¯´æ˜ï¼š

*   è¿™é‡Œä»…è¯´æ˜æˆ‘å°è¯•æˆåŠŸå¾—å‡ºçš„ç»éªŒï¼Œä¸æ’é™¤æœ‰å…¶ä»–æ­£ç¡®åšæ³•ã€‚
*   æˆ‘è¿˜çœ‹åˆ°è¿‡ç±»ä¼¼ `code2.py` ä¸­æœ‰ `from folder1 import code1` è¿™ç§åšæ³•ï¼Œæ²¡æœ‰æµ‹è¯•è¿‡å…¶é€‚ç”¨æ¡ä»¶ï¼Œä¸è¿‡æ¨¡å—å†…éƒ¨æ„Ÿè§‰ä½¿ç”¨ç›¸å¯¹å¼•ç”¨æ¯”è¾ƒå¥½ã€‚

å…¶ä»–å‚è€ƒèµ„æ–™ï¼š

*   [python - ImportError: attempted relative import with no known parent package ğŸ˜¦ - Stack Overflow](https://stackoverflow.com/questions/63312692/importerror-attempted-relative-import-with-no-known-parent-package)
*   [python - Why pytest always says " ImportError: attempted relative import with no known parent package" - Stack Overflow](https://stackoverflow.com/questions/60789819/why-pytest-always-says-importerror-attempted-relative-import-with-no-known-pa)

* * *

1.  [3 Best Solutions For "ImportError: attempted relative import with no known parent package" \[2021 Updated\]](https://napuzba.com/attempted-relative-import-with-no-known-parent-package/) [â†©ï¸](#fnref1) [â†©ï¸](#fnref1:1)