---
layout: post
title: "åŸºäº.NetCoreå¼€å‘åšå®¢é¡¹ç›® StarBlog - (29) å¼€å‘RSSè®¢é˜…åŠŸèƒ½"
date: "2023-06-25T01:42:00.435Z"
---
åŸºäº.NetCoreå¼€å‘åšå®¢é¡¹ç›® StarBlog - (29) å¼€å‘RSSè®¢é˜…åŠŸèƒ½
==========================================

å‰è¨€
--

æœ€è¿‘å¿™ä¸­å·é—²æŠŠåšå®¢çš„è¯„è®ºåŠŸèƒ½ç»™åšå®Œäº†ï¼Œæˆ‘å¯ä»¥è¯´è¿™ä¸ªè¯„è®ºåŠŸèƒ½å·²ç»è¾¾åˆ°ã€Œç²¾è‡´ã€çš„ç¨‹åº¦äº†ğŸ˜ƒ

ä½†åœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œå…ˆå–ä¸ªå…³å­ï¼Œæ¥ä»‹ç»ä¸€ä¸‹å¦ä¸€ä¸ªæ–°åŠŸèƒ½â€”â€”RSSè®¢é˜…ğŸ”Š

RSSæ˜¯å•¥
-----

æ¥è‡ªhk govæ–°é—»ç½‘çš„ä»‹ç»~

> RSS æ˜¯ç°¡æ˜“è³‡è¨Šèšåˆ(Really Simple Syndication) çš„ç°¡ç¨±ï¼ŒRSSæ¡ç”¨ä¸€å€‹ XML çš„æª”æ¡ˆæ ¼å¼ï¼Œåªè¦ä½ æŠŠRSSå…§å®¹çš„ç¶²å€ï¼ŒåŠ åˆ°ä½ çš„RSSé–±è®€è»Ÿä»¶ (RSS Reader)ï¼Œæ¯ç•¶è©²ç¶²é å…§å®¹æ›´æ–°æ™‚ï¼Œæ›´æ–°äº†çš„æ‘˜è¦ä¾¿æœƒè‡ªå‹•åŠ åˆ°ä½ çš„é–±è®€è»Ÿä»¶ä¹‹å…§ï¼Œé€šçŸ¥ä½ æœ‰é—œå…§å®¹ã€‚é€é RSS çš„ä½¿ç”¨ï¼Œä¾›æ‡‰ç¶²é å…§å®¹çš„äººå¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¢ç”Ÿä¸¦å‚³æ’­æ–°èéˆçµã€æ¨™é¡Œå’Œæ‘˜è¦ç­‰è³‡æ–™ã€‚

ä¸€ä¸ªç½‘ç«™æ”¯æŒ RSSï¼Œå°±æ„å‘³ç€æ¯å½“å®ƒæ–°å‘å¸ƒä¸€ç¯‡æ–°æ–‡ç« ï¼Œå°±ä¼šå¾€ä¸€ä¸ªä½äºç‰¹å®šç½‘å€çš„æ–‡ä»¶ä¸­ï¼Œä»¥ç‰¹å®šçš„è¯­æ³•ï¼ˆå…·ä½“è€Œè¨€æ˜¯ XML æ ‡è®°è¯­è¨€æˆ– JSONï¼‰å¢åŠ ä¸€æ¡è®°å½•ï¼Œåˆ—æ˜è¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ã€ä½œè€…ã€å‘è¡¨æ—¶é—´å’Œå†…å®¹ï¼ˆå¯ä»¥æ˜¯å…¨æ–‡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‘˜è¦ï¼‰ç­‰ä¿¡æ¯ã€‚è¿™æ ·ï¼Œç”¨æˆ·åªè¦æœé›†æ‰€æœ‰ä»–æ„Ÿå…´è¶£çš„ç½‘ç«™æä¾›çš„è¿™ç§æ–‡ä»¶çš„ç½‘å€ï¼Œå¹¶ä¸æ—¶æ£€æŸ¥è¿™äº›æ–‡ä»¶å†…å®¹çš„æ›´æ–°ï¼Œå°±èƒ½çŸ¥é“è¿™äº›ç½‘ç«™æ˜¯å¦ã€ä½•æ—¶å‘å¸ƒäº†ä»€ä¹ˆå†…å®¹ã€‚RSS é˜…è¯»å™¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯å­˜å‚¨ç”¨æˆ·è®¢é˜…çš„ RSS åœ°å€ï¼Œä»¥å›ºå®šçš„é¢‘ç‡è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼Œå¹¶å°†å…¶å†…å®¹è½¬æ¢ä¸ºæ˜“è¯»çš„æ ¼å¼å‘ˆç°ç»™ç”¨æˆ·ã€‚

ä¸ºå•¥è¦å¼€å‘RSSåŠŸèƒ½
----------

èµ·å…ˆæ˜¯æœ‰ç”¨æˆ·åœ¨StarBlogé¡¹ç›®githubé‡Œæäº†ä¸ªissue

æˆ‘è§‰å¾—æŒºä¸é”™çš„ï¼Œå®ç°èµ·æ¥ä¹Ÿä¸éš¾ï¼Œæ‰€ä»¥å°±ç€æ‰‹å®‰æ’å®ç°äº†ã€‚

å¯¹äºç°åœ¨çš„ç½‘å‹æ¥è¯´ï¼Œè¿™ç®—æ˜¯ä¸ªæ¯”è¾ƒé™Œç”Ÿå’Œå°ä¼—çš„ä¸œè¥¿ï¼ŒRSS çš„å¯¹ç«‹é¢æ˜¯ç®—æ³•æ¨èï¼Œåƒå¾®ä¿¡å…¬ä¼—å·ã€çŸ¥ä¹ã€å¾®åšã€ä»Šæ—¥å¤´æ¡ç­‰å¹³å°ã€‚ ä¸”ä¸è¯´ç®—æ³•æ¨é€å¹³å°å¹¿å‘Šå¤šï¼Œè¿ç§»éº»çƒ¦çš„é—®é¢˜ã€‚ç®—æ³•æ¨èçš„ç‰¹ç‚¹æ˜¯ï¼Œä½ ä¸éœ€è¦åˆ»æ„é€‰æ‹©ï¼Œç®—æ³•ä¼šæ ¹æ®ä½ çš„å–œå¥½ï¼Œç»™ä½ æ¨é€å†…å®¹ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ å‡ ä¹æ²¡æœ‰é€‰æ‹©çš„ä½™åœ°ï¼Œåœ¨ä¸æ–­è¢«ã€Œå–‚é¥±ã€ä¸­é€æ¸å¤±å»åˆ¤æ–­çš„èƒ½åŠ›ã€‚æ›´å¯æ€•çš„åœ°æ–¹åœ¨äºï¼Œ**å®ƒæ›¿ä½ å®šä¹‰äº†ä½ çš„ç”»åƒï¼Œç„¶åæŠŠä½ æ½œç§»é»˜åŒ–ä¸­å˜æˆäº†å®ƒæ‰€è®¤ä¸ºçš„ä½ **ã€‚ã€Œå¤§æ•°æ®æ€ç†Ÿã€çš„ä¸œçª—äº‹å‘ç»éå¶ç„¶ï¼Œç”¨ç®—æ³•çª¥è§†ç”¨æˆ·éšç§æ˜¯å½“ä»Šäº’è”ç½‘å…¬å¸çš„é€šé…ã€‚

**åšä¿¡æ¯çš„ä¸»äººï¼Œè€Œä¸æ˜¯å¥´éš¶ã€‚**RSS æ˜¯ä¸€ç§å…¬å¼€çš„åè®®ï¼Œå¯è‡ªç”±æ›´æ¢å¹³å°ä¸å®¢æˆ·ç«¯ã€‚é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œ**è·å–ä¿¡æ¯çš„æƒåŠ›å®Œå…¨è‡ªæ²»**ã€‚RSS ç›¸æ¯”ç®—æ³•æ¨èï¼Œæ‹¥æœ‰äº†å¯æ§æ€§å’Œå®‰å…¨æ„Ÿï¼Œéšç§å®Œå…¨æŒæ¡åœ¨è‡ªå·±æ‰‹é‡Œã€‚

RSSç‰ˆæœ¬ - Atom ä¸ RSS2.0
---------------------

æˆ‘ä¸€å¼€å§‹ä»¥ä¸º RSS2.0 æ¯” Atom1.0 æ›´æ–°ï¼Œç»“æœå®Œå…¨æåäº†~

> ç®€å•æ¥è¯´ï¼šATOMæ˜¯RSS2.0çš„æ”¹è¿›æ–¹æ¡ˆï¼Œå› ä¸ºRSS2.0çš„æ ‡å‡†å·²ç»å†»ç»“ï¼Œæ‰€ä»¥æ‰å‡ºäº†ATOMã€‚ä¸»è¦æ”¹è¿›æ˜¯ATOMå¯ä»¥é€šè¿‡æ ‡ç­¾è¯†åˆ«ä¸€ä¸ªå†…å®¹æ˜¯å¦æ˜¯å…¨æ–‡è¾“å‡ºè€ŒRSS2.0ä¸å¯ä»¥ã€‚
> 
> åŒæ—¶ï¼ŒATOMä¸ä»…èƒ½å¤Ÿåˆ¤æ–­å‡ºå†…å®¹æ˜¯å¦æ˜¯å…¨æ–‡è¾“å‡ºï¼Œåœ¨ç»ˆç«¯è½¯ä»¶ä½¿ç”¨è¯¥FEEDæ—¶ï¼Œè¿˜å¯ä»¥ä»ä¸­å¾—åˆ°é‚£ä¸€éƒ¨åˆ†æ˜¯â€œæ‘˜è¦â€é‚£ä¸€éƒ¨åˆ†æ˜¯â€œå…¨æ–‡â€æ–¹ä¾¿è¿›è¡ŒåŒºåˆ«æ˜¾ç¤ºã€‚

é‚£è‚¯å®šé€‰æ–°ç‰ˆçš„å•¦ï¼Œç›´æ¥ç”¨ Atom1.0 ç‰ˆæœ¬ã€‚

å®ç°
--

ä¸€å¼€å§‹æˆ‘æ˜¯æ‰“ç®—æ‰¾ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå¯ä»¥ç›´æ¥å’ŒAspNetCoreå¾ˆå¥½åœ°ç»“åˆåœ¨ä¸€èµ·çš„é‚£ç§ã€‚

ä¸è¿‡æ²¡æœ‰æ‰¾åˆ°ï¼Œä½†æ˜¯æˆ‘å‘ç° C# æ ‡å‡†åº“å±…ç„¶æœ‰æä¾›å¯¹ RSS çš„æ”¯æŒ~ é‚£è¿˜è¦å•¥è‡ªè¡Œè½¦ï¼Œç«‹åˆ»å®‰æ’ï¼ğŸ†—

### å®‰è£…ä¾èµ–

è™½ç„¶æ˜¯ã€Œæ ‡å‡†åº“ã€ä½†å› ä¸ºç°åœ¨ .net core æ˜¯å¾ˆè½»çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸ª nuget åŒ…æ‰å¯ä»¥ç”¨ã€‚

    dotnet add package System.ServiceModel.Syndication
    

è¿™ä¸ª `Syndication` åº“å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ›å»º RSS è®¢é˜…ã€‚

ä¸‹é¢åˆ†æ­¥éª¤å®ç°

### æ·»åŠ æ¥å£

æ·»åŠ  `StarBlog.Web/Controllers/RssController.cs` æ–‡ä»¶

    [ApiController]
    [Route("feed")]
    [ApiExplorerSettings(IgnoreApi = true)]
    public class RssController : ControllerBase {
      private readonly IBaseRepository<Post> _postRepo;
    
      public RssController(IBaseRepository<Post> postRepo) {
        _postRepo = postRepo;
      }
    
      [ResponseCache(Duration = 1200)]
      [HttpGet]
      public async Task<IActionResult> Index() {
      }
    }
    

æ¥ç€åœ¨ `Index` æ–¹æ³•é‡Œé¢å†™ä»£ç 

### åˆ›å»º feed

    var feed = new SyndicationFeed("StarBlog", "ç¨‹åºè®¾è®¡å®éªŒå®¤ï¼Œä¸€ä¸ªæŠ€æœ¯æ¢ç´¢ä¸çŸ¥è¯†åˆ†äº«çš„å¹³å°", new Uri("http://blog.deali.cn"), "RSSUrl", DateTime.Now) {
      Copyright = new TextSyndicationContent($"{DateTime.Now.Year} DealiAxy")
    };
    

ä¼ å…¥çš„å‚æ•°åˆ†åˆ«æ˜¯æ ‡é¢˜ã€è¯´æ˜ã€ç½‘ç«™åœ°å€ã€è®¢é˜…IDå’Œæœ€åæ›´æ–°æ—¶é—´ã€‚

è¿™é‡Œåªæ˜¯ä¾‹å­ï¼Œæ‰€ä»¥æŠŠæ›´æ–°æ—¶é—´ç›´æ¥å†™æˆå½“å‰æ—¶é—´äº†ï¼Œå®é™…ä¸Šåº”è¯¥æŠŠæœ€æ–°æ–‡ç« çš„æ—¶é—´å†™è¿›å»ã€‚

### æ·»åŠ æ–‡ç« 

æŠŠåšå®¢çš„æ–‡ç« æ·»åŠ åˆ°è®¢é˜…æºé‡Œ

    var items = new List<SyndicationItem>();
    var posts = await _postRepo.Where(a => a.IsPublish && a.CreationTime.Year == DateTime.Now.Year)
      .Include(a => a.Category)
      .ToListAsync();
    foreach (var item in posts) {
      var postUrl = Url.Action("Post", "Blog", new { id = item.Id }, HttpContext.Request.Scheme);
      items.Add(new SyndicationItem(item.Title, item.Summary, new Uri(postUrl), item.Id, item.LastUpdateTime) {
        Categories = { new SyndicationCategory(item.Category?.Name) },
        Authors = { new SyndicationPerson("admin@deali.cn", "DealiAxy", "https://deali.cn") },
        PublishDate = item.CreationTime
      });
    }
    feed.Items = items;
    

è¿™é‡Œæˆ‘æŠŠä»Šå¹´å·²å‘å¸ƒçš„æ–‡ç« éƒ½æ”¾è¿›è®¢é˜…æºé‡Œã€‚

RSSæ–‡ç« å†…å®¹é€šè¿‡ `SyndicationItem` æ„é€ æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œä¸ºäº†å®ä¾‹ä»£ç ç®€æ´ï¼Œæˆ‘ç›´æ¥å·æ‡’ä½¿ç”¨çº¯æ–‡æœ¬çš„ summary

å¦‚æœè¦è®© RSS é˜…è¯»å™¨æ˜¾ç¤ºæ–‡ç« çš„æ—¶å€™å›¾æ–‡å¹¶èŒ‚ï¼Œåº”è¯¥ä½¿ç”¨ HTML æ ¼å¼çš„æ–‡ç« å†…å®¹ï¼Œå¯ä»¥æŠŠ `item.Summary` æ¢æˆä»¥ä¸‹ä»£ç 

    new TextSyndicationContent(PostService.GetContentHtml(item), TextSyndicationContentKind.Html)
    

### ç”Ÿæˆxml

æœ€åï¼Œå› ä¸º RSS æ˜¯ä½¿ç”¨ XML æ ¼å¼çš„ï¼Œæ‰€ä»¥æœ€åéœ€è¦ä½¿è¿™ä¸ªæ¥å£è¿”å› XML æ•°æ®ã€‚

    var settings = new XmlWriterSettings {
      Async = true,
      Encoding = Encoding.UTF8,
      NewLineHandling = NewLineHandling.Entitize,
      NewLineOnAttributes = true,
      Indent = true
    };
    using var stream = new MemoryStream();
    await using var xmlWriter = XmlWriter.Create(stream, settings);
    var rssFormatter = new Atom10FeedFormatter(feed);
    rssFormatter.WriteTo(xmlWriter);
    await xmlWriter.FlushAsync();
    
    return File(stream.ToArray(), "application/rss+xml; charset=utf-8");
    

æ³¨æ„ `var rssFormatter = new Rss20FeedFormatter(feed, false);` è¿™è¡Œä»£ç ï¼Œè¡¨ç¤ºæˆ‘ä»¬ç”¨çš„ RSS ç‰ˆæœ¬æ˜¯ Atom1.0ã€‚

å¦‚æœè¦ç”¨ RSS2.0 ï¼Œå¯ä»¥æ¢æˆä»¥ä¸‹ä»£ç ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º `false` ä»£è¡¨ä¸æŠŠæ‰©å±•è¯­æ³•æ¸²æŸ“æˆ Atom 1.0 çš„æ ·å¼ã€‚

    var rssFormatter = new Rss20FeedFormatter(feed, false);
    

### å®Œæ•´ä»£ç 

å®Œæ•´ä»£ç è§ github ~

> [https://github.com/Deali-Axy/StarBlog/blob/dev/StarBlog.Web/Controllers/RssController.cs](https://github.com/Deali-Axy/StarBlog/blob/dev/StarBlog.Web/Controllers/RssController.cs)

æœ€ç»ˆæ•ˆæœ
----

RSS è®¢é˜…éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯é˜…è¯»

è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå¼€æºçš„Windowså®¢æˆ·ç«¯ Fluent Reader

å°† `blog.deali.cn/feed` æ·»åŠ åˆ°è®¢é˜…æºä¹‹åï¼Œå°±å¯ä»¥çœ‹åˆ°ä»Šå¹´å‘å¸ƒçš„æ–‡ç« äº†

![](https://img2023.cnblogs.com/blog/866942/202306/866942-20230624211046954-1993954566.png)

æå®šï¼Œæ”¶å·¥~

å‚è€ƒèµ„æ–™
----

*   [https://mitchelsellers.com/blog/article/creating-an-rss-feed-in-asp-net-core-3-0](https://mitchelsellers.com/blog/article/creating-an-rss-feed-in-asp-net-core-3-0)
*   [https://www.news.gov.hk/chi/rss/index.html](https://www.news.gov.hk/chi/rss/index.html)
*   [https://sspai.com/post/56198](https://sspai.com/post/56198)
*   [https://www.zhihu.com/question/19593963/answer/12361526](https://www.zhihu.com/question/19593963/answer/12361526)

å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œç¨‹åºè®¾è®¡å®éªŒå®¤ã€ ä¸“æ³¨äºäº’è”ç½‘çƒ­é—¨æ–°æŠ€æœ¯æ¢ç´¢ä¸å›¢é˜Ÿæ•æ·å¼€å‘å®è·µï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æœºå™¨å­¦ä¹ ä¸æ•°æ®åˆ†æç®—æ³•ã€ç§»åŠ¨ç«¯å¼€å‘ã€Linuxã€Webå‰åç«¯å¼€å‘ç­‰ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨æŠ€æœ¯ï¼Œåˆ†äº«å­¦ä¹ å®è·µç»éªŒã€‚