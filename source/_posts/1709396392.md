---
layout: post
title: "OpenCväººè„¸æ£€æµ‹æŠ€æœ¯-(å®ç°æŠ–éŸ³ç‰¹æ•ˆ-ç»™äººè„¸æˆ´ä¸Šå¢¨é•œ)"
date: "2023-04-22T01:06:29.017Z"
---
OpenCväººè„¸æ£€æµ‹æŠ€æœ¯-(å®ç°æŠ–éŸ³ç‰¹æ•ˆ-ç»™äººè„¸æˆ´ä¸Šå¢¨é•œ)
=============================

OpenCväººè„¸æ£€æµ‹æŠ€æœ¯-(å®ç°æŠ–éŸ³ç‰¹æ•ˆ-ç»™äººè„¸æˆ´ä¸Šå¢¨é•œ)
=============================

æœ¬æ–‡ç« ç”¨çš„æ˜¯Pythonåº“é‡Œçš„OpenCvã€‚

OpenCvç›¸å…³å‡½æ•°è¯´æ˜
------------

    import cv2 # å¯¼å…¥OpenCvåº“
    cv2.imread(filename) # è¯»å–å›¾åƒ
    object = cv2.CascadeClassifier() # æ‹¬å·é‡Œé¢å¡«Haarçº§è”åˆ†ç±»å™¨
    """
    CascadeClassifierï¼Œæ˜¯Opencvä¸­åšäººè„¸æ£€æµ‹çš„æ—¶å€™çš„ä¸€ä¸ªçº§è”åˆ†ç±»å™¨ã€‚å¹¶ä¸”æ—¢å¯ä»¥ä½¿ç”¨Haarï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨LBPç‰¹å¾ã€‚Haarç‰¹å¾æ˜¯ä¸€ç§åæ˜ å›¾åƒçš„ç°åº¦å˜åŒ–çš„ï¼Œåƒç´ åˆ†æ¨¡å—æ±‚å·®å€¼çš„ä¸€ç§ç‰¹å¾ã€‚
    """
    object.detectMultiScale(image, scaleFactor, minNeighbors)
    """
    detectMultiScaleæ˜¯CascadeClassifierçš„å­ç±»ï¼›
    image:å¾…åˆ†æçš„å›¾åƒã€‚
    scaleFactor:æ‰«æå›¾åƒæ—¶ç¼©æ”¾çš„æ¯”ä¾‹ã€‚
    minNeighbors:ä¿ç•™å¤šå°‘æ£€æµ‹ç»“æœï¼Œè¯¥å€¼è¶Šå¤§è¯¯å·®è¶Šå°ã€‚
    etc...
    """
    cv2.waitKey(delay) # ç­‰å¾…ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜åç­‰å¾…delayæ¯«ç§’
    cv2.destroyAllWindows() # é”€æ¯æ‰€æœ‰çª—å£
    

åˆ†æäººè„¸ä½ç½®
------

> äººè„¸æ£€æµ‹ï¼ŒæŠŠå›¾åƒåˆ†æˆä¸€ä¸ªä¸ªå°å—ï¼Œå¯¹æ¯ä¸€ä¸ªå°å—åˆ¤æ–­æ˜¯å¦æ˜¯äººè„¸ï¼Œå‡å¦‚ä¸€å¼ å›¾è¢«åˆ†æˆäº†5000å—ï¼Œåˆ™é€Ÿåº¦éå¸¸æ…¢ã€‚  
> ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒOpenCV æä¾› cascades æ¥é¿å…è¿™ç§æƒ…å†µã€‚æä¾›äº†ä¸€ç³»åˆ—çš„xmlæ–‡ä»¶  
> cascades ï¼šç¿»è¯‘ ï¼šå°ç€‘å¸ƒ çº§è”  
> cascade å¯¹äºæ¯ä¸ªæ•°æ®å—ï¼Œå®ƒéƒ½è¿›è¡Œä¸€ä¸ªç®€å•å¿«é€Ÿçš„æ£€æµ‹ã€‚è‹¥è¿‡ï¼Œä¼šå†è¿›è¡Œä¸€ä¸ªæ›´ä»”ç»†çš„æ£€æµ‹ã€‚è¯¥ç®—æ³•æœ‰ 30 åˆ° 50 ä¸ªè¿™æ ·çš„é˜¶æ®µï¼Œæˆ–è€…è¯´ cascadeã€‚åªæœ‰é€šè¿‡å…¨éƒ¨é˜¶æ®µï¼Œcascadeæ‰ä¼šåˆ¤æ–­æ£€æµ‹åˆ°äººè„¸ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šå¤§å¤šæ•°å°å—éƒ½ä¼šåœ¨å‰å‡ æ­¥å°±äº§ç”Ÿå¦å®šåé¦ˆï¼ŒèŠ‚çº¦æ—¶é—´ã€‚  
> èµ„æºé“¾æ¥ï¼Œè¯¥èµ„æºä¸ä»…ä»…åŒ…æ‹¬äººè„¸xmlï¼Œè¿˜æœ‰å…¶ä»–çœ¼ç›ç­‰ã€‚èµšå–ç‚¹ç§¯åˆ†å§ã€‚  
> OpenCVäººè„¸è¯†åˆ«xmlæ–‡ä»¶.zipæˆ–è€…ä»å®˜ç½‘Sourcesé‡Œæ‰¾èµ„æºï¼Œdataæ–‡ä»¶å¤¹ä¸­æœ‰æ˜¯ç‰¹å¾æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€‰ç”¨haarcascade\_frontalface\_default.xml

èµ„æ–™æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚

    import cv2
    img = cv2.imread("/Users/duanhao/Desktop/photo/liukun.jpg")
    # åŠ è½½è¯†åˆ«äººè„¸çš„çº§è”åˆ†æå™¨
    faceCascade = cv2.CascadeClassifier("/Applications/anaconda/anaconda3/lib/python3.9/site-packages/cv2/data/haarcascade_frontalface_default.xml")
    faces = faceCascade.detectMultiScale(img, 1.15, 5)
    for (x, y, w, h) in faces:
        cv2.rectangle(img, (x, y), (x + w, y + h), (0, 0, 255), 5)
    cv2.imshow("image", img)
    cv2.waitKey()
    cv2.destroyAllWindows()
    

ç»™äººè„¸æˆ´ä¸Šå¢¨é•œ
-------

å‡†å¤‡é˜¶æ®µï¼šæˆ‘ä»¬å¯ä»¥è¯»å–è§†é¢‘ï¼Œä¹Ÿå¯ä»¥è¯»å–äººè„¸ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡äº†ä¸€å¼ å«æœ‰äººè„¸çš„ç…§ç‰‡ï¼›

å¦‚æœè¦è¯»å–è§†é¢‘éœ€è¦ç”¨ï¼š**VideoCapture**ç±»æ–¹æ³•ã€‚

ç´ æï¼šä¸€å¼ å¢¨é•œğŸ•¶ï¸çš„å›¾ç‰‡ï¼Œç”¨äºåæœŸè¦†ç›–åŸå§‹å›¾åƒã€‚

### ä»£ç ï¼š

    import cv2
    def over_img(img, img_over, over_x, over_y):
        img_h, img_w, c = img.shape
        img_over_h, img_over_w, over_c = img_over.shape
        if over_c == 3:
            img_over = cv2.cvtColor(img_over, cv2.COLOR_BGR2BGRA)
        for w in range(0, img_over_w):
            for h in range(0, img_over_h):
                # é€æ˜åƒç´ ä¸èƒ½è¦†ç›–å›¾åƒ
                if img_over[h, w, 3] != 0:
                    for c in range(0, 3):
                        x = over_x + w
                        y = over_y + h
                        if x >= img_w or y >= img_h:
                            break
                        img[y, x, c] = img_over[h, w, c]
        return img
    
    img = cv2.imread("/Users/duanhao/Desktop/photo/liukun.jpg")
    glass = cv2.imread("/Users/duanhao/Desktop/photo/glass.png", cv2.IMREAD_UNCHANGED) # ä¿ç•™å›¾åƒç±»å‹
    height, weight, channel = glass.shape
    # åŠ è½½äººè„¸è¯†åˆ«è”ç»“å™¨
    faceCascade = cv2.CascadeClassifier("/Applications/anaconda/anaconda3/lib/python3.9/site-packages/cv2/data/haarcascade_frontalface_default.xml")
    face = faceCascade.detectMultiScale(img, 1.15, 4)
    for (x, y, w, h) in face:
        gw = w
        gh = int(height * gw/weight)
        img_over_new = cv2.resize(glass, (gw, gh))
        img = over_img(img, img_over_new, x, y+int(h*1/3))
        # cv2.rectangle(img, (x, y), (x + w, y + h), (0, 0, 255), 5)
    cv2.imshow("screen", img)
    cv2.waitKey()
    cv2.destroyAllWindows()
    

### æ•ˆæœå›¾ï¼š

![](https://img2023.cnblogs.com/blog/3163319/202304/3163319-20230421184506520-401097662.png)

### ç»“æŸè¯­ï¼š

ä¸Šé¢æ˜¯æˆ‘äº”ä¸ªå®¤å‹çš„åˆç…§ã€‚å½“æ—¶å› ä¸ºæœ‰ä¸€ä¸ªç®—æ³•æ¯”èµ›ï¼Œæˆ‘åœ¨å¯å®¤é‡Œå¤‡æˆ˜ç®—æ³•ç«èµ›ï¼Œæ‰€ä»¥æ²¡å’Œå®¤å‹ä¸€èµ·å‡ºå»ï¼Œæ‰€ä»¥ä¸Šé¢çš„åˆç…§æ²¡æœ‰æˆ‘ã€‚åé¢æˆ‘æœ‰æ—¶é—´ï¼Œä¸€å®šè¦æŠŠæˆ‘è‡ªå·±Pä¸Šå»ï¼ï¼

æœ€åï¼Œç¥æ‰€æœ‰å¥‹æ–—çš„äººéƒ½èƒ½æ”¶è·åˆ°å¥½çš„ç»“æœã€‚