---
layout: post
title: "DataGridView æ§ä»¶åˆ†é¡µ"
date: "2023-07-25T01:17:16.249Z"
---
DataGridView æ§ä»¶åˆ†é¡µ
=================

![DataGridView æ§ä»¶åˆ†é¡µ](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230724165249464-543078903.png) å®ç° Winform ä¸‹ DataGridView æ§ä»¶åˆ†é¡µåŠŸèƒ½çš„ä¸€ç§æ–¹æ³•

åœ¨ä½¿ç”¨`Winform`å¼€å‘æ¡Œé¢åº”ç”¨æ—¶ï¼Œå·¥å…·ç®±é¢„å…ˆæä¾›äº†ä¸°å¯Œçš„åŸºç¡€æ§ä»¶ï¼Œåˆ©ç”¨è¿™äº›åŸºç¡€æ§ä»¶å¯ä»¥å¼€å±•å„ç±»é¡¹ç›®çš„å¼€å‘ã€‚ä½†æ˜¯æˆ–å¤šæˆ–å°‘éƒ½ä¼šå‡ºç°æ—¢æœ‰æ§ä»¶æ— æ³•æ»¡è¶³åŠŸèƒ½éœ€æ±‚çš„æƒ…å†µï¼Œæˆ–è€…åœ¨å¼€å‘ç±»ä¼¼é¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…·æœ‰ç›¸åŒåŠŸèƒ½çš„æ¨¡æ¿å°è£…æˆä¸€ä¸ªæ ‡å‡†æ§ä»¶ç­‰ï¼Œåœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œ`winform`è‡ªå¸¦çš„æ§ä»¶å°±æœ‰äº›ä¹åŠ›äº†ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å¼€å‘ä¸€äº›æ§ä»¶ã€‚

æœ¬ç¯‡å¼€ç¯‡äº`DataGridView`æ§ä»¶çš„åˆ†é¡µæ•ˆæœï¼Œå½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œåˆ†é¡µæ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯æ§ä»¶æœ¬èº«æ˜¯æ²¡æœ‰åˆ†é¡µåŠŸèƒ½çš„ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å®ç°ã€‚

æˆ‘ä¸æ˜¯ä¸“ä¸šçš„æ§ä»¶å¼€å‘äººå‘˜ï¼Œæ‰€ä»¥å†™ä¸‹è¿™ç¯‡æ–‡ç« ä½œä¸ºå­¦ä¹ è¿‡ç¨‹ä¸­çš„è®°å½•ã€‚

å‰è¨€
--

`.NET`æä¾›äº†ä¸°å¯Œçš„æ§ä»¶åˆ›ä½œæŠ€æœ¯ï¼Œè‡ªå®šä¹‰æ§ä»¶ä¸»è¦åˆ†ä¸ºä¸‰ç±» - [Windows Forms Control Development Basics](https://learn.microsoft.com/en-us/dotnet/desktop/winforms/controls/windows-forms-control-development-basics?view=netframeworkdesktop-4.8)ï¼š

*   å¤åˆæ§ä»¶ï¼šå°†ç°æœ‰æ§ä»¶ç»„åˆæˆä¸€ä¸ªæ–°çš„æ§ä»¶
*   æ‰©å±•æ§ä»¶ï¼šåœ¨ç°æœ‰æ§ä»¶çš„åŸºç¡€ä¸Šä¿®æ”¹åŸæœ‰æ§ä»¶åŠŸèƒ½æˆ–æ·»åŠ æ–°çš„åŠŸèƒ½
*   è‡ªå®šä¹‰æ§ä»¶ï¼šä»å¤´åˆ°å°¾å¼€å‘ä¸€ä¸ªå…¨æ–°çš„æ§ä»¶ã€‚ç»§æ‰¿`System.Windows.Forms.Control`ç±»ï¼Œæ·»åŠ å’Œé‡å†™åŸºç±»çš„å±æ€§ã€æ–¹æ³•å’Œäº‹ä»¶ã€‚`winform`çš„æ§ä»¶éƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥ä»`System.Windows.Forms.Control`æ´¾ç”Ÿçš„ç±»ï¼ŒåŸºç±»`Control`æä¾›äº†æ§ä»¶è¿›è¡Œå¯è§†åŒ–æ‰€éœ€è¦çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬çª—å£çš„å¥æŸ„ã€æ¶ˆæ¯è·¯ç”±ã€é¼ æ ‡å’Œé”®ç›˜äº‹ä»¶ä»¥åŠè®¸å¤šå…¶ä»–ç”¨æˆ·ç•Œé¢äº‹ä»¶ã€‚è‡ªå®šä¹‰æ§ä»¶æ˜¯æœ€çµæ´»ä¹Ÿæœ€ä¸ºå¼ºå¤§çš„æ–¹æ³•ï¼ŒåŒæ—¶å¯¹å¼€å‘è€…çš„è¦æ±‚ä¹Ÿæ¯”è¾ƒé«˜ï¼Œä½ éœ€è¦å¤„ç†æ›´ä¸ºåº•å±‚çš„`Windows`æ¶ˆæ¯ï¼Œéœ€è¦äº†è§£`GDI+`æŠ€æœ¯ä»¥åŠ`Windows API`

> ç”±æ˜“åˆ°éš¾ï¼Œæˆ‘ä»¬ä»æœ€ç®€å•çš„å¤åˆæ§ä»¶ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œè‡ªå®šä¹‰æ§ä»¶ä½œä¸ºæˆ‘ä»¬çš„ç»ˆæç›®æ ‡å“ˆğŸ˜

é€šè¿‡`MSND`ä¸Šçš„ [ctlClockLib](https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/walkthrough-authoring-a-composite-control-with-visual-csharp?view=netframeworkdesktop-4.8) ç¤ºä¾‹å­¦ä¸€ä¸‹æ€æ ·å¼€å‘å¤åˆæ§ä»¶ä»¥åŠæ‰©å±•ç°æœ‰æ§ä»¶ï¼š

å¤åˆæ§ä»¶ - ç¤ºä¾‹
---------

æ¥çœ‹çœ‹æ€æ ·åˆ›å»ºå’Œè°ƒè¯•è‡ªå®šä¹‰æ§ä»¶é¡¹ç›®ï¼Œä»¥`MSND`ä¸Šçš„[ctlClockLib ä¸­çš„ ctlClock](https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/walkthrough-authoring-a-composite-control-with-visual-csharp?view=netframeworkdesktop-4.8)ä¸ºä¾‹ï¼š

1.  åˆ›å»º`Windows çª—ä½“æ§ä»¶åº“` ![image-20230721094239904](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721094241657-1022880648.png)
    
2.  ä¹‹åå…¶å®å’Œå¼€å‘`Winform`é¡¹ç›®å·®ä¸å¤šï¼Œåœ¨è®¾è®¡æ—¶é‡Œæ‹–å…¥æƒ³è¦ç»„åˆçš„æ§ä»¶ï¼Œåœ¨åå°ä»£ç å®ç°ç›¸åº”çš„å†…å®¹ã€‚å…·ä½“ä»£ç ï¼Œä¸åšèµ˜è¿°ï¼Œå’Œæ–‡æ¡£ç›¸åŒã€‚è¿™ä¸ªæ•™ç¨‹åªè¦æ˜¯å®Œæˆä¸€ä¸ªå¯ä»¥è‡ªå®šä¹‰åº•è‰²ä»¥åŠæ—¶é—´å­—ä½“é¢œè‰²çš„ä»¥åŠæ—¶é’Ÿæ§ä»¶ï¼Œç”±ä¸€ä¸ª`Label`å’Œä¸€ä¸ª`Timer`ç»„æˆï¼Œæš´éœ²å‡ºä¸€ä¸ª`ClockBackColor`å±æ€§å’Œ`ClockBackColor`åˆ†åˆ«æ§åˆ¶èƒŒæ™¯è‰²ä»¥åŠå­—ä½“é¢œè‰²ï¼š
    
        using System;
        using System.Drawing;
        using System.Windows.Forms;
        
        namespace ctlClockLib
        {
            public partial class ctlClock : UserControl
            {
                private Color colFColor;
                private Color colBColor;
        
                public Color ClockBackColor
                {
                    get => colBColor;
                    set
                    {
                        colBColor = value;
                        lblDisplay.BackColor = colBColor;
                    }
                }
                public Color ClockBackColor
                {
                    get => colFColor;
                    set
                    {
                        colFColor = value;
                        lblDisplay.ForeColor = colFColor;
                    }
                }
                public ctlClock()
                {
                    InitializeComponent();
                }
                protected virtual void timer1_Tick(object sender, EventArgs e)
                {
                    lblDisplay.Text = DateTime.Now.ToLongTimeString();
                }
            }
        }
        
    
3.  è¿è¡Œä»¥åæ˜¯ä¸€ä¸ªç±»ä¼¼è®¾è®¡å™¨çš„é¡µé¢ï¼Œå³ä¾§ä¸ºæ§ä»¶å±æ€§ï¼Œå·¦ä¾§ä¸ºæ§ä»¶å†…å®¹ï¼š
    
    ![æ¼”ç¤º](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721095146883-1666987583.gif)
    

è¿™æ ·ä¸€ä¸ªç®€å•çš„å¤åˆæ§ä»¶ - `ctlClock`å°±å®Œæˆäº†ï¼Œæ€ä¹ˆåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å°±å’Œè°ƒç”¨ç¬¬ä¸‰æ–¹æ§ä»¶æ˜¯ç›¸ä¼¼çš„ï¼š

1.  æ–°å»ºä¸€ä¸ªæ–°çš„`Winform`å·¥ç¨‹ï¼š
    
    ![image-20230721095422852](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721095423501-398344990.png)
    
2.  åœ¨å·¥å…·ç®±æ–°å»ºä¸€ä¸ªé€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©é¡¹æ·»åŠ ä¸Šé¢æ—¶é’Ÿæ§ä»¶ç”Ÿæˆçš„`DLL`æ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥å°†æ–‡ä»¶æ‹–å…¥é€‰é¡¹å¡ä¸­ï¼š
    

â€‹ ![image-20230721095926060](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721095926562-1207980054.png)

![image-20230721111943274](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721111943934-2084721547.png)

3.  ç„¶åå°±å’Œæ­£å¸¸æ§ä»¶ä¸€æ ·ç”¨å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªæ—¶é’Ÿæ§ä»¶ï¼Œä½ æ‹–å…¥å¯ä»¥å‘ç°ä»–åœ¨è®¾è®¡å™¨é‡Œä¹Ÿæ˜¯ä¼šæ­£å¸¸èµ°æ—¶é—´çš„ï¼Œä¹‹åè°ƒæ•´è‡ªå®šä¹‰çš„æ—¶é’Ÿæ§ä»¶å°±å¯ä»¥åœ¨ä½¿ç”¨æ§ä»¶çš„çª—ä½“ä¸­æ˜¾ç°å‡ºæ¥ã€‚

![image-20230721112422540](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721112423169-251245501.png)

æ‰©å±•æ§ä»¶ - ç¤ºä¾‹
---------

ä¸Šé¢ç¤ºä¾‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸º`ctlClock`çš„æ—¶é’Ÿæ§ä»¶ï¼Œå®ƒåªæœ‰é’Ÿè¡¨åŠŸèƒ½ï¼Œæ€æ ·è®©å®ƒå¸¦æœ‰æŠ¥è­¦çš„åŠŸèƒ½å‘¢ï¼Œç»™`ctlClock`æ·»åŠ æŠ¥è­¦åŠŸèƒ½çš„è¿‡ç¨‹å°±æ˜¯æ‹“å±•æ§ä»¶çš„è¿‡ç¨‹ã€‚è¿™é‡Œéœ€è¦æˆ‘ä»¬æœ‰ä¸€äº›[C# é¢å‘å¯¹è±¡ - ç»§æ‰¿](https://www.cnblogs.com/BoiledYakult/p/17422301.html#%E7%BB%A7%E6%89%BF)çš„åŸºç¡€ï¼Œä»¥`MSDN`ä¸Šçš„ [ctlAlarmClock](https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/walkthrough-authoring-a-composite-control-with-visual-csharp?view=netframeworkdesktop-4.8#add-the-alarm-properties)ä¸ºä¾‹ã€‚

ç®€å•è¯´ä¸€ä¸‹ç»§æ‰¿ï¼šä¸€ä¸ªç±»å‹æ´¾ç”Ÿäºä¸€ä¸ªåŸºç±»å‹ï¼Œå®ƒæ‹¥æœ‰è¯¥åŸºç±»å‹çš„æ‰€æœ‰æˆå‘˜å­—æ®µå’Œå‡½æ•°ã€‚åœ¨å®ç°ç»§æ‰¿ä¸­ï¼Œæ´¾ç”Ÿç±»å‹é‡‡ç”¨åŸºç±»å‹çš„æ¯ä¸ªå‡½æ•°çš„å®ç°ä»£ç ï¼Œé™¤éåœ¨æ´¾ç”Ÿç±»å‹çš„å®šä¹‰ä¸­æŒ‡å®šé‡å†™æŸä¸ªå‡½æ•°çš„å®ç°ä»£ç ã€‚ä¸€èˆ¬åœ¨éœ€è¦ç»™ç°æœ‰ç±»å‹æ·»åŠ åŠŸèƒ½æ—¶ä½¿ç”¨ç»§æ‰¿ã€‚

å…·ä½“ç¼–ç å°±ä¸è¯´äº†ï¼Œ`MSDN`ä¸Šéƒ½æœ‰ï¼Œåœ¨åŸæœ‰`ctlClock`åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸€ä¸ªæŒ‡ç¤ºæŠ¥è­¦çš„`Label:lblAlarm`ï¼Œå¹¶é‡å†™äº†`ctlClock`çš„`timer1_Tick`ï¼š

    using System;
    using System.Drawing;
    
    namespace ctlClockLib
    {
        public partial class ctlAlarmClock : ctlClock
        {
            private DateTime dteAlarmTime;
            private bool blnAlarmSet;
            private bool blnColorTicker;
            public ctlAlarmClock()
            {
                InitializeComponent();
            }
    
            public DateTime AlarmTime { get => dteAlarmTime; set => dteAlarmTime = value; }
            public bool AlarmSet { get => blnAlarmSet; set => blnAlarmSet = value; }
            protected override void timer1_Tick(object sender, EventArgs e)
            {
                base.timer1_Tick(sender, e);// åŸºç±»ä¸­çš„timer1_TickåŠŸèƒ½æ­£å¸¸è¿è¡Œ
                if (AlarmSet == false)
                    return;
                else
                {
                    if (AlarmTime.Date == DateTime.Now.Date && AlarmTime.Hour ==
                        DateTime.Now.Hour && AlarmTime.Minute == DateTime.Now.Minute)
                    {
                        lblAlarm.Visible = true;
                        if (blnColorTicker == false)	// æ ¹æ®blnColorTickeräº¤æ›¿æ”¹å˜lblAlarmèƒŒæ™¯é¢œè‰²
                        {
                            lblAlarm.BackColor = Color.Red;
                            blnColorTicker = true;
                        }
                        else
                        {
                            lblAlarm.BackColor = Color.Blue;
                            blnColorTicker = false;
                        }
                    }
                    else
                    {
                        lblAlarm.Visible = false;
                    }
                }
            }
            private void lblAlarm_Click(object sender, EventArgs e)
            {
                AlarmSet = false;
                lblAlarm.Visible = false;
            }
        }
    }
    

é¡¹ç›®ç»“æ„ï¼š

![image-20230721151302793](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721151303571-1019710772.png)

`ctlTestDemo`è®¾è®¡å™¨ï¼š

![image-20230721151346541](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721151347152-1928397782.png)

è¿è¡Œ`ctlTestDemo`:

![æ¼”ç¤º](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230721151729247-853992967.gif)

å›åˆ°æ­£é¢˜ï¼Œæœ‰äº†ä¸Šé¢ä¾‹å­çš„åŸºç¡€ï¼Œæ¥å°è¯•ä¸€ä¸‹é€šè¿‡å¤åˆæ§ä»¶å®ç°`DataGridView` åˆ†é¡µåŠŸèƒ½ã€‚

SuperGridView
-------------

å‚ç…§ [C# datagridviewåˆ†é¡µåŠŸèƒ½ - æ²¡äº‹å†™ä¸ªBug - éè‡ªå®šä¹‰æ§ä»¶](https://www.cnblogs.com/swjian/p/9889789.html) åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå¯ä»¥è‡ªå®šä¹‰æ•°æ®æºï¼Œåšäº†æ§ä»¶å¤§å°è‡ªé€‚åº”å¤„ç†ï¼ˆå°±æ˜¯é€šè¿‡`TableLayout`åšäº†ä¸‹å¤„ç†ï¼‰ï¼Œæ§ä»¶å - `SuperGridView`:

![image-20230722092009286](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230722092011131-473408320.png)

æ§ä»¶æ ·å¼å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šè¿‡`TableLayout`åšäº†è‡ªé€‚åº”çš„å¤„ç†ï¼š

![æ¼”ç¤º](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230722092146984-1285703252.gif)

æš´éœ²ä¸€ä¸ª`DataSource`å±æ€§ç”¨äºç»™`DataGridView`ç»‘å®šæ•°æ®æºï¼Œä¸€ä¸ª`PageSize`å±æ€§å¯ä»¥è°ƒæ•´`DataGridView`æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®é‡ï¼Œæ§ä»¶ä»£ç ï¼š

![image-20230722092538910](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230722092539402-121402087.png)

    using System;
    using System.ComponentModel;
    using System.Data;
    using System.Windows.Forms;
    
    namespace cassControl
    {
        public partial class SuperGridView : UserControl
        {
            private int pageSize = 30;  // æ¯é¡µè®°å½•æ•°
            private int recordCount = 0;    // æ€»è®°å½•æ•°
            private int pageCount = 0;  // æ€»é¡µæ•°
            private int currentPage = 0;    // å½“å‰é¡µæ•°
            private DataTable originalTable = new DataTable();  // æ•°æ®æºè¡¨
            private DataTable schemaTable = new DataTable();  // è™šæ‹Ÿè¡¨
    
            public SuperGridView()
            {
                InitializeComponent();
                InitializeDataGridzview();
            }
    
            private void InitializeDataGridzview()
            {
                dgv.AutoGenerateColumns = true;
                dgv.AllowUserToAddRows = false;
                dgv.AllowUserToResizeRows = false;
                dgv.ReadOnly = true;
                dgv.RowHeadersVisible = true;
                dgv.DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                dgv.ColumnHeadersDefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
            }
    
            [Category("DataSource"), Description("æŒ‡ç¤º DataGridView æ§ä»¶çš„æ•°æ®æºã€‚")]
            public object DataSource
            {
                get { return OriginalTable; }
                set
                {
                    if (value is DataTable dt)
                    {
                        OriginalTable = dt;
                        dgv.DataSource = dt;
                        PageSorter();
                    }
                    else
                    {
                        throw new ArgumentException("Only DataTable is supported as DataSource.");
                    }
                }
            }
          
            [Category("PageSize"), Description("æŒ‡ç¤º DataGridView æ§ä»¶æ¯é¡µæ•°æ®é‡ã€‚")]
            public int PageSize { get => pageSize; set => pageSize = value; }
            private int RecordCount { get => recordCount; set => recordCount = value; }
            private int PageCount { get => pageCount; set => pageCount = value; }
            private int CurrentPage { get => currentPage; set => currentPage = value; }
            private DataTable OriginalTable { get => originalTable; set => originalTable = value; }
            private DataTable SchemaTable { get => schemaTable; set => schemaTable = value; }
    
            private void PageSorter()
            {
                RecordCount = OriginalTable.Rows.Count;
                this.lblCount.Text = RecordCount.ToString();
    
                PageCount = (RecordCount / PageSize);
    
                if ((RecordCount % PageSize) > 0)
                {
                    PageCount++;
                }
    
                //é»˜è®¤ç¬¬ä¸€é¡µ
                CurrentPage = 1;
    
                LoadPage();
            }
    
            private void LoadPage()
            {
                if (CurrentPage < 1) CurrentPage = 1;
                if (CurrentPage > PageCount) CurrentPage = PageCount;
    
                SchemaTable = OriginalTable.Clone();
    
                int beginRecord;
                int endRecord;
    
                beginRecord = PageSize * (CurrentPage - 1);
                if (CurrentPage == 1) beginRecord = 0;
                endRecord = PageSize * CurrentPage - 1;
                if (CurrentPage == PageCount) endRecord = RecordCount - 1;
    
                int startIndex = beginRecord;
                int endIndex = endRecord;
                for (int i = startIndex; i <= endIndex; i++)
                {
                    DataRow row = OriginalTable.Rows[i];
                    SchemaTable.ImportRow(row);
                }
    
                dgv.DataSource = SchemaTable;
            }
    
            private void btnNext_Click(object sender, EventArgs e)
            {
                if (CurrentPage == PageCount)
                { return; }
                CurrentPage++;
                LoadPage();
            }
    
            private void btnBegain_Click(object sender, EventArgs e)
            {
                if (CurrentPage == 1)
                { return; }
                CurrentPage = 1;
                LoadPage();
            }
    
            private void btnEnd_Click(object sender, EventArgs e)
            {
                if (CurrentPage == PageCount)
                { return; }
                CurrentPage = PageCount;
                LoadPage();
            }
    
            private void btnPre_Click(object sender, EventArgs e)
            {
                if (CurrentPage == 1)
                { return; }
                CurrentPage--;
                LoadPage();
            }
        }
    }
    

æ§ä»¶åŠŸèƒ½ï¼š

1.  æ§ä»¶å…·æœ‰è‡ªå®šä¹‰çš„æ•°æ®æºç»‘å®šåŠŸèƒ½ï¼Œé€šè¿‡ `DataSource` å±æ€§ç»‘å®š `DataTable` å¯¹è±¡ä½œä¸ºæ•°æ®æºã€‚
2.  æ§ä»¶æ”¯æŒåˆ†é¡µæ˜¾ç¤ºï¼Œå¯ä»¥æŒ‰ç…§æ¯é¡µå›ºå®šçš„è®°å½•æ•°æ˜¾ç¤ºæ•°æ®ã€‚
3.  æ§ä»¶çš„åˆ†é¡µåŠŸèƒ½åŒ…æ‹¬è·³è½¬åˆ°ç¬¬ä¸€é¡µã€ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µã€æœ€åä¸€é¡µï¼Œä»¥åŠæ˜¾ç¤ºæ€»è®°å½•æ•°ç­‰ã€‚
4.  æ§ä»¶ä¸­çš„æ•°æ®è¡¨æ ¼ (`DataGridView`) å¯ä»¥è‡ªåŠ¨ç”Ÿæˆåˆ—ï¼Œè¡¨ä¸­å†…å®¹é»˜è®¤å±…ä¸­æ˜¾ç¤º

å®æœºæ¼”ç¤º - ä¹Ÿè¿˜å‡‘åˆï¼Œè¯•äº†ä¸€ä¸‹è‡ªé€ äº†åä¸‡æ¡æ•°æ®ï¼Œä½†æ˜¯åœ¨åä¸‡æ¡æ•°æ®ä¸‹å¯ä»¥æ˜æ˜¾çœ‹åˆ°å†…å­˜æš´æ¶¨ï¼Œä»æœ€åˆçš„`22MB`æ¶¨åˆ°äº†`60MB`ğŸ˜‚ï¼Œå¥½åœ¨æˆ‘çš„åº”ç”¨åœºæ™¯ä¸‹æ•°æ®é‡ä¸å¤§ï¼š

![æ¼”ç¤º](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230722152618397-522302859.gif)

è¿™æ®µä»£ç åªå®ç°äº†ä¸€ä¸ªç®€å•çš„åˆ†é¡µæ•°æ®è¡¨æ ¼æ§ä»¶ï¼Œé€‚åˆå¤„ç†ä¸­å°è§„æ¨¡çš„æ•°æ®ã€‚å®ƒçš„ä¸»è¦ä¼˜ç‚¹æ˜¯ç®€åŒ–æ•°æ®ç»‘å®šå’Œæä¾›åˆ†é¡µæ˜¾ç¤ºï¼Œä½†ä»æœ‰æ”¹è¿›ç©ºé—´ï¼Œå°¤å…¶åœ¨å¤„ç†å¤§æ•°æ®é›†å’ŒåŠŸèƒ½æ‰©å±•æ–¹é¢ã€‚å¦‚æœåªæ˜¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä¸”æ•°æ®é‡ä¸å¤§ï¼Œè¿™ä¸ªæ§ä»¶å¯èƒ½å·²ç»è¶³å¤Ÿã€‚ç„¶è€Œï¼Œå¦‚æœéœ€è¦æ›´å¤šåŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥å¼€å‘å’Œä¼˜åŒ–ï¼Œæ¯”å¦‚å¯ä»¥åŠ ä¸Šé¡µé¢ï¼Œé¡µç è‡ªåŠ¨è·³è½¬ä¹‹ç±»çš„ï¼Œè¿˜æœ‰å†…å­˜å ç”¨é—®é¢˜ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯åœ¨è®¾è®¡å™¨é‡Œä¸èƒ½æš´éœ²å‡ºæ¥`DataGridView ä»»åŠ¡`æ“ä½œé€‰é¡¹ï¼Œéœ€è¦é€šè¿‡åå°ä»£ç å®Œæˆæ•°æ®æ˜¾ç¤ºçš„ç»‘å®šï¼Œæˆ‘åœ¨æƒ³æ˜¯ä¸æ˜¯å¯ä»¥ä¸ç›´æ¥ç”¨`DataGridView`å‘¢ï¼Œåªç”¨ä¸‹æ–¹çš„æ“ä½œæ å‘¢ï¼Ÿ

PagerControl
------------

ç”¨ä¸Šé¢çš„æ€è·¯è¯•ä¸€è¯•ç»„åˆä¸€ä¸ªæ“ä½œæ å‡ºæ¥ï¼Œä¸ºäº†å¥½çœ‹ä¸€ç‚¹ï¼Œè¿™æ¬¡æ¢æˆç»„åˆ`CSkin`çš„æ§ä»¶ã€‚

æ ·å¼å’Œä¸Šé¢å‡ ä¹ä¸€è‡´ï¼Œæ²¡æœ‰æ”¾æ¯é¡µæ¡æ•°çš„é…ç½®é¡¹ï¼Œè¿™ä¸ªæ‰“ç®—ä½œä¸ºä¸€ä¸ªå±æ€§æ”¾å‡ºæ¥ï¼š

![image-20230722164342118](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230722164343027-920109522.png)

æˆ‘çš„æ€è·¯æ˜¯ç»™æ§ä»¶ä¸€ä¸ªæ•°æ®æºï¼Œç”¨äºç»‘å®šé¡µé¢ä¸­çš„`DataGridView`ï¼Œç„¶åè·å–åˆ°æ•°æ®ä»¥åå’Œä¹‹å‰ä¸€æ ·ï¼Œå› ä¸ºä½¿ç”¨åœºæ™¯ä¸‹æ•°æ®é‡ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œæ‰€ä»¥å°±åŒæ ·æ²¿ç”¨ä¸Šé¢çš„æ€è·¯ã€‚

è¿™é‡Œéœ€è¦æš´éœ²ä¸€ä¸ªé…ç½®é¡¹ç”¨äºç»‘å®šé¡µé¢ä¸Šçš„`DataGridView`éœ€è¦ç”¨åˆ°è®¾è®¡æ—¶çš„ä¸€äº›ç‰¹æ€§(Attribute)ï¼Œè¿™äº›è®¾è®¡æ—¶çš„ç‰¹æ€§(Attribute)åœ¨`C#`å’Œç±»ä¼¼çš„è¯­è¨€ä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ï¼Œç”¨äºå½±å“æ§ä»¶åœ¨è®¾è®¡æ—¶çš„è¡¨ç°å’Œè¡Œä¸ºï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå¼€å‘è€…ä¾¿åˆ©ï¼š

![image-20230722171508710](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230722171509500-682546184.png)

> *   [Windows çª—ä½“æ§ä»¶ä¸­çš„ç‰¹æ€§](https://learn.microsoft.com/zh-cn/dotnet/desktop/winforms/controls/attributes-in-windows-forms-controls?view=netframeworkdesktop-4.8)

OKï¼Œç†æƒ³å¾ˆä¸°æ»¡ï¼Œç°å®å¾ˆéª¨æ„Ÿã€‚é€šè¿‡ç»‘å®šç»‘å®šé¡µé¢ä¸­çš„`DataGridView`è·å–æ•°æ®ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘æ§åˆ¶åˆ†é¡µçš„æ–¹å¼æ˜¯é€šè¿‡ç»™`DataGridView`æ›´æ¢å¤„ç†ä¹‹åçš„`DataSource`æ•°æ®è¡¨ï¼Œè¿™å°±å¯¼è‡´æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä¸çŸ¥é“`DataGridView`ä»€ä¹ˆæ—¶å€™ä¼šç»‘å®šæ•°æ®ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜æˆ‘èƒ½æƒ³åˆ°çš„å°±æ˜¯ç›‘å¬æ•°æ®æºçš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡`DataGridView`çš„`DataSourceChanged`äº‹ä»¶ï¼Œä½†è¿™å°±å¯¼è‡´æˆ‘åœ¨å®ç°åˆ†é¡µæ•ˆæœçš„æ—¶å€™ä¹Ÿä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œé€»è¾‘ä¼šé™·å…¥ä¸€ä¸ªæ­»å¾ªç¯é‡Œé¢ã€‚ã€‚ã€‚

æ¢ä¸€ç§æ–¹å¼ï¼Œæ¸…ç©º`DataGridView`è¡¨ä¸­æ•°æ®ç„¶åä¸€è¡Œä¸€è¡Œçš„åŠ `Clear()`æ–¹æ³•åˆä¼šæŠ¥é”™ï¼š

    // å‡è®¾å·²ç»æœ‰ä¸€ä¸ªDataGridViewæ§ä»¶åä¸ºdataGridViewToBind
    // å‡è®¾å·²ç»æœ‰ä¸€ä¸ªDataTableåä¸ºnewDataTable
    
    // æ¸…ç©ºè¡¨æ ¼ä¸­çš„å†…å®¹
    dataGridView1.Rows.Clear(); 
    dataGridView1.Refresh();
    
    // æ·»åŠ æ–°çš„DataTableæ•°æ®
    foreach (DataRow row in newDataTable.Rows)
    {
        dataGridViewToBind.Rows.Add(row.ItemArray);
    }
    

ä¸€é€šæŠ“è€³æŒ è…®ä¹‹åï¼Œæˆ‘è§‰å¾—æ¢ä¸€ç§æ€è·¯ï¼šåªæ“ä½œ`DataGridView`ä¸Šæ˜¾ç¤ºçš„å†…å®¹ï¼Œå½“ç„¶ä¹Ÿæ˜¯é€šè¿‡æ›´æ”¹å®ƒçš„`DataSource`æ¥å®Œæˆï¼Œè·å–`DataGridView`çš„æ•°æ®æºé‡‡ç”¨ä¹‹å‰çš„æ€è·¯ï¼Œæ§ä»¶ç»™ä¸€ä¸ªæ•°æ®æºå±æ€§ï¼Œæ¯æ¬¡æ›´æ”¹`DataGridView`çš„æ•°æ®æºçš„æ—¶å€™ä¹Ÿé¡ºè·¯æ“ä½œä¸€ä¸‹æ§ä»¶çš„æ•°æ®æºï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨æ§ä»¶å†…éƒ¨ç›‘å¬`DataGridView`æ•°æ®æºçš„å˜åŒ–äº†ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°æˆ‘åœ¨æ“ä½œ`DataGridView`çš„æ—¶å€™ç¨‹åºé™·å…¥æ­»å¾ªç¯çš„é—®é¢˜ã€‚

All Rightã€‚æ¥è¯´è¯´æ€ä¹ˆæçš„ï¼Œæ›´ä¹‹å‰é‚£ä¸ªç›¸æ¯”æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå› ä¸ºæ˜¯ç»™ä¸€ä¸ª`n`å¹´å‰çš„`winform`é¡¹ç›®åšçš„ï¼Œæ‰€ä»¥è¿™é‡Œ`DataGridView`æ”¹ä¸º`CSkin`çš„`SkinDataGridView`è¿˜æœ‰å°±æ˜¯æ•°æ®æºï¼Œç¨‹åºç”¨çš„`DataTable`è¿™é‡Œä¹Ÿå°±ç”¨\`\`DataTable`äº†ï¼Œä½†æ˜¯æ•°æ®æºé‚£é‡Œæ”¾çš„`object\`ç±»å‹ï¼Œå¯ä»¥æ‰©å±•å…¶ä»–ç±»å‹æ•°æ®ï¼š

![image-20230724115650395](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230724170846791-1707022561.png)

    using CCWin.SkinControl;
    using System;
    using System.ComponentModel;
    using System.Data;
    using System.Text.RegularExpressions;
    using System.Windows.Forms;
    
    namespace cassControl
    {
        public partial class PagerControl : UserControl
        {
            public PagerControl()
            {
                InitializeComponent();
            }
    
            #region fields, properties
    
            private int pageCount;
            private int dataCount;
            private int pageSize = 50;
            private int currentPage;
    
            private DataTable dataSourceTable;
            private DataTable tempTable;
    
            private SkinDataGridView dataGridViewToBind;
    
            [Browsable(true)]
            [Category("PagerControl")]
            [Description("ä¸º PagerControl ç»‘å®š DataGridView æ•°æ®é¡¹")]
            public SkinDataGridView DataGridView
            {
                get { return dataGridViewToBind; }
                set
                {
                    dataGridViewToBind = value;
                }
            }
    
            [Browsable(false)]
            public object DataSource    // æ•°æ®ç±»å‹å¯ä»¥æ‰©å±•
            {
                get { return dataSourceTable; }
                set
                {
                    if (value is DataTable dt)
                    {
                        dataSourceTable = dt;
                        PageSorter();
                    }
                    else
                    {
                        return;
                    }
                }
            }
    
            [Browsable(false)]
            public int CurrentPage { get => currentPage; set => currentPage = value; }
    
            [Browsable(false)]
            public int PageCount { get => pageCount; set => pageCount = value; }
    
            [Browsable(false)]
            public int DataCount { get => dataCount; set => dataCount = value; }
    
            [Browsable(true)]
            [Category("PagerControl")]
            [Description("è®¾ç½®æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®é‡")]
            public int PageSize
            {
                get => pageSize;
                set
                {
                    if (value <= 0)
                    {
                        pageSize = 50;  // é»˜è®¤æ˜¾ç¤º50æ¡æ•°æ®
                    }
                    else { pageSize = value; }
                }
            }
    
            #endregion fields, properties
    
            #region methods
    
            private void PageSorter()
            {
                DataCount = dataSourceTable.Rows.Count;
                lblDataCount.Text = DataCount.ToString();
                PageCount = (DataCount / PageSize);
                if ((DataCount % PageSize) > 0)
                {
                    PageCount++;
                }
                lblPageCount.Text = PageCount.ToString();
                CurrentPage = 1;
                lblCurrentPage.Text = CurrentPage.ToString();
                SetCtlEnabled(true);
                LoadPage();
            }
    
            private void LoadPage()
            {
                if (CurrentPage < 1) CurrentPage = 1;
                if (CurrentPage > PageCount) CurrentPage = pageCount;
    
                tempTable = dataSourceTable.Clone();
    
                int beginIndex, endIndex;
    
                if (CurrentPage == 1)
                {
                    beginIndex = 0;
                }
                else { beginIndex = PageSize * (CurrentPage - 1); }
                if (CurrentPage == PageCount)
                {
                    endIndex = DataCount - 1;
                }
                else { endIndex = PageSize * CurrentPage; }
                lblCurrentPage.Text = CurrentPage.ToString();
                txtTargetPage.Text = CurrentPage.ToString();
                for (int i = beginIndex; i < endIndex; i++)
                {
                    DataRow row = dataSourceTable.Rows[i];
                    tempTable.ImportRow(row);
                }
                dataGridViewToBind.DataSource = tempTable;
            }
    
            private void SetCtlEnabled(bool status)
            {
                btnFirstpage.Enabled = status;
                btnNextpage.Enabled = status;
                btnPreviouspage.Enabled = status;
                btnLastpage.Enabled = status;
                txtTargetPage.Enabled = status;
                btnSwitchPage.Enabled = status;
            }
    
            #endregion methods
    
            #region events
    
            private void btnFirstpage_Click(object sender, EventArgs e)
            {
                if (CurrentPage == 1)
                { return; }
                CurrentPage = 1;
                LoadPage();
            }
    
            private void btnPreviouspage_Click(object sender, EventArgs e)
            {
                if (CurrentPage == 1)
                { return; }
                CurrentPage--;
                LoadPage();
            }
    
            private void btnNextpage_Click(object sender, EventArgs e)
            {
                if (CurrentPage == PageCount)
                { return; }
                CurrentPage++;
                LoadPage();
            }
    
            private void btnLastpage_Click(object sender, EventArgs e)
            {
                if (CurrentPage == PageCount)
                { return; }
                CurrentPage = PageCount;
                LoadPage();
            }
    
            private void btnSwitchPage_Click(object sender, EventArgs e)
            {
                int num = 0;
                int.TryParse(txtTargetPage.Text.Trim(), out num);
                CurrentPage = num;
                LoadPage();
            }
    
            private void txtTargetPage_KeyPress(object sender, KeyPressEventArgs e)
            {
                string pattern = @"[0-9]";
                Regex regex = new Regex(pattern);
                if (!regex.IsMatch(e.KeyChar.ToString()) && !char.IsControl(e.KeyChar))
                {
                    e.Handled = true;
                }
            }
    
            #endregion events
        }
    }
    

![image-20230724115743582](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230724115744307-1578526617.png)

å®¢æˆ·ç«¯ä½¿ç”¨ï¼š

    DataTable dataTable = new DataTable();
    dataTable.Columns.Add("ID", typeof(int));
    dataTable.Columns.Add("Name", typeof(string));
    dataTable.Columns.Add("Age", typeof(string));
    dataTable.Columns.Add("Age1", typeof(string));
    								......
    dataTable.Columns.Add("Age15", typeof(string));
    for (int i = 1; i <= 100000; i++)
    {
      DataRow newRow = dataTable.NewRow();
      newRow["ID"] = i;
      newRow["Name"] = "Name_" + i;
      newRow["Age"] = i * 1.2;
      dataTable.Rows.Add(newRow);
    }
    superGridView1.DataSource = dataTable;
    skinDataGridView1.DataSource = dataTable;
    pagerControl1.DataSource = dataTable;
    

![æ¼”ç¤º](https://img2023.cnblogs.com/blog/2913706/202307/2913706-20230724163242620-1515374396.gif)

å¤§è‡´ä¸Šå°±è¿™ä¸ªæ ·å­ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´çš„ğŸŒ

`Demo`çš„ä»£ç ä¸Šä¼ åˆ°`GitHub`äº†ï¼Œæ„Ÿå…´è¶£çš„å‹å‹ä»¬å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š[PagerControl](https://github.com/Boiled-Yakult/PagerControl.git)

> è¿˜æœ‰ä¸€ä»¶äº‹ï¼ŒçœŸçš„å¾ˆè®¨åŒç»´æŠ¤`N`å¹´å‰è€å¸ˆå‚…å†™çš„é¡¹ç›®ï¼Œå¤ªç—›è‹¦äº†ğŸ˜­ğŸ˜­ğŸ˜­

å‚è€ƒ
--

MSDNï¼š

*   [MSDN - Developing Custom Windows Forms Controls with the .NET Framework](https://learn.microsoft.com/en-us/dotnet/desktop/winforms/controls/developing-custom-windows-forms-controls?view=netframeworkdesktop-4.8)
    
*   [MSDN - Develop Windows Forms controls at design time](https://learn.microsoft.com/en-us/dotnet/desktop/winforms/controls/developing-windows-forms-controls-at-design-time?view=netframeworkdesktop-4.8)
    

æŠ€æœ¯åšæ–‡ï¼š

*   [Winformæ§ä»¶å¼€å‘æ€»ç»“ç›®å½• - ç™½è¯Programing](https://www.cnblogs.com/guanjinke/archive/2007/03/14/675103.html)
    
*   [C# Winformå¼€å‘ä»¥åŠæ§ä»¶å¼€å‘çš„éœ€è¦æ³¨æ„çš„ï¼Œè¢«äººé—®æ€•äº†ï¼Œéƒ½æ˜¯åŸºç¡€å¸¸è¯† - DSkin](https://www.cnblogs.com/dskin/p/4783574.html)
    
*   [é”‹åˆ©çš„C# - ä»£ç è¿·é€”](https://juejin.cn/column/7025861701295685662)
    
*   [æµ…è°ˆWinformæ§ä»¶å¼€å‘ï¼ˆä¸€ï¼‰ï¼šä½¿ç”¨GDI+ç¾åŒ–åŸºç¡€çª—å£ - \_\_Meow](https://www.cnblogs.com/CoffeeMX/p/14368052.html)
    
*   [C# datagridviewåˆ†é¡µåŠŸèƒ½ - æ²¡äº‹å†™ä¸ªBug - éè‡ªå®šä¹‰æ§ä»¶](https://www.cnblogs.com/swjian/p/9889789.html)
    
*   [WinFormè½»æ¾å®ç°è‡ªå®šä¹‰åˆ†é¡µï¼ˆè½¬è½½ï¼‰](https://www.cnblogs.com/qq260250932/p/5507530.html)
    
*   [WinFormä¸‹ç¼–å†™åˆ†é¡µæ§ä»¶ï¼Œå®ç°DataGridViewçš„åˆ†é¡µæ•ˆæœ - ç‰›è¿è¿](https://blog.csdn.net/u010028869/article/details/39616775)