---
layout: post
title: "åŸºäºuni-app+vue3æ¸²æŸ“markdownæ ¼å¼|uniappè½¯é”®ç›˜é¡¶èµ·é—®é¢˜è§£å†³æ–¹æ¡ˆ"
date: "2023-06-25T01:42:00.579Z"
---
åŸºäºuni-app+vue3æ¸²æŸ“markdownæ ¼å¼|uniappè½¯é”®ç›˜é¡¶èµ·é—®é¢˜è§£å†³æ–¹æ¡ˆ
============================================

å‰äº›æ—¶å€™æœ‰ç»™å¤§å®¶åˆ†äº«ä¸€ç¯‡[uni-app+vite4+uview-plusæ­å»ºè·¨ç«¯](https://www.cnblogs.com/xiaoyan2017/p/17487018.html)é¡¹ç›®ã€‚ä»Šå¤©ä¸»è¦åˆ†äº«ä¸‹åœ¨uniappä¸­æ¸²æŸ“markdownè¯­æ³•åŠuniappä¸­è½¯é”®ç›˜å¼¹èµ·ï¼Œé¡µé¢tabbaræˆ–é¡¶éƒ¨è‡ªå®šä¹‰navbarå¯¼èˆªæ è¢«æ’‘èµ·æŒ¤å‹çš„é—®é¢˜ã€‚

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625081854178-1749525320.jpg)

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625081623909-996917660.jpg)

å¦‚ä¸Šå›¾ï¼šæ”¯æŒ**h5+å°ç¨‹åº+Appç«¯markdownè§£æ**æ¸²æŸ“ã€‚

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625082127594-1754336575.gif)

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625082232994-503235810.gif)

ä¸Šé¢åˆ™æ˜¯æ¼”ç¤ºäº†åœ¨Appç«¯+å°ç¨‹åºç«¯é”®ç›˜å¼¹èµ·ï¼Œæ•´ä½“é¡µé¢åŠè‡ªå®šä¹‰å¯¼èˆªæ¡ä¸ä¼šè¢«é¡¶è·‘çš„é—®é¢˜ã€‚

å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œæ¥ä¸‹æ¥å°±ä¸»è¦ä»‹ç»ä¸‹å¦‚ä½•å®ç°çš„å§ã€‚

### uniapp+vue3è§£æmarkdownè¯­æ³•/é«˜äº®

è™½è¯´uniappæ’ä»¶å¸‚åœºä¹Ÿæœ‰ä¸€äº›markdownæ¸²æŸ“æ’ä»¶ï¼Œä½†å¤§å¤šå…¼å®¹æ€§ä¸å¥½ã€‚äºæ˜¯å°±ä½¿ç”¨äº†markdown-itåŠhighlight.jsæ’ä»¶è¿›è¡Œäº†ç®€å•çš„å°è£…å¤„ç†ã€‚ç»è°ƒè¯•ç›®å‰å¯ä»¥æ”¯æŒh5/å°ç¨‹åº/Appç«¯çš„markdownè¯­æ³•è§£æã€‚

// å¼•å…¥markdown-itå’Œhighlight.jsæ’ä»¶
import MarkdownIt from '@/plugins/markdown-it.min.js'
import hljs from '@/plugins/highlight/highlight.min.js'
// import '@/plugins/highlight/github-dark.min.css'
import '@/plugins/highlight/atom-one-light.css'
import parseHtml from '@/plugins/html-parser.js'

highlight.jsé«˜äº®æ ·å¼å¤§å®¶å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œä¸‹è½½ï¼Œè¿™é‡Œä½¿ç”¨çš„æµ…è‰²æ ·å¼ã€‚

*   **åˆå§‹åŒ–markdownItæ’ä»¶**

æ¥ä¸‹æ¥æ˜¯åˆå§‹åŒ–markdownåŠè¯­æ³•é«˜äº®ã€å¢åŠ ä»£ç è¡Œå·åŠŸèƒ½ã€‚

const markdown = MarkdownIt({
   html: true,
   highlight: function(str, lang) {
    let preCode \= ""
    try {
      preCode \= hljs.highlightAuto(str).value
    } catch (err) {
      preCode \= markdown.utils.escapeHtml(str);
    }
    // è‡ªå®šä¹‰è¡Œå·
    const lines = preCode.split(/\\n/).slice(0, -1)
    let html \= lines.map((item, index) => {
      // å»æ‰ç©ºè¡Œ
      if( item == ''){
        return ''
      }
      return '<li><span class="line-num" data-line="' + (index + 1) + '"></span>' + item +'</li>'
    }).join('')
    html \= '<ol style="padding: 0px 30px;">' + html + '</ol>'
    
    // ä»£ç å¤åˆ¶
    copyCode.push(str)
    let htmlCode \= \`<div class="markdown-wrap">\`
      // #ifndef MP-WEIXIN
        htmlCode += \`<div style="color: #aaa;text-align: right;font-size: 12px;padding:8px;">\`
          htmlCode += \`${lang}<a class="copy-btn" code-data-index="${copyCode.length - 1}" style="margin-left: 8px;">å¤åˆ¶ä»£ç </a>\`
        htmlCode += \`</div>\`
      // #endif
        htmlCode += \`<pre class="hljs" style="padding:0 8px;margin-bottom:5px;overflow: auto;border-radius: 5px;"><code>${html}</code></pre>\`;
      htmlCode += '</div>'
    return htmlCode
  }
})

*   **æ¸²æŸ“markdownç»“æ„**

const parseNodes = (value) => {
   if(!value) return
   
   let htmlString \= ''
  if (value.split("\`\`\`").length % 2) {
    let msgContent \= value
    if(msgContent\[msgContent.length-1\] != '\\n'){
      msgContent += '\\n'
    }
    htmlString \= markdown.render(msgContent)
  } else {
    htmlString \= markdown.render(msgContent.value)
  }
  
  // #ifndef APP-NVUE
  return htmlString
  // #endif
  
  // nvueæ¨¡å¼ä¸‹å°†htmlStringè½¬æˆhtmlArrayï¼Œå…¶ä»–æƒ…å†µrich-textå†…éƒ¨è½¬
  // æ³¨ï¼šæœ¬ç¤ºä¾‹é¡¹ç›®è¿˜æ²¡ä½¿ç”¨nvueç¼–è¯‘
  // #ifdef APP-NVUE
  return parseHtml(htmlString)
  // #endif
}

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625083602081-1912030801.jpg)

æœ€åä½¿ç”¨rich-textç»„ä»¶æ¥æ¸²æŸ“å¤„ç†åçš„ç»“æœã€‚

<rich-text space\="nbsp" :nodes\="parseNodes(item.content)" @itemclick\="handleItemClick"\></rich-text\>

ä»£ç å¤åˆ¶åŠŸèƒ½åˆ™æ˜¯ä½¿ç”¨rich-textæä¾›çš„itemclickæ–¹æ³•æ¥å®ç°ã€‚

// å¤åˆ¶ä»£ç 
const handleItemClick = (e) => {
  let {attrs} \= e.detail.node
  let {"code-data-index": codeDataIndex, "class": className} = attrs
  if(className == 'copy-btn'){
    uni.setClipboardData({
      data:copyCode\[codeDataIndex\],
      showToast:false,
      success() {
        uni.showToast({
          title: 'å¤åˆ¶æˆåŠŸ',
          icon: 'none'
        });
      }
    })
  }
}

é€šè¿‡ä¸Šé¢å‡ æ­¥ï¼ŒåŸºæœ¬å°±å®ç°äº†è§£æmarkdownè¯­æ³•äº†ã€‚

å¦‚æœå¤§å®¶æœ‰ä¸€äº›å…¶å®ƒä¸é”™çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿äº¤æµè®¨è®ºåˆ†äº«å“ˆ~~

### uni-appè½¯é”®ç›˜æ’‘èµ·é¡¶è·‘é—®é¢˜

åœ¨ä½¿ç”¨uniappå¼€å‘çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°inputè¾“å…¥æ¡†é”®ç›˜ä¼šé¡¶è·‘é¡µé¢ã€‚å¯¼è‡´é¡¶éƒ¨è‡ªå®šä¹‰å¯¼èˆªæ ä¼šä¸è§äº†ã€‚

æ¥ä¸‹æ¥å°±ä»‹ç»ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œç»æµ‹è¯•æ˜¯å¯è¡Œçš„ï¼Œå¦‚æœå¤§å®¶æœ‰å…¶å®ƒæ–¹æ³•ï¼Œä¹Ÿæ¬¢è¿äº¤æµåˆ†äº«ã€‚

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625084656847-1517998451.png)

è¯´ç™½äº†ï¼Œå°±æ˜¯åœ¨inputç¼–è¾‘æ¡†å¤–å±‚åŠ ä¸€ä¸ªviewæ ‡ç­¾ï¼Œç„¶åç»™è®¾ç½®padding-bottomä¸ºé”®ç›˜å¼¹èµ·é«˜åº¦ã€‚

uniappä¹Ÿæä¾›äº†ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–å‡½æ•°Â uni.onKeyboardHeightChangeÂ 

const fixPaddingBottom = computed(() => {
  let keyH \= keyboardHeight.value > 50 ? keyboardHeight.value - 50 : keyboardHeight.value
  return (keyH || 10) + 'px'
})

è¿™é‡Œå‡å»50æ˜¯åº•éƒ¨æœ‰è‡ªå®šä¹‰tabbarï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚

onMounted(() => {
  nextTick(() \=> {
    scrollToLast()
  })
  
  // #ifndef H5
  uni.onKeyboardHeightChange(e => {
    keyboardHeight.value \= e.height
    // åœ¨domæ¸²æŸ“å®Œæ¯• æ»šåŠ¨åˆ°æœ€åä¸€æ¡æ¶ˆæ¯
    nextTick(() => {
      scrollToLast()
    })
  })
  // #endif
})

ç›®å‰é€šè¿‡è¿™ç§æ–¹æ³•è§£å†³äº†é”®ç›˜æ’‘èµ·é—®é¢˜ã€‚å¦‚æœå¤§å®¶æœ‰å…¶å®ƒè§£å†³æ–¹æ³•ï¼Œæ¬¢è¿ä¸‹æ–¹ç•™è¨€è®¨è®ºå“ˆ~~ğŸ’

![](https://img2023.cnblogs.com/blog/1289798/202306/1289798-20230625085415872-266031454.gif)

æœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œæœªç»åšä¸»å…è®¸ä¸å¾—è½¬è½½ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµ QQï¼ˆ282310962ï¼‰ wxï¼ˆxy190310ï¼‰