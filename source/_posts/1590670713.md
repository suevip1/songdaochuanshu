---
layout: post
title: "OpenSSHç‰ˆæœ¬å‡çº§æ¼æ´ä¿®å¤é—®é¢˜"
date: "2023-08-23T00:55:09.697Z"
---
OpenSSHç‰ˆæœ¬å‡çº§æ¼æ´ä¿®å¤é—®é¢˜
=================

*   ğŸ‘‹ Hi, Iâ€™m @Merbelue

å¤§å®¶å¥½ï¼Œè¿™ç¯‡ä¸ºå¤§å®¶ä»‹ç»äºŒè¿›åˆ¶æ–¹å¼å¯¹OpenSSHç‰ˆæœ¬å‡çº§ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨äºè§£å†³ç‰ˆæœ¬å‡çº§ã€æ¼æ´ä¿®å¤ç­‰ã€‚

@

ç›®å½•

*   [1ã€ç¯å¢ƒ](#1ç¯å¢ƒ)
*   [2ã€å®‰è£…telnet](#2å®‰è£…telnet)
    *   [2.1ã€æ£€æŸ¥æ˜¯å¦å®‰è£…](#21æ£€æŸ¥æ˜¯å¦å®‰è£…)
    *   [2.2ã€å®‰è£…telnetåŒ…](#22å®‰è£…telnetåŒ…)
    *   [2.3ã€å¯åŠ¨æœåŠ¡(å¯ä¸ç”¨åŠ å…¥å¼€æœºå¯åŠ¨ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ¥å†³å®š)](#23å¯åŠ¨æœåŠ¡å¯ä¸ç”¨åŠ å…¥å¼€æœºå¯åŠ¨æ ¹æ®è‡ªå·±éœ€æ±‚æ¥å†³å®š)
    *   [2.4ã€æµ‹è¯•è¿æ¥](#24æµ‹è¯•è¿æ¥)
*   [3ã€å‡çº§OpenSSHç‰ˆæœ¬](#3å‡çº§opensshç‰ˆæœ¬)
    *   [3.1ã€å®‰è£…ä¾èµ–](#31å®‰è£…ä¾èµ–)
    *   [3.2ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…](#32ä¸‹è½½äºŒè¿›åˆ¶åŒ…)
    *   [3.3ã€ç¼–è¯‘å®‰è£…ZlibåŒ…](#33ç¼–è¯‘å®‰è£…zlibåŒ…)
    *   [3.4ã€ç¼–è¯‘å®‰è£…OpenSSLåŒ…](#34ç¼–è¯‘å®‰è£…opensslåŒ…)
    *   [3.5ã€ç¼–è¯‘å®‰è£…OpenSSHåŒ…](#35ç¼–è¯‘å®‰è£…opensshåŒ…)
*   [4ã€ç‰ˆæœ¬å‡çº§éªŒè¯](#4ç‰ˆæœ¬å‡çº§éªŒè¯)
*   [5ã€å¯èƒ½é‡åˆ°å¾—é—®é¢˜åŠè§£å†³](#5å¯èƒ½é‡åˆ°å¾—é—®é¢˜åŠè§£å†³)
    *   [5.1ã€ç¼–è¯‘æœ‰æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æ²¡è£…gccï¼Œè¯·å‚è€ƒ3.1å®‰è£…ä¾èµ–](#51ç¼–è¯‘æœ‰æŠ¥é”™å¯èƒ½æ˜¯æ²¡è£…gccè¯·å‚è€ƒ31å®‰è£…ä¾èµ–)
    *   [5.2ã€ç¼–è¯‘OpenSSHæ—¶æŠ¥è¯ä¹¦æ— æ³•åŠ è½½ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹æƒé™](#52ç¼–è¯‘opensshæ—¶æŠ¥è¯ä¹¦æ— æ³•åŠ è½½å¯èƒ½éœ€è¦ä¿®æ”¹æƒé™)
    *   [5.3ã€é‡å¯sshæœåŠ¡ï¼Œæ— æ³•å¯åŠ¨æˆ–è€…ä¸€ç›´é‡å¯ï¼Œå¯èƒ½sshdä¸å…¼å®¹systemdé€ æˆçš„](#53é‡å¯sshæœåŠ¡æ— æ³•å¯åŠ¨æˆ–è€…ä¸€ç›´é‡å¯å¯èƒ½sshdä¸å…¼å®¹systemdé€ æˆçš„)

#### 1ã€ç¯å¢ƒ

*   ç³»ç»Ÿç‰ˆæœ¬ï¼šCentOS 7.6

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822142433.png)

*   OpenSSHã€OpenSSLç‰ˆæœ¬ï¼šOpenSSH\_7.4p1ã€OpenSSL 1.0.2k-fips

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822143340.png)

#### 2ã€å®‰è£…telnet

ç”±äºç”Ÿäº§ç¯å¢ƒä¸­å¯¹OpenSSHå‡çº§ä¼šå­˜åœ¨ä¸€å®šé£é™©ï¼Œå¯¼è‡´SSHè¿ä¸ä¸Šï¼Œæ‰€ä»¥åœ¨å‡çº§å‰å¯å®‰è£…telnetæœåŠ¡ï¼Œåœ¨å‡çº§å¤±è´¥æ—¶å¯ä»¥telnetè¿›è¡Œæ¢å¤ã€‚

##### 2.1ã€æ£€æŸ¥æ˜¯å¦å®‰è£…

    rpm -qa telnet-server 
    rpm -qa xinetd
    

##### 2.2ã€å®‰è£…telnetåŒ…

    yum -y install telnet
    yum -y install xinetd
    

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822144042.png)

##### 2.3ã€å¯åŠ¨æœåŠ¡(å¯ä¸ç”¨åŠ å…¥å¼€æœºå¯åŠ¨ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ¥å†³å®š)

    systemctl start xinetd.service
    systemctl start telnet.socket
    

##### 2.4ã€æµ‹è¯•è¿æ¥

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822144807.png)

#### 3ã€å‡çº§OpenSSHç‰ˆæœ¬

##### 3.1ã€å®‰è£…ä¾èµ–

    yum install wget gcc openssl-devel pam-devel rpm-build
    

##### 3.2ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…

*   OpenSSHæœ€æ–°ç‰ˆæœ¬åŒ…

ä¸‹è½½åœ°å€ï¼š[OpenSSHé˜¿é‡Œäº‘æºåœ°å€](https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/)

*   OpenSSLåŒ…

ä¸‹è½½åœ°å€ï¼š[OpenSSLå®˜ç½‘](https://www.openssl.org/source/old/)

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822150146.png) ![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822150237.png)

*   ZlibåŒ…

ä¸‹è½½åœ°å€ï¼š[Zlibä¸‹è½½åœ°å€](https://www.zlib.net/fossils/zlib-1.2.11.tar.gz)

##### 3.3ã€ç¼–è¯‘å®‰è£…ZlibåŒ…

    # è§£å‹
    tar -xvf zlib-1.3.tar.gz
    cd zlib-1.3/
    # ç¼–è¯‘å®‰è£…
    ./configure --prefix=/usr/local/zlib
    make && make install
    

##### 3.4ã€ç¼–è¯‘å®‰è£…OpenSSLåŒ…

    # è§£å‹
    tar -xvf openssl-1.1.1u.tar.gz
    # ç¼–è¯‘å®‰è£…
    ./config --prefix=/usr --shared
    make && make install
    

##### 3.5ã€ç¼–è¯‘å®‰è£…OpenSSHåŒ…

    # å¤‡ä»½ç°æœ‰SSH
    cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
    cp /usr/bin/sshd /usr/bin/sshd.bak
    cp /usr/sbin/sshd /usr/sbin/sshd.bak
    # è§£å‹
    tar -xvf openssh-9.4p1.tar.gz
    # ç¼–è¯‘å®‰è£…
    ./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-zlib=/usr/local/zlib --with-md5-passwords
    make && make install
    

#### 4ã€ç‰ˆæœ¬å‡çº§éªŒè¯

    # é‡å¯sshæœåŠ¡
    systemctl restart sshd
    # æŸ¥çœ‹ç‰ˆæœ¬
    ssh -V
    

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822160922.png)

#### 5ã€å¯èƒ½é‡åˆ°å¾—é—®é¢˜åŠè§£å†³

##### 5.1ã€ç¼–è¯‘æœ‰æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æ²¡è£…gccï¼Œè¯·å‚è€ƒ3.1å®‰è£…ä¾èµ–

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822160806.png)

##### 5.2ã€ç¼–è¯‘OpenSSHæ—¶æŠ¥è¯ä¹¦æ— æ³•åŠ è½½ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹æƒé™

![](https://merblue.oss-cn-chengdu.aliyuncs.com/blog_img/20230822161119.png)

è§£å†³æ–¹å¼ï¼š

    chmod 700 /etc/ssh/ssh_host_rsa_key
    chmod 700 /etc/ssh/ssh_host_ecdsa_key
    chmod 700 /etc/ssh/ssh_host_ed25519_key
    

##### 5.3ã€é‡å¯sshæœåŠ¡ï¼Œæ— æ³•å¯åŠ¨æˆ–è€…ä¸€ç›´é‡å¯ï¼Œå¯èƒ½sshdä¸å…¼å®¹systemdé€ æˆçš„

è§£å†³æ–¹å¼ï¼š

    # åœ¨OpenSSHå®‰è£…åŒ…ç›®å½•ä¸‹
    cp contrib/redhat/sshd.init /etc/init.d/sshd
    # ç§»é™¤sshd.serviceæ–‡ä»¶
    mv /usr/lib/systemd/system/sshd.service /usr/lib/systemd/system/sshd.service.bak
    # é‡æ–°åŠ è½½é…ç½®
    systemctl daemon-reload
    # æ·»åŠ å¼€æœºå¯åŠ¨
    chkconfig sshd on
    

ç»“æŸï¼šOpenSSHç‰ˆæœ¬å‡çº§ç»“æŸï¼Œå¸Œæœ›æ–‡ç« å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå–œæ¬¢çš„å¤§ä½¬ä¸‰è¿æ”¯æŒä¸€ä¸‹ï¼Œæ„Ÿè°¢ï¼