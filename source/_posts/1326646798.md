---
layout: post
title: "多行文本转成一行的实现方法"
date: "2023-07-11T01:16:54.711Z"
---
多行文本转成一行的实现方法
=============

哈喽大家好，我是咸鱼

不知道你们有没有遇到过下面的情况，以我为例

有时候我会收到批量操作服务器的需求，且我会拿到一个服务器 ip 列表，它是一个多行的形式，如下所示

    # ip 列表
    192.168.0.1
    192.168.0.2
    192.168.0.3
    192.168.0.4
    192.168.0.5
    192.168.0.6
    

但我使用 saltstack 进行批量操作时，我需要将上面的多行 ip 转成一行的形式才能执行 saltstack 命令

    192.168.0.1,192.168.0.2,192.168.0.3,192.168.0.4,192.168.0.5,192.168.0.6
    
    # saltstack 批量操作命令例子 
    salt -L '192.168.0.1,192.168.0.2,192.168.0.3,192.168.0.4,192.168.0.5,192.168.0.6' cmd.run 'ls -l'
    

如果是少量 ip，直接手动操作就行；如果 ip 数量特别多，手动转换的话就特别的麻烦了

下面我将介绍两个比较常见的多行文本转一行的实现方法，如果大家有更好的方法的话，欢迎大家积极讨论参与！

shell 命令实现
----------

`tr` 命令

`tr` 命令用于转换或删除文本中的字符，我们可以通过 `tr --help` 来查看它的帮助文档

下面是一些关于 `tr` 命令的例子

    #替换字符
    echo "hello" | tr 'o' 'a'   # 输出结果：hella
    
    #删除字符
    echo "hello" | tr -d 'l'   # 输出结果：heo
    
    #压缩连续字符：
    echo "hello" | tr -s 'l'   # 输出结果：helo
    

知道了这个命令的大概用法之后，我们就可以**通过 `tr` 命令来实现多行转一行**

    #命令如下：
    cat <<EOF | tr '\n' ','
    192.168.0.1
    192.168.0.2
    192.168.0.3
    192.168.0.4
    192.168.0.5
    192.168.0.6
    EOF
    

上面的命令可以分为两个部分，第一部分如下：

    #第一部分
    cat <<EOF 
    192.168.0.1
    192.168.0.2
    192.168.0.3
    192.168.0.4
    192.168.0.5
    192.168.0.6
    EOF
    

*   使用 `cat` 命令和 `<<EOF` 结构，它指示将下面的文本内容作为输入传递给 `cat` 命令
*   `EOF`：终止符，用于标识输入的结束

> EOF在Linux中是一种约定的标记，用于指示输入的结束，它在不同的上下文中有不同的用途
> 
> 在Here Document结构中，EOF用于标记输入文本的开始和结束；在文件输入中，EOF用于表示输入的结束

有关 Here Document 内容：[Here Document and Here String | Baeldung on Linux](https://www.baeldung.com/linux/heredoc-herestring)

上面命令输出如下：  
![image](https://img2023.cnblogs.com/blog/2958925/202307/2958925-20230710192239830-1843491203.png)

接下来我们来看第二部分

    #第二部分
    tr '\n' ','
    

使用 `tr` 命令，它将 `'\n'` （换行符）替换为逗号 `','` 。`tr` 命令用于字符转换，`'\n'` 是被替换的字符，`','` 是替换的字符

第一部分和第二部分通过管道符 `|` 连接起来，表示将 `cat` 命令的输出传递给 `tr` 命令处理

我们来看下输出结果  
![image](https://img2023.cnblogs.com/blog/2958925/202307/2958925-20230710192252775-4627302.png)

Notepad++ 实现
------------

这个方法适用于在 Windows 系统，用 Notepad 实现

把多行 IP 复制到 Notepad 中，然后选中内容——>输入查找目标和替换内容——>点击全部替换（注意下面的查找模式换成正则表达式）

![image](https://img2023.cnblogs.com/blog/2958925/202307/2958925-20230710192306644-1608248840.png)

*   `\r\n` 表示换行符，`(.+)` 表示匹配任意字符，且至少匹配一次
*   `\1` 表示引用查找到的文本，`,` 表示逗号

需要注意的是，替换换行符之前你得先知道文本内容中的换行符是 Windows 格式（`\r\n`） 还是 UNIX 格式（`\n`）

![image](https://img2023.cnblogs.com/blog/2958925/202307/2958925-20230710192316651-1410807042.png)