---
layout: post
title: "逍遥自在学C语言 | 指针陷阱-空指针与野指针"
date: "2023-06-26T01:24:12.888Z"
---
逍遥自在学C语言 | 指针陷阱-空指针与野指针
=======================

前言
--

在C语言中，指针是一种非常强大和灵活的工具，但同时也容易引发一些问题，其中包括空指针和野指针。

本文将带你了解这两个概念的含义、产生原因以及如何避免它们所导致的问题。

一、人物简介
------

*   第一位闪亮登场，有请今后会一直教我们C语言的老师 —— 自在。

![](https://img2023.cnblogs.com/blog/1511464/202306/1511464-20230606224237924-1818889158.gif)

*   第二位上场的是和我们一起学习的小白程序猿 —— 逍遥。

![](https://img2023.cnblogs.com/blog/1511464/202306/1511464-20230606224258922-622567244.gif)

二、空指针
-----

*   空指针是指不指向任何有效内存地址的指针。
    
*   在C语言中，可以用NULL宏来表示空指针。
    
*   当一个指针被赋值为NULL时，它不指向任何有效的内存位置。
    
*   下面是一个示例代码，演示了如何使用空指针：
    

    #include <stdio.h>
    
    int main() {
        int *ptr = NULL;  // 声明一个指向整数的空指针
    
        if (ptr == NULL) {
            printf("指针为空。\n");
        } else {
            printf("指针不为空。\n");
        }
    
        return 0;
    }
    
    

*   输出结果：

    指针为空。
    

*   在上述代码中，我们声明了一个指向整数的空指针`ptr`，并将其赋值为NULL。
    
*   然后，我们使用条件语句检查指针是否为空，并打印相应的消息。
    

三、野指针
-----

*   野指针是指指向未知、无效或已释放的内存位置的指针。
    
*   当一个指针被赋值为未初始化的值、已经释放的内存地址，或者指向一个不再有效的对象时，它就成为了野指针。
    
*   下面是一个示例代码，演示了野指针的行为：
    

    #include <stdio.h>
    
    int main() {
        int *ptr;  // 未初始化的指针
    
        *ptr = 42;  // 野指针的解引用
    
        printf("野指针的值: %d\n", *ptr);
    
        return 0;
    }
    
    

*   输出结果：

    Segmentation fault
    

*   在上述代码中，我们声明了一个未初始化的指针`ptr`，然后尝试对其进行解引用并赋值。
    
*   由于该指针没有指向任何有效的内存地址，这将导致程序崩溃并引发段错误。
    

四、空指针和野指针的产生
------------

空指针和野指针的产生主要源于以下几种情况：

### 1、空指针的产生

*   在声明指针时将其初始化为NULL：当我们声明一个指针但没有为其分配有效的内存地址时，可以将其初始化为NULL，表示该指针不指向任何有效的内存位置。
*   在释放内存后未将指针置为NULL：当我们释放了一个指针所指向的内存后，为了避免野指针的产生，应该将指针设置为NULL。否则，该指针将继续指向已经释放的内存位置，成为野指针。

### 2、 野指针的产生

*   未初始化的指针：当我们声明一个指针但未对其进行初始化时，该指针的值是未知的。
*   已释放的内存地址：当我们释放了一块内存后，如果仍然持有指向该内存地址的指针，并且对该指针进行解引用操作，就会导致野指针的产生。
*   指向超出作用域的局部变量：当一个指针指向了超出其所在作用域的局部变量时，当该指针被使用时就会产生野指针。这是因为当函数返回后，局部变量的内存将不再有效，但指针仍然保持指向该内存地址。

五、 空指针和野指针导致的问题
---------------

空指针和野指针可能导致以下问题：

*   程序崩溃：当野指针被解引用时，访问无效的内存位置可能导致程序崩溃，并引发诸如段错误等的运行时错误。
*   内存泄漏：如果指针被设置为指向一块已释放的内存，这将导致内存泄漏。内存泄漏会消耗系统资源，并可能导致程序性能下降或崩溃。
*   无法预测的行为：对空指针或野指针进行解引用操作会导致不可预测的行为，因为访问的内存位置是未知的。

六、避免产生野指针的方法
------------

*   初始化指针变量：在声明指针变量后，确保及时为其分配有效的内存地址。
*   及时释放内存并置空指针：在不再需要使用某个指针指向的内存时，及时释放该内存，并将指针设置为NULL。
*   避免越过作用域使用指针：确保指针不会超出其所在作用域范围。当指针指向局部变量时，确保在变量超出作用域前不再使用该指针。
*   注意指针的生命周期：在使用指针时，了解指针所指向的对象的生命周期。确保指针只在对象有效的时间段内使用，并在对象失效后避免使用指针。

小结
--

通过这篇文章，我们学会了

> 1、空指针的概念
> 
> 2、野指针的概念
> 
> 3、空指针和野指针的产生
> 
> 4、空指针和野指针导致的问题，避免野指针产生的方法。

> 📢欢迎各位 👍点赞 ⭐收藏 📝评论，如有错误请留言指正，非常感谢！