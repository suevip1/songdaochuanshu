---
layout: post
title: "vue3+vite2åŠ¨æ€ç»‘å®šå›¾ç‰‡ä¼˜é›…è§£å†³æ–¹æ¡ˆ"
date: "2023-08-24T00:55:15.828Z"
---
vue3+vite2åŠ¨æ€ç»‘å®šå›¾ç‰‡ä¼˜é›…è§£å†³æ–¹æ¡ˆ
======================

> ä¼˜é›…è§£å†³æ–¹æ¡ˆåœ¨æœ€ä¸‹é¢ï¼Œå°ä¼™ä¼´ä»¬å„¿å¯ä»¥ç›´æ¥å‰å¾€ ğŸ˜Š

èƒŒæ™¯
==

åœ¨vue3+vite2é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™æƒ³è¦åŠ¨æ€ç»‘å®šèµ„æºï¼Œæ¯”å¦‚åƒä¸‹é¢çš„ä»£ç è¿™æ ·ï¼š

    <template>
        <div>
    	    <!-- åŠ¨æ€ç»‘å®šå›¾ç‰‡èµ„æº -->
            <img :src="img_src">
        </div>
    </template>
    
    <script setup>
    import { ref } from 'vue';
    // é™æ€å›¾ç‰‡èµ„æº
    const img_src = ref('./1.jpg');
    </script>
    

å®é™…æ•ˆæœæ˜¯è¿™æ ·ï¼š

![](https://img2023.cnblogs.com/blog/3153981/202308/3153981-20230821233138692-1936237759.png)

åŸå› åˆ†æ
----

æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ§åˆ¶å°çš„æŠ¥é”™ä¿¡æ¯`GET http://127.0.0.1:5173/1.jpg 404 (Not Found)`

*   `GET`ï¼šè¡¨ç¤ºå‘æœåŠ¡å™¨è¯·æ±‚èµ„æºçš„æ–¹å¼ã€‚
*   `http://127.0.0.1:5173`ï¼šè¡¨ç¤ºä¸»æœºä¸ºé¡¹ç›®å¼€å¯çš„æœåŠ¡å™¨åœ°å€ä»¥åŠç«¯å£å·
*   `http://127.0.0.1:5173/1.jpg`ï¼šè¡¨ç¤ºå­˜æ”¾åœ¨æœåŠ¡å™¨ä¸­çš„å›¾ç‰‡èµ„æºåœ°å€ã€‚
*   `404 (Not Found)`ï¼šçŠ¶æ€ç ï¼Œ404è¡¨ç¤ºæ‰¾ä¸åˆ°èµ„æºã€‚

é—®é¢˜å°±å‡ºåœ¨`http://127.0.0.1:5173/1.jpg` è¿™é‡Œï¼Œé¡¹ç›®æ–‡ä»¶çš„è·¯å¾„æ˜¯`src/App.vue` ï¼Œå›¾ç‰‡çš„è·¯å¾„æ˜¯`src/1.jpg` ï¼Œå› æ­¤ï¼Œå›¾ç‰‡åœ¨æœåŠ¡å™¨ä¸Šçš„å­˜æ”¾è·¯å¾„å®é™…åº”è¯¥æ˜¯`http://127.0.0.1:5173/src/1.jpg` ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿™ä¸ªåœ°å€ã€‚

![](https://img2023.cnblogs.com/blog/3153981/202308/3153981-20230821233248431-661258897.png)

å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸè·å–äº†å›¾ç‰‡èµ„æºã€‚

ç”±äºviteæ‰“åŒ…çš„æœºåˆ¶ï¼Œé€ æˆäº†è·¯å¾„é”™è¯¯çš„é—®é¢˜ï¼ˆç±»ä¼¼äºvue2 + vue-clié¡¹ç›®çš„åŠ¨æ€ç»‘å®šå›¾ç‰‡é—®é¢˜ï¼‰ã€‚

è§£å†³
==

ç›®å‰ç½‘ä¸Šçš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œè¿™é‡Œåˆ—å‡ºå…¶ä¸­ä¸€ç§å—ä¼—çš„ï¼Œä»¥åŠç¬”è€…åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥åŠ å¼ºçš„è§£å†³æ–¹æ¡ˆã€‚

æ™®éçš„è§£å†³æ–¹æ¡ˆ
-------

è¯ä¸å¤šè¯´ï¼Œç›´æ¥åˆ—å‡ºä»£ç ï¼š

    <template>
        <div>
    	    <!-- åŠ¨æ€ç»‘å®šå›¾ç‰‡èµ„æº -->
            <img :src="img_src">
        </div>
    </template>
    
    <script setup>
    import { ref } from 'vue';
    // é™æ€å›¾ç‰‡èµ„æº
    const img_src = ref('./1.jpg');
    
    // ä¸»è¦ä»£ç ï¼Œåˆ©ç”¨ new URL().href è¿›è¡Œç›¸å¯¹è·¯å¾„çš„æ‹¼æ¥
    function getAssetImage(imgSrc) {
      return new URL(imgSrc, import.meta.url).href;
    }
    
    // å½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿™æ ·ç®€å†™ï¼Œè¿™é‡Œç”¨åˆ°es6ç®­å¤´å‡½æ•°
    // const getAssetImage = imgSrc => new URL(imgSrc, import.meta.url).href;
    </script>
    

è¿™æ®µä»£ç çš„é‡ç‚¹æ˜¯`new URL().href` å’Œ es6çš„ `import.meta.url` ã€‚

*   `new URL(url, baseUrl).href`ï¼šè·¯å¾„æ‹¼æ¥ã€‚æ¯”å¦‚urlæ˜¯`./1.jpg`ï¼ŒbaseUrlæ˜¯`http://127.0.0.1:5173/src/App.vue` ï¼Œé‚£ä¹ˆæ‹¼æ¥å‡ºæ¥å°±æ˜¯`http://127.0.0.1:5173/src/1.jpg`
*   `import.meta.url`ï¼šè·å–å½“å‰æ¨¡å—çš„è·¯å¾„ï¼Œæ¯”å¦‚åœ¨`src/App.vue`ä¸­ï¼Œå°±æ˜¯`http://127.0.0.1:5173/src/App.vue`ã€‚

æ‰€ä»¥æœ€åçš„`new URL().href` å°±æ˜¯çœŸæ­£çš„å›¾ç‰‡èµ„æºåœ°å€ï¼Œè‡ªå·±æ‰“å°ä¸€ä¸‹`new URL(url, baseUrl)` å’Œ`import.meta.url` å°±å®¹æ˜“æ˜ç™½äº†ã€‚

è¿™é‡Œç»™å¤§ä¼™å„¿ç”»å¼ å›¾ï¼Œä¾¿äºç†è§£ã€‚

![](https://img2023.cnblogs.com/blog/3153981/202308/3153981-20230821233426411-1761126279.png)

ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ
-------

ä¸Šé¢çš„æ–¹æ¡ˆå¯è¡Œï¼Œä½†ä¸å¤Ÿä¼˜é›…ã€‚è¯•æƒ³ï¼Œå¦‚æœæœ‰å¾ˆå¤šæ–‡ä»¶éƒ½éœ€è¦åŠ¨æ€ç»‘å®šé™æ€å›¾ç‰‡èµ„æºï¼Œé‚£å²‚ä¸æ˜¯æ¯ä¸ª.vueæ–‡ä»¶éƒ½è¦å°è£…ä¸€æ¬¡`getAssetImage()` å‡½æ•°ï¼Ÿæ‰€ä»¥ä¸‹é¢ä»‹ç»ä¸€ç§ä¼˜é›…çš„å°è£…æ–¹æ¡ˆã€‚

å°è£…çš„ä¸»è¦é—®é¢˜æ˜¯**å¦‚ä½•è‡ªåŠ¨è·å–.vueæ–‡ä»¶çš„`import.meta.url`** ï¼Œå°±å¯ä»¥ä¸å¿…æ¯æ¬¡è°ƒç”¨éƒ½æºå¸¦`import.meta.url`ã€‚

æ ¸å¿ƒæ€è·¯æ˜¯**é€šè¿‡æŠ›å‡ºé”™è¯¯è·å–å‡½æ•°è°ƒç”¨æ ˆï¼Œä»è€Œè·å¾—å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶ï¼ˆæˆ–è€…è¯´æ¨¡å—ï¼‰çš„è·¯å¾„ï¼Œå†é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æå–å‡ºè·¯å¾„ä¿¡æ¯ï¼ŒæŠŠ`import.meta.url`æ›¿æ¢æ‰ï¼Œå°±èƒ½å®ç°ï¼Œåªä¼ å›¾ç‰‡ç›¸å¯¹è·¯å¾„è¿™ä¸€ä¸ªå‚æ•°ï¼Œå¾—åˆ°å›¾ç‰‡çš„å®Œæ•´è·¯å¾„çš„æ•ˆæœ**ã€‚

ç›´æ¥ä¸Šä»£ç ï¼š

*   JavaScriptç‰ˆæœ¬

    // src/utils/common.js
    
    export default {
        getAssetImage(imgSrc, baseUrl) {
            // console.log('baseUrl', baseUrl);
            // console.log('new URL(imgSrc, baseUrl).href', new URL(imgSrc, baseUrl).href);
            // console.log('import.meta.url', import.meta.url);
            // console.log('new URL(imgSrc, import.meta.url).href', new URL(imgSrc, import.meta.url).href);
    
            // æ­£åˆ™åŒ¹é…å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶çš„è·¯å¾„
            const regExp1 = /at Proxy.getAssetImage \((.+)\)/g;
            // æ­£åˆ™å‘½ä¸­ç›®æ ‡
            let target;
            try {
                // æŠ›å‡ºé”™è¯¯ï¼Œè·å–å‡½æ•°è°ƒç”¨æ ˆä¿¡æ¯
                throw new Error();
            } catch (err) {
                // åŒ¹é…å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶çš„è·¯å¾„
                target = regExp1.exec(err?.stack);
                // console.log('err.stack', err?.stack);
                // console.log(target?.[1]);
            }
    
            if (target?.[1]) {
                // ç”¨æˆ·æ²¡æœ‰ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±ä½¿ç”¨è‡ªåŠ¨è·å–çš„è·¯å¾„
                baseUrl = baseUrl || target?.[1];
            }
    
            if (!baseUrl) {
                // ç”¨æˆ·æ²¡æœ‰ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸”è·å–å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶çš„è·¯å¾„å¤±è´¥
                throw new Error('è¯·ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•° import.meta.url');
            }
            // è¿”å›å¤„ç†åçš„èµ„æºè·¯å¾„
            return new URL(imgSrc, baseUrl).href;
        }
    }
    

*   TypeScriptç‰ˆæœ¬

    // src/utils/common.ts
    
    export default {
        getAssetImage(imgSrc: string, baseUrl: string) {
            // console.log('baseUrl', baseUrl);
            // console.log('new URL(imgSrc, baseUrl).href', new URL(imgSrc, baseUrl).href);
            // console.log('import.meta.url', import.meta.url);
            // console.log('new URL(imgSrc, import.meta.url).href', new URL(imgSrc, import.meta.url).href);
    
            // æ­£åˆ™åŒ¹é…å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶çš„è·¯å¾„
            const regExp1 = /at Proxy.getAssetImage \((.+)\)/g;
            // æ­£åˆ™å‘½ä¸­ç›®æ ‡
            let target: RegExpExecArray | null;
            try {
                // æŠ›å‡ºé”™è¯¯ï¼Œè·å–å‡½æ•°è°ƒç”¨æ ˆä¿¡æ¯
                throw new Error();
            } catch (err) {
                // åŒ¹é…å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶çš„è·¯å¾„
                target = regExp1.exec(err?.stack);
                // console.log('err.stack', err?.stack);
                // console.log(target?.[1]);
            }
    
            if (target?.[1]) {
                // ç”¨æˆ·æ²¡æœ‰ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±ä½¿ç”¨è‡ªåŠ¨è·å–çš„è·¯å¾„
                baseUrl = baseUrl || target?.[1];
            }
    
            if (!baseUrl) {
                // ç”¨æˆ·æ²¡æœ‰ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸”è·å–å‡½æ•°è°ƒç”¨è€…æ–‡ä»¶çš„è·¯å¾„å¤±è´¥
                throw new Error('è¯·ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•° import.meta.url');
            }
            // è¿”å›å¤„ç†åçš„èµ„æºè·¯å¾„
            return new URL(imgSrc, baseUrl).href;
        }
    }
    

*   åœ¨.vueæ–‡ä»¶ä¸­ä½¿ç”¨

    // src/App.vue
    
    <template>
        <div>
            <!-- æµ‹è¯• -->
            <img :src="getAssetImage(img_src)">
            <!-- å¯ä»¥è¯•è¯•åœ¨åµŒå¥—ç»„ä»¶ä¸­ä½¿ç”¨^_^ -->
        </div>
    </template>
    
    <script lang="ts" setup>
    import { ref } from 'vue';
    import common from '@/utils/common.ts';
    
    const img_src = ref('./1.jpg');
    
    // const getAssetImage = img_src => common.getAssetImage(img_src, import.meta.url);
    // å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå‚æ•°import.meta.urlï¼Œå‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨è·å–å‡½æ•°çš„è°ƒç”¨è·¯å¾„ã€‚
    const getAssetImage = img_src => common.getAssetImage(img_src);
    
    // å¸¸è§„å†™æ³•
    // function getAssetImage(img_src) {
    //   return common.getAssetImage(img_src);
    // }
    </script>
    

the Endâ€¦â€¦