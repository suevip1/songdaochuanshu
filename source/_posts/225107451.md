---
layout: post
title: "åŸæ¥Springèƒ½æ³¨å…¥é›†åˆå’ŒMapçš„computeIfAbsentæ˜¯è¿™ä¹ˆå¥½ç”¨ï¼"
date: "2023-05-09T01:08:20.115Z"
---
åŸæ¥Springèƒ½æ³¨å…¥é›†åˆå’ŒMapçš„computeIfAbsentæ˜¯è¿™ä¹ˆå¥½ç”¨ï¼
=======================================

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯3yï¼Œä»Šå¤©ç»§ç»­æ¥èŠæˆ‘çš„å¼€æºé¡¹ç›®`austin`å•Šï¼Œä½†å®é™…å†…å®¹æ›´æ–°ä¸å¤šã€‚è¿™æ–‡ç« ä¸»æ˜¯æƒ³å¹ä¸‹æ°´ï¼Œä¸»è¦èŠèŠæˆ‘åœ¨æ›´æ–°é¡¹ç›®ä¸­å­¦åˆ°çš„**å°æŠ€å·§**ã€‚

ä»Šå¤©æ‰€è¯´çš„å°æŠ€å·§å¯èƒ½æœ‰å¾ˆå¤šäººéƒ½ä¼šï¼Œä½†è‚¯å®šä¹Ÿä¼šæœ‰è·Ÿæˆ‘ä¸€æ ·ä¹‹å‰æ²¡ç”¨è¿‡çš„ã€‚

> **æ¶ˆæ¯æ¨é€å¹³å°ğŸ”¥æ¨é€ä¸‹å‘ã€é‚®ä»¶ã€‘ã€çŸ­ä¿¡ã€‘ã€å¾®ä¿¡æœåŠ¡å·ã€‘ã€å¾®ä¿¡å°ç¨‹åºã€‘ã€ä¼ä¸šå¾®ä¿¡ã€‘ã€é’‰é’‰ã€‘ç­‰æ¶ˆæ¯ç±»å‹**ã€‚
> 
> *   [https://gitee.com/zhongfucheng/austin/](https://gitee.com/zhongfucheng/austin/)
> *   [https://github.com/ZhongFuCheng3y/austin](https://github.com/ZhongFuCheng3y/austin)

Springæ³¨å…¥é›†åˆ
----------

ä¹‹å‰æˆ‘ä¸€ç›´ä¸çŸ¥é“ï¼ŒåŸæ¥Springæ˜¯èƒ½æ³¨å…¥é›†åˆçš„ï¼Œç›´åˆ°ä¸€ä¸ª`pull request`è¢«æäº†è¿‡æ¥ã€‚

[https://gitee.com/zhongfucheng/austin/pulls/31](https://gitee.com/zhongfucheng/austin/pulls/31)

æˆ‘ä¹‹å‰å†™äº†ä¸€ä¸ª**è‡ªå®šä¹‰æ³¨è§£**ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æ”¶é›†è‡ªå®šä¹‰æ³¨è§£æ‰€æ ‡è¯†çš„`Bean`ï¼Œç„¶åæœ€åæŠŠè¿™äº›`Bean`æ”¾åˆ°`Map`é‡Œ

    @Component
    public class SmsScriptHolder {
    
        private Map<String, SmsScript> handlers = new HashMap<>(8);
    
        public void putHandler(String scriptName, SmsScript handler) {
            handlers.put(scriptName, handler);
        }
        public SmsScript route(String scriptName) {
            return handlers.get(scriptName);
        }
    }
    
    
    /**
     * æ ‡è¯† çŸ­ä¿¡æ¸ é“
     *
     * @author 3y
     */
    @Retention(RetentionPolicy.RUNTIME)
    @Target({ElementType.TYPE})
    @Component
    public @interface SmsScriptHandler {
    
        /**
         * è¿™é‡Œè¾“å…¥è„šæœ¬å
         *
         * @return
         */
        String value();
    }
    
    /**
     * smså‘é€è„šæœ¬çš„æŠ½è±¡ç±»
     *
     * @author 3y
     */
    @Slf4j
    public abstract class BaseSmsScript implements SmsScript {
    
        @Autowired
        private SmsScriptHolder smsScriptHolder;
    
        @PostConstruct
        public void registerProcessScript() {
            if (ArrayUtils.isEmpty(this.getClass().getAnnotations())) {
                log.error("BaseSmsScript can not find annotation!");
                return;
            }
            Annotation handlerAnnotations = null;
            for (Annotation annotation : this.getClass().getAnnotations()) {
                if (annotation instanceof SmsScriptHandler) {
                    handlerAnnotations = annotation;
                    break;
                }
            }
            if (handlerAnnotations == null) {
                log.error("handler annotations not declared");
                return;
            }
            //æ³¨å†Œhandler
            smsScriptHolder.putHandler(((SmsScriptHandler) handlerAnnotations).value(), this);
        }
    }
    

ç»“æœï¼Œ`pull request`æçš„ä»£ç è¿‡æ¥ç‰¹åˆ«ç®€å•å°±æ›¿ä»£äº†æˆ‘çš„ä»£ç äº†ã€‚åªè¦åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥æ³¨å…¥`Map`ï¼š

    @Autowired
    private Map<String, SmsScript> smsScripts;
    

è¿™ä¸€è¡Œä»£ç å°±èƒ½å¤Ÿå®ç°ï¼ŒæŠŠ`SmsScript`çš„å®ç°ç±»éƒ½æ³¨å…¥åˆ°è¿™ä¸ª`Map`é‡Œã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬äº¦å¯ä»¥ä½¿ç”¨`List<Interface>` æŠŠè¯¥æ¥å£ä¸‹çš„å®ç°ç±»éƒ½æ³¨å…¥åˆ°è¿™ä¸ªListé‡Œã€‚

è¿™å¥½å¥‡è®©æˆ‘å»çœ‹çœ‹`Spring`åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä½†å®é™…ä¸Šå¹¶ä¸éš¾ã€‚å…¥å£åœ¨`org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.AutowiredFieldElement#inject`

æ¥ç€å®šä½åˆ°ï¼š`org.springframework.beans.factory.support.DefaultListableBeanFactory#resolveDependency`

æ·±å…¥ `org.springframework.beans.factory.support.DefaultListableBeanFactory#doResolveDependency`

æœ€åå®ç°æ³¨å…¥çš„ä½ç½®ï¼š `org.springframework.beans.factory.support.DefaultListableBeanFactory#resolveMultipleBeans` æ•°ç»„ ç›¸å…³å®ç°

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bbbb4c4503274c1396b578a95c454f13~tplv-k3u1fbpfcp-zoom-1.image)

access\_tokenå­˜å‚¨åˆ°Redis
---------------------

åœ¨æ¥å…¥å¾®ä¿¡ç›¸å…³æ¸ é“æ—¶ï¼Œæˆ‘å°±è¯´è¿‡`austin`å€ŸåŠ©äº†`wxjava`è¿™ä¸ªå¼€æºç»„ä»¶åº“ï¼ˆè¯¥ç»„ä»¶åº“å¯¹æ¥å¾®ä¿¡ç›¸å…³`api`ï¼Œä½¿è°ƒç”¨å˜å¾—å°¤å…¶ç®€å•ï¼‰ã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬è°ƒç”¨å¾®ä¿¡çš„`api`æ˜¯éœ€è¦`access_token`çš„å‚æ•°çš„ã€‚å¦‚æœæ˜¯æˆ‘ä»¬**è‡ªå·±ç¼–å†™**ä»£ç è°ƒç”¨å¾®ä¿¡`api`ï¼Œé‚£æˆ‘ä»¬éœ€è¦å…ˆè·å–`access_token`ï¼Œç„¶åæŠŠè¯¥`access_token`æ‹¼æ¥åœ¨`url`ä¸Šã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åˆéœ€è¦è€ƒè™‘`access_token`ä¼šä¸ä¼šå¤±æ•ˆäº†ï¼Œå¤±æ•ˆäº†æˆ‘ä»¬è¦æœ‰**é‡è¯•çš„ç­–ç•¥**ã€‚

è€Œ`wxjava`æŠŠè¿™äº›éƒ½å°è£…å¥½äº†ï¼Œå±è”½äº†å†…éƒ¨å®ç°ç»†èŠ‚ã€‚åªè¦æˆ‘ä»¬æŠŠå¾®ä¿¡æ¸ é“çš„è´¦å·ä¿¡æ¯å†™åˆ°`WxMpConfigStorage`é‡Œï¼Œé‚£è¯¥ç»„ä»¶å°±ä¼šå¸®æˆ‘ä»¬å»æ‹¿åˆ°`access_token`ï¼Œå†…éƒ¨ä¹Ÿä¼šæœ‰ç›¸åº”çš„é‡è¯•ç­–ç•¥ã€‚

ç¬¬ä¸€ç‰ˆæˆ‘ä¸ºäº†å›¾æ–¹ä¾¿ï¼Œæˆ‘æ˜¯ä½¿ç”¨`WxMpDefaultConfigImpl`å®ç°ç±»æŠŠæ¸ é“ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨**æœ¬åœ°å†…å­˜**é‡Œï¼ˆåŒ…æ‹¬`access_token`ï¼‰ï¼Œè€Œ**åœ¨ä¸Šå‘¨**æˆ‘æŠŠæ¸ é“ç›¸å…³ä¿¡æ¯è½¬éƒ½å­˜å‚¨è‡³`Redis`ã€‚

ä¸»è¦æ˜¯è·å–`access_token`å®ƒçš„**è°ƒç”¨æ¬¡æ•°æ˜¯æœ‰é™**çš„ï¼Œå¦‚æœé¡¹ç›®é›†ç¾¤éƒ¨ç½²ï¼Œè€Œ`access_token`åˆå­˜å‚¨åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œé‚£å°±å¾ˆå¤§æ¦‚ç‡ä¸åˆ°ä¸€å¤©æ—¶é—´è°ƒç”¨è·å–`access_token`æ¬¡æ•°å°±æ»¡äº†ï¼Œè¦æ˜¯æ‹¿ä¸åˆ°`access_token`ï¼Œé‚£å°±æ²¡åŠæ³•è°ƒç”¨å¾®ä¿¡çš„æ¥å£äº†ã€‚

[https://developers.weixin.qq.com/doc/offiaccount/Basic\_Information/Get\_access\_token.html](https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Get_access_token.html)

å¯¹äº`wxjava`è¿™ä¸ªç»„ä»¶åº“ï¼Œè°ƒç”¨å¾®ä¿¡çš„`api`éƒ½æ˜¯é€šè¿‡`Wx(xx)Service`æ¥ä½¿ç”¨çš„ï¼Œè€Œæˆ‘æ˜¯æƒ³æŠŠ`Wx(xx)Service`åšæˆæ˜¯**å•ä¾‹**çš„ã€‚é‚£åœ¨å®ç°`access_token`å­˜å‚¨åˆ°`Redis`çš„æ—¶å€™ï¼Œæˆ‘å°±å¾ˆè‡ªç„¶å°±è¦å¯¹æ—§ä»£ç è¿›è¡Œä¸€æ³¢é‡æ„ï¼ˆ**å› ä¸ºç¬¬ä¸€ç‰ˆå†™å‡ºæ¥çš„ä»£ç ï¼Œå¤šå¤šå°‘å°‘éƒ½æœ‰ç‚¹ä¸æ»¡æ„**ï¼‰ã€‚

å†å²èƒŒæ™¯ï¼š

1ã€`WxServiceUtils`çš„é€»è¾‘æ˜¯**é¡¹ç›®å¯åŠ¨**çš„æ—¶æ£€ç´¢æ•°æ®åº“é‡Œæ‰€æœ‰çš„**å¾®ä¿¡æ¸ é“è´¦å·**ä¿¡æ¯ï¼Œå°†`Wx(xx)Service`å†™å…¥åˆ°`Map`é‡Œã€‚`Wx(xx)Service`è¦åšæˆå•ä¾‹è‡ªç„¶å°±ä¼šæƒ³åˆ°ç”¨`Map`å­˜å‚¨ï¼ˆå› ä¸ºæ¶ˆæ¯æ¨é€å¹³å°å¾ˆå¯èƒ½ä¼šå¯¹æ¥å¾ˆå¤šä¸ªæœåŠ¡å·æˆ–è€…å°ç¨‹åºï¼Œè¿™é‡Œæ•°æ®ç»“æ„è‚¯å®šä¼˜å…ˆæ˜¯`Map`å•¦ï¼‰

å¦‚æœæ¸ é“çš„è´¦å·**é€šè¿‡åå°**æœ‰å­˜åœ¨å˜æ›´è¡Œä¸ºï¼Œé‚£ç¨‹åºå†…éƒ¨ä¼šæ‰§è¡Œ`refresh()`åˆ·æ–°ã€‚ä½†è¿™ä¸ªä»…ä»…æ˜¯åœ¨ç¨‹åºå†…èƒ½ç›‘å¬åˆ°çš„å˜æ›´ï¼Œå¦‚æœæ˜¯ç›´æ¥é€šè¿‡`SQL`ä¿®æ”¹è¡¨çš„è®°å½•ï¼Œç›®å‰æ˜¯æ²¡æœ‰æœºåˆ¶åˆ·æ–°`Map`çš„å†…å®¹çš„ã€‚

2ã€`AccountUtils`çš„é€»è¾‘æ˜¯**ç¨‹åºè¿è¡Œæ—¶**å¾—åˆ°å‘é€è´¦å·çš„`Id`ï¼Œé€šè¿‡`Id`å»æ•°æ®åº“æ£€ç´¢è´¦å·é…ç½®ï¼Œå®æ—¶è¿”å›è´¦å·æœ€æ–°çš„å†…å®¹ã€‚ï¼ˆ**é™¤äº†å¾®ä¿¡æ¸ é“è´¦å·**ï¼Œå…¶ä»–æ‰€æœ‰çš„æ¸ é“è´¦å·éƒ½æ˜¯åœ¨è¿™é‡Œè·å–ä¿¡æ¯ï¼‰

æ›´æ–°ï¼šæŠŠåŸæœ‰ç®¡ç†å¾®ä¿¡è´¦å·ä¿¡æ¯çš„`WxServiceUtils`ç±»ç»™å¼ƒç”¨äº†ï¼Œå°†æ‰€æœ‰çš„å‘é€æ¸ é“è´¦å·ä¿¡æ¯éƒ½å½’åˆ°`AccountUtils`è¿›è¡Œç®¡ç†ã€‚

Map.computeIfAbsentä½¿ç”¨
---------------------

åœ¨é‡æ„ä¸Šé¢æ‰€è®²çš„é€»è¾‘æ—¶ï¼Œæˆ‘å¾ˆå¿«åœ°å†™å‡ºä»¥ä¸‹çš„ä»£ç ï¼š

    if (clazz.equals(WxMaService.class)) {
        if (Objects.nonNull(miniProgramServiceMap.get(channelAccount))) {
            return (T)miniProgramServiceMap.get(channelAccount);
        }
        WxMaService wxMaService = initMiniProgramService(JSON.parseObject(channelAccount.getAccountConfig(), WeChatMiniProgramAccount.class));
        miniProgramServiceMap.put(channelAccount, wxMaService);
        return (T) wxMaService;
    } else if (clazz.equals(WxMpService.class)) {
        if (Objects.nonNull(officialAccountServiceMap.get(channelAccount))) {
            return (T)officialAccountServiceMap.get(channelAccount);
        }
        WxMpService wxMpService = initOfficialAccountService(JSON.parseObject(channelAccount.getAccountConfig(), WeChatOfficialAccount.class));
        officialAccountServiceMap.put(channelAccount, wxMpService);
        return (T) wxMpService;
    }
    

ç­‰æˆ‘å†™å®Œï¼Œç„¶åç®€å•åšäº†ä¸‹è‡ªæµ‹ï¼Œ**å‘ç°è¿™ä»£ç å’‹è¿™ä¹ˆä¸‘å•Š**ï¼Œä¸¤ä¸ª`if`çš„é€»è¾‘å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ã€‚

æˆ‘æƒ³ï¼Œè¿™ä¸€å®šä¼šæœ‰ä»€ä¹ˆå·¥å…·ç±»èƒ½å¸®æˆ‘å»ä¼˜åŒ–ä¸‹è¿™ä¸ªä»£ç çš„ï¼Œæˆ‘æ­£å‡†å¤‡ç¿»`Hutool`/`Guava`è¿™ç§å·¥å…·åŒ…æ—¶ï¼Œæˆ‘çªç„¶æƒ³èµ·ï¼š**JDKåœ¨1.8å¥½åƒå°±æä¾›äº†putIfXXXçš„æ–¹æ³•å•¦ï¼Œæˆ‘è¿˜æ‰¾ä¸ªæ¯›å•Šï¼Œç›´æ¥çœ‹çœ‹JDKçš„æ–¹æ³•èƒ½ä¸èƒ½ç”¨å…ˆ**ã€‚

å¾ˆå¿«å•Šï¼Œæˆ‘å°±æ‰¾åˆ°äº†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ad0a58ddb1643df8d2bc93593a6fdef~tplv-k3u1fbpfcp-zoom-1.image)

æˆ‘é¦–å…ˆçœ‹çš„æ˜¯`putIfAbsent`ï¼Œå‘ç°å®ƒå®ç°**å¾ˆç®€å•**ï¼Œå°±æ˜¯åšäº†ä¸€å±‚å°è£…ã€‚

    default V putIfAbsent(K key, V value) {
        V v = get(key);
        if (v == null) {
            v = put(key, value);
        }
    
        return v;
    }
    

**ä½†å´å¾ˆé€‚åˆ**ç”¨æ¥ä¼˜åŒ–æˆ‘ä¸Šé¢çš„ä»£ç ã€‚äºæ˜¯ï¼Œå¾ˆå¿«å•Šï¼Œæˆ‘å°±æ”¹æˆäº†è¿™æ ·ï¼š

    if (clazz.equals(WxMaService.class)) {
        return (T) miniProgramServiceMap.putIfAbsent(channelAccount, initMiniProgramService(JSON.parseObject(channelAccount.getAccountConfig(), WeChatMiniProgramAccount.class)));
    } else if (clazz.equals(WxMpService.class)) {
        return (T) officialAccountServiceMap.putIfAbsent(channelAccount, initOfficialAccountService(JSON.parseObject(channelAccount.getAccountConfig(), WeChatOfficialAccount.class)));
    }
    

è¿™çœ‹ç€çœŸç®€æ´å•Šï¼Œ**å¥½åƒå·²ç»å¾ˆå®Œç¾äº†**ï¼Œæœ¬æ¥æœ‰å¥½å‡ è¡Œçš„ä»£ç ï¼Œä¼˜åŒ–äº†ä¸‹å˜æˆäº†ä¸€è¡Œã€‚

ä½†æˆ‘åˆæ€è€ƒäº†ä¸‹ï¼Œè¿™ä¸ª`putIfAbsent`çš„`V`æˆ‘è¿™è¾¹ä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¯æ¬¡è¿™ä¸ªæ–¹æ³•éƒ½ä¼šæ‰§è¡Œçš„ï¼ˆä¸è®ºæˆ‘çš„`Map`é‡Œæœ‰æ²¡æœ‰è¿™ä¸ª`K`ï¼‰ï¼Œ**è¿™åˆæ„Ÿè§‰ä¸å¤ªä¼˜é›…äº†**ã€‚

æˆ‘åˆç‚¹è¿›å»`computeIfAbsent`çœ‹äº†ä¸‹ï¼Œå—¯ï¼è¿™å°±æ˜¯æˆ‘æƒ³è¦çš„äº†ï¼šå¦‚æœ`Map`çš„`V`ä¸å­˜åœ¨æ—¶ï¼Œæ‰å»æ‰§è¡Œæˆ‘ç”Ÿæˆ`V`çš„é€»è¾‘

    default V computeIfAbsent(K key,
                              Function<? super K, ? extends V> mappingFunction) {
        Objects.requireNonNull(mappingFunction);
        V v;
        if ((v = get(key)) == null) {
            V newValue;
            if ((newValue = mappingFunction.apply(key)) != null) {
                put(key, newValue);
                return newValue;
            }
        }
        return v;
    }
    

ï¼ˆè¿™ä¸ªå…¶å®æˆ‘åœ¨å­¦`lambda`å’Œ`stream`æµçš„æ—¶å€™æ›¾ç»æ˜¯ä½“éªŒè¿‡çš„ï¼Œæˆ‘æ—¥å¸¸ä¹Ÿä¼šç®€å•å†™ç‚¹ï¼Œåªæ˜¯ä¸çŸ¥é“åœ¨`JDK`é‡Œ`Map`ä¹Ÿæœ‰è¿™æ ·çš„æ–¹æ³•ã€‚ï¼‰äºæ˜¯ï¼Œæœ€åçš„ä»£ç å°±æˆäº†ï¼š

    if (clazz.equals(WxMaService.class)) {
        return (T) miniProgramServiceMap.computeIfAbsent(channelAccount, account -> initMiniProgramService(JSON.parseObject(account.getAccountConfig(), WeChatMiniProgramAccount.class)));
    } else if (clazz.equals(WxMpService.class)) {
        return (T) officialAccountServiceMap.computeIfAbsent(channelAccount, account -> initOfficialAccountService(JSON.parseObject(account.getAccountConfig(), WeChatOfficialAccount.class)));
    }
    

åˆåæ¥ï¼Œç­‰æˆ‘å‘å¸ƒåˆ°Gitä»“åº“åï¼Œæœ‰äººæäº†`pull request`æ¥ä¿®å¤`ConcurrentHashMap`çš„`computeIfAbsent`å­˜åœ¨æ€§èƒ½çš„é—®é¢˜ã€‚å‘€ï¼Œä¸å°å¿ƒåˆå­¦åˆ°äº†ç‚¹ä¸œè¥¿ã€‚

[https://bugs.openjdk.java.net/browse/JDK-8161372](https://bugs.openjdk.java.net/browse/JDK-8161372)

å¾®ä¿¡æ‰«ç ç™»å½•å®ç°
--------

æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰å†™è¿‡ã€Œç”¨æˆ·ç™»å½•ã€çš„ï¼Œå¯¼è‡´æœ‰äº›ä¸šåŠ¡åŠŸèƒ½æˆ‘ä¹Ÿä¸çŸ¥é“çº¿ä¸Šæ˜¯æ€ä¹ˆå®ç°çš„ã€‚è€Œã€Œç”¨æˆ·ç™»å½•æ³¨å†Œã€è¿™ä¸ªåŠŸèƒ½ä¹‹å‰ä¼šå¬è¿‡å’Œè§è¯†è¿‡ä¸€äº›æŠ€æœ¯æ ˆã€ŒShiroã€ã€ã€ŒJWTã€ã€ã€ŒSpring Securityã€ã€ã€ŒCASã€ã€ã€ŒOAuth2.0ã€ç­‰ç­‰ã€‚

ä½†æ˜¯ï¼Œæˆ‘çš„éœ€æ±‚åªæ˜¯ç”¨æ¥åšç®€å•çš„æ ¡éªŒï¼Œä¸éœ€è¦é‚£ä¹ˆå¤æ‚ã€‚å¦‚æœå°±ç»™æˆ‘è®¾è®¡ä¸€å¼ userè¡¨ï¼Œå¯¹å…¶ç®€å•çš„å¢åˆ æ”¹æŸ¥å¥½åƒä¹Ÿæ»¡è¶³ï¼Œä½†æˆ‘åˆä¸æƒ³å†™è¿™æ ·çš„ä»£ç ï¼Œå› ä¸ºæˆ‘åœ¨å¤§å­¦çš„æ—¶å€™å®ç°è¿‡ç±»ä¼¼çš„ã€‚

ç°åœ¨ä¸éƒ½**æµè¡Œæ‰«ç ç™»å½•**å˜›ï¼Ÿæˆ‘ä¸æ˜¯å·²ç»æ¥å…¥äº†å¾®ä¿¡æœåŠ¡å·çš„æ¨¡æ¿æ¶ˆæ¯äº†å—ï¼Œä¸æ­£å¥½æœ‰ä¸€ä¸ªæµ‹è¯•å·ç»™æˆ‘å»åšå—ï¼Ÿäºæ˜¯å°±å¼€å¹²äº†ã€‚

é¦–å…ˆçœ‹çœ‹äººå®¶æ˜¯æ€ä¹ˆå†™çš„ï¼Œäºæ˜¯è¢«æˆ‘æ‰¾åˆ°äº†ä¸€ç¯‡åšå®¢ï¼š[https://blog.51cto.com/cxhit/4924932](https://blog.51cto.com/cxhit/4924932)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9682b6423af483ba486397adc1d5975~tplv-k3u1fbpfcp-zoom-1.image)

è¿‡ç¨‹æŒºå¥½æ‡‚çš„ï¼Œå°±æŒ‰ç€ä»–ç»™å‡ºçš„æ—¶åºå›¾å¯¹ç€å®ç°å°±å®Œäº†ã€‚åç«¯å¯¹æˆ‘æ¥è¯´å®ç°å¹¶ä¸éš¾ï¼ŒèŠ±çš„æ—¶é—´æœ€é•¿çš„è¿˜æ˜¯åœ¨å‰ç«¯çš„äº¤äº’ä¸Šã€‚æ¯•ç«Ÿæˆ‘è¿™å½“æ—¶é€‰ç”¨çš„æ˜¯ä½ä»£ç å¹³å°å•Šï¼Œä¸èƒ½éšä¾¿å®ç°å„ç§é€»è¾‘çš„å•Šã€‚

åœ¨å‰ç«¯ï¼Œå°±ä¸€ä¸ªã€Œè½®è¯¢ã€åŠŸèƒ½ï¼Œè¦è½®è¯¢æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦å·²ç»è®¢é˜…ç™»å½•ï¼Œå°±è€—è´¹äº†æˆ‘å¾ˆå¤šæ—¶é—´åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šã€‚åæ¥ï¼Œå†™äº†ä¸å°‘çš„å¥‡æ·«æŠ€å·§ï¼Œæœ€åä¹Ÿå°±è¢«æˆ‘å®ç°å‡ºæ¥äº†ã€‚å®ç°è¿‡ç¨‹å¾ˆç³Ÿç³•ï¼Œä¹Ÿä¸å€¼ä¸€æï¼Œåæ­£ä½ ä»¬ä¹Ÿä¸ä¼šä»ä¸­å­¦åˆ°ä»€ä¹ˆå¥½ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ²¡æœ‰ã€‚

è¿‡ç¨‹è¿˜æ˜¯ç®€å•å¤è¿°ä¸‹å§ï¼ŒåæœŸå¯èƒ½ä¹Ÿä¼šæœ‰åŒå­¦å»å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚

**1**ã€é¦–å…ˆæˆ‘ä»¬è¦æœ‰ä¸€ä¸ªæ¥å£ï¼Œç»™åˆ°å¾®ä¿¡**å›è°ƒ**ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šç§°è¯¥æ¥å£ä¸ºå›è°ƒæ¥å£ã€‚å¾®ä¿¡çš„ä¸€äº›é‡è¦çš„äº‹ä»¶éƒ½ä¼šå›è°ƒç»™æˆ‘ä»¬ï¼Œæˆ‘ä»¬åšå“åº”çš„é€»è¾‘å¤„ç†ã€‚å°±æ¯”å¦‚ï¼Œ**ç”¨æˆ·å…³æ³¨äº†æœåŠ¡å·**ï¼Œè¿™ç§æ¶ˆæ¯å¾®ä¿¡å°±è°ƒç”¨æˆ‘ä»¬çš„æ¥å£ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8cd797c527b47e7aeb2bff652c770da~tplv-k3u1fbpfcp-zoom-1.image)

**2**ã€åœ¨å¾®ä¿¡åå°**é…ç½®**æˆ‘ä»¬çš„å®šä¹‰å¥½çš„å›è°ƒæ¥å£ï¼Œç»™åˆ°å¾®ä¿¡è¿›è¡Œå›è°ƒã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/153748477039421f82da59af69b82e23~tplv-k3u1fbpfcp-zoom-1.image)

ï¼ˆå¦‚æœæ¥å£æ˜¯é€šçš„ï¼ŒæŒ‰æ­£å¸¸çš„èµ°ï¼Œé‚£å°±ä¼šé…ç½®æˆåŠŸï¼‰

**3**ã€ç¼–å†™ä¸€ä¸ªè·å–**å¾®ä¿¡å¸¦å‚æ•°çš„äºŒç»´ç **ç»™åˆ°å‰ç«¯åšå±•ç¤ºã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef2145ee940a4c1d9b27880929096eb7~tplv-k3u1fbpfcp-zoom-1.image)

**4**ã€å‰ç«¯æ‹¿åˆ°äºŒç»´ç åšå±•ç¤ºï¼Œå¹¶ä¸”å¾—åˆ°éšæœºç”Ÿæˆçš„å‚æ•°**è½®è¯¢**æŸ¥çœ‹æ˜¯å¦å·²ç™»å½•ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a07694612334bb0929a2b47b7fa419d~tplv-k3u1fbpfcp-zoom-1.image)

**5**ã€ç¼–å†™**æ£€æŸ¥æ˜¯å¦å·²ç™»å½•çš„æ¥å£ç»™åˆ°å‰ç«¯è¿›è¡Œåˆ¤æ–­**ã€‚ï¼ˆå¦‚æœèƒ½ä»Redisé‡Œæ‹¿åˆ°éšæœºå‚æ•°ï¼Œè¯´æ˜å·²ç»ç™»å½•äº†ï¼‰

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a87a8a8bfce84d3f8b9050acd0d2e555~tplv-k3u1fbpfcp-zoom-1.image)

**6**ã€å½“ç”¨æˆ·æ‰«ç **å…³æ³¨äº†**æœåŠ¡å·ï¼Œåˆ™å¾—åˆ°å¾®ä¿¡çš„å›è°ƒã€‚å½“ç”¨æˆ·å…³æ³¨æœåŠ¡å·æ—¶ï¼Œä¼šæŠŠéšæœºå‚æ•°å’ŒopenIdä¼ ç»™æœåŠ¡å™¨ï¼Œæˆ‘åˆ™å°†ä¿¡æ¯å­˜å…¥Redisã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4358152c0a2d43f1b615f63138f1f933~tplv-k3u1fbpfcp-zoom-1.image)

**7**ã€å‰ç«¯å¾—çŸ¥å·²ç™»å½•åï¼Œå°†ç”¨æˆ·ä¿¡æ¯å†™å…¥localStorage

æœ€å
--

æ¯æ¬¡ä»£ç å­˜åœ¨é‡åˆ°â€œä¼˜é›…â€çš„å†™æ³•æ—¶ï¼Œæˆ‘éƒ½ä¼šæ‡Šæ¼è‡ªå·±æ€ä¹ˆä¸ä¼šï¼Œè¿˜å­å“§å­å“§åœ°å†™è¿™ç ´ä»£ç è¿™ä¹ˆå¤šå¹´äº†ã€‚ç‰¹åˆ«æ˜¯`Map.computeIfAbsent`è¿™ä¸ªï¼Œæˆ‘æ„Ÿè§‰æ²¡ç†ç”±æˆ‘ä¸çŸ¥é“å‘€ã€‚æˆ‘ä»åˆå­¦åˆ°ç°åœ¨å·¥ä½œä¸»è¦ç”¨`JDK 1.8`ï¼Œæ²¡é“ç†æˆ‘ç°åœ¨æ‰çŸ¥é“å†™è¿™ä¸ªç©æ„ã€‚

æœ‰çš„æ—¶å€™éƒ½æ„Ÿè§‰æˆ‘æ˜¯ä¸æ˜¯å·²ç»æ˜¯è€å¤è‘£äº†ï¼Œæ–°ä¸–ç•Œå·²ç»æ²¡æœ‰æ‰¿è½½æˆ‘çš„èˆ¹äº†ã€‚

ä¸è¿‡å†™å¼€æºé¡¹ç›®æœ‰ä¸€å¤§å¥½å¤„æ˜¯ï¼Œåªè¦æˆ‘çš„é¡¹ç›®æœ‰äººç”¨ï¼Œèƒ½å¤§å¤§æé«˜æˆ‘è·å–â€œä¼˜é›…â€å†™æ³•çš„æ¦‚ç‡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸€ç›´æ¨å¹¿è‡ªå·±é¡¹ç›®çš„ä¸€ä¸ªåŸå› ä¹‹ä¸€ã€‚

å¦‚æœæƒ³å­¦Javaé¡¹ç›®çš„ï¼Œ**å¼ºçƒˆæ¨è**æˆ‘çš„å¼€æºé¡¹ç›®**æ¶ˆæ¯æ¨é€å¹³å°Austinï¼ˆ8K starsï¼‰** ï¼Œå¯ä»¥ç”¨ä½œ**æ¯•ä¸šè®¾è®¡**ï¼Œå¯ä»¥ç”¨ä½œ**æ ¡æ‹›**ï¼Œå¯ä»¥çœ‹çœ‹**ç”Ÿäº§ç¯å¢ƒæ˜¯æ€ä¹ˆæ¨é€æ¶ˆæ¯**çš„ã€‚å¼€æºé¡¹ç›®æ¶ˆæ¯æ¨é€å¹³å°austinä»“åº“åœ°å€ï¼š

> **æ¶ˆæ¯æ¨é€å¹³å°ğŸ”¥æ¨é€ä¸‹å‘ã€é‚®ä»¶ã€‘ã€çŸ­ä¿¡ã€‘ã€å¾®ä¿¡æœåŠ¡å·ã€‘ã€å¾®ä¿¡å°ç¨‹åºã€‘ã€ä¼ä¸šå¾®ä¿¡ã€‘ã€é’‰é’‰ã€‘ç­‰æ¶ˆæ¯ç±»å‹**ã€‚
> 
> *   [https://gitee.com/zhongfucheng/austin/](https://gitee.com/zhongfucheng/austin/)
> *   [https://github.com/ZhongFuCheng3y/austin](https://github.com/ZhongFuCheng3y/austin)

**æ›´å¤šçš„æ–‡ç« å¯å¾€ï¼š**[æ–‡ç« çš„ç›®å½•å¯¼èˆª](https://github.com/ZhongFuCheng3y/3y)