---
layout: post
title: "é‡è¿”ç…§ç‰‡çš„åŸå§‹ä¸–ç•Œï¼šæˆ‘ä¸º.NETæ‰“é€ çš„RAWç…§ç‰‡è§£æåˆ©å™¨"
date: "2023-08-02T01:04:37.610Z"
---
é‡è¿”ç…§ç‰‡çš„åŸå§‹ä¸–ç•Œï¼šæˆ‘ä¸º.NETæ‰“é€ çš„RAWç…§ç‰‡è§£æåˆ©å™¨
============================

æˆ‘ç†è§£æœ‰ç›¸æœºã€éœ€è¦ä½¿ç”¨ä»£ç å¤„ç† \`RAW\` æ ¼å¼ç…§ç‰‡çš„æœ‹å‹ç¡®å®ä¸å¤šï¼Œä½†éšç€ç°åœ¨è®¸å¤šæ‰‹æœºä¹Ÿå¼€å§‹æ”¯æŒRAWæ ¼å¼ç…§ç‰‡ï¼Œæˆ‘åšä¿¡è¿™ä¸ªå·¥å…·â€”â€”Sdcb.LibRawå°†ä¼šä¸ºé‚£äº›éœ€è¦å®ƒçš„äººå¸¦æ¥æå¤§çš„å¸®åŠ©ã€‚

é‡è¿”ç…§ç‰‡çš„åŸå§‹ä¸–ç•Œï¼šæˆ‘ä¸º.NETæ‰“é€ çš„RAWç…§ç‰‡è§£æåˆ©å™¨
============================

å¦‚æœä½ æ˜¯æˆ‘çš„è€è¯»è€…ï¼Œä½ å¯èƒ½è¿˜è®°å¾—ï¼Œåœ¨2019å¹´ï¼Œæˆ‘å†’é™©è¿›å…¥äº†ä¸€ç‰‡ç¥ç§˜çš„é¢†åŸŸâ€”â€”ç”¨`C#`è§£æ`RAW`æ ¼å¼çš„ç…§ç‰‡ï¼š

*   [20191208 - ç”¨.NETè§£ç´¢å°¼ç›¸æœºARWæ ¼å¼ç…§ç‰‡](https://www.cnblogs.com/sdflysha/p/20191208-read-sony-arw-file-using-dotnet.html)
*   [20191226 - .NETè§£æ‰€æœ‰ç›¸æœºRAWæ ¼å¼ç…§ç‰‡](https://www.cnblogs.com/sdflysha/p/20191226-read-camera-raw-using-dotnet-2.html)

åœ¨é‚£ä¸¤ç¯‡æ–‡ç« çš„å°¾å£°å¤„ï¼Œæˆ‘æ›¾ç»™è‡ªå·±å’Œå¤§å®¶ç•™ä¸‹äº†ä¸€ä¸ªæ‚¬å¿µï¼š

*   æˆ‘æ›¾å¸Œæœ›èƒ½æ·±å…¥ç ”ç©¶librawï¼Œå¯æ˜¯å®ƒåªæä¾›äº†C APIâ€¦â€¦
*   è™½ç„¶MagickImageè¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨å¤„ç†CR2ä¸Šä¼¼ä¹è¿˜æœ‰äº›ç‘•ç–µï¼Œæˆ‘æš—ç¤ºå¯èƒ½éœ€è¦å†å†™ä¸€ç¯‡æ–‡ç« æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€¦â€¦

æ—¶å…‰èè‹’ï¼Œä¸‰å¹´çš„æ—¶é—´è½¬çœ¼å°±è¿‡å»äº†ã€‚ç°åœ¨ï¼Œæˆ‘å¸Œæœ›å‘Šè¯‰å¤§å®¶ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼šæˆ‘ç»ˆäºå¡«è¡¥äº†è¿™ä¸ªå‘ï¼æˆ‘æŠ•å…¥å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ï¼Œè®¤çœŸç ”ç©¶äº†`libraw`è¿™ä¸ªåº“ï¼Œå¹¶ä¸”åŸºäºå®ƒçš„`C API`ï¼Œåˆ¶ä½œäº†ä¸€æ¬¾`C#`çš„PInvokeå°è£…ï¼š[Sdcb.LibRaw](https://github.com/sdcb/Sdcb.LibRaw)

NuGetåŒ…ç®€ä»‹
--------

å¦‚æœä½ å·²ç»å¯¹æˆ‘å…¶ä»–çš„å¼€æºé¡¹ç›®æœ‰æ‰€äº†è§£ï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨è¿™é‡Œï¼Œä½ åŒæ ·éœ€è¦åŒæ—¶å®‰è£…`.NET`å°è£…åŒ…å’Œè¿è¡Œæ—¶åŠ¨æ€åº“åŒ…ã€‚é¡¾åæ€ä¹‰ï¼Œå¸¦`runtime`çš„åŒ…å°±æ˜¯è¿è¡Œæ—¶åŒ…ï¼ˆæ¯”å¦‚`runtime.win64`ä»£è¡¨æ”¯æŒ64ä½Windowsï¼‰ï¼Œè€Œå®‰è£…çš„æ—¶å€™ä½ éœ€è¦åŒæ—¶å®‰è£…`.NET`å°è£…åŒ…å’Œè¿è¡Œæ—¶åŒ…ã€‚

ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¶µç›–äº†æ‰€æœ‰ä½ éœ€è¦çŸ¥é“çš„å…³äºè¿™äº›åŒ…çš„ä¿¡æ¯ï¼š

åŒ…å

NuGet

æˆæƒæ–¹å¼

æ³¨é‡Š

Sdcb.LibRaw

[![NuGet](https://img.shields.io/nuget/v/Sdcb.LibRaw.svg)](https://www.nuget.org/packages/Sdcb.LibRaw/)

MIT

.NETå°è£…åŒ…

Sdcb.LibRaw.runtime.win64

[![NuGet](https://img.shields.io/nuget/v/Sdcb.LibRaw.runtime.win64.svg)](https://www.nuget.org/packages/Sdcb.LibRaw.runtime.win64/)

LGPL-2.1-only OR CDDL-1.0

Windows x64 è¿è¡Œæ—¶

Sdcb.LibRaw.runtime.win32

[![NuGet](https://img.shields.io/nuget/v/Sdcb.LibRaw.runtime.win32.svg)](https://www.nuget.org/packages/Sdcb.LibRaw.runtime.win32/)

LGPL-2.1-only OR CDDL-1.0

Windows x86 è¿è¡Œæ—¶

Sdcb.LibRaw.runtime.linux64

[![NuGet](https://img.shields.io/nuget/v/Sdcb.LibRaw.runtime.linux64.svg)](https://www.nuget.org/packages/Sdcb.LibRaw.runtime.linux64/)

LGPL-2.1-only OR CDDL-1.0

Ubuntu 22.04 x64 è¿è¡Œæ—¶

æ‰€æœ‰è¿è¡Œæ—¶åŒ…ï¼Œæˆ‘éƒ½æ˜¯ä½¿ç”¨`vcpkg`ç¼–è¯‘è€Œæˆï¼Œè¿™åŒ…æ‹¬ä¸Šé¢çš„`linux`åŒ…ã€‚æˆ‘åœ¨`Ubuntu 22.04`ä¸Šè¿›è¡Œäº†ç¼–è¯‘ï¼Œå› æ­¤ï¼Œå¦‚æœä½ æƒ³åœ¨`docker`ä¸­ä½¿ç”¨ï¼Œä½ éœ€è¦é€‰æ‹©ä»¥`jammy`ç»“å°¾çš„`docker`é•œåƒï¼Œä¾‹å¦‚ï¼š`mcr.microsoft.com/dotnet/sdk:6.0-jammy`ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`Linux`è‡ªå¸¦çš„åŒ…ç®¡ç†ä¹Ÿè‡ªå¸¦äº†`LibRaw`ï¼Œä½†ç³»ç»Ÿè‡ªå¸¦çš„`LibRaw`ç”¨çš„æ˜¯è€ç‰ˆæœ¬ï¼Œå¯¼è‡´æœ¬è´¨å’Œæˆ‘çš„åŒ…äºŒè¿›åˆ¶ä¸å…¼å®¹ï¼Œå› æ­¤å¹¶ä¸èƒ½ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨æˆ‘ç¼–è¯‘çš„ã€‚

æˆ‘çš„`.NET`ä¸»åŒ…éµå¾ª`MIT`æˆæƒæ–¹å¼å¼€æºï¼Œå…¶å®ƒçš„åŒ…åˆ™é‡‡å–`LGPL-2.1-only OR CDDL-1.0`è¿™ç§æˆæƒæ–¹å¼ï¼ˆå—ä¸Šæ¸¸ä»£ç æŒ‡å®šï¼‰ã€‚

ä½¿ç”¨ç¤ºä¾‹
----

### 1\. RAWç…§ç‰‡è½¬Bitmap

ä½¿ç”¨å‰éœ€è¦å®‰è£…ä¸‹é¢è‡³å°‘2ä¸ª`NuGet`åŒ…ï¼š

*   Sdcb.LibRaw
*   Sdcb.LibRaw.runtime.win64ï¼ˆæˆ–è€…å…¶å®ƒç³»ç»ŸåŒ…ï¼‰

    using Sdcb.LibRaw;
    
    using RawContext r = RawContext.OpenFile(@"C:\a7r3\DSC02653.ARW");
    r.Unpack();
    r.DcrawProcess();
    using ProcessedImage image = r.MakeDcrawMemoryImage();
    using Bitmap bmp = ProcessedImageToBitmap(image);
    
    Bitmap ProcessedImageToBitmap(ProcessedImage rgbImage)
    {
        rgbImage.SwapRGB();
        using Bitmap bmp = new Bitmap(rgbImage.Width, rgbImage.Height, rgbImage.Width * 3, System.Drawing.Imaging.PixelFormat.Format24bppRgb, rgbImage.DataPointer);
        return new Bitmap(bmp);
    }
    

è¿™æ®µä»£ç ä¸»è¦æ¼”ç¤ºå¦‚ä½•å°†`RAW`ç…§ç‰‡è½¬æ¢ä¸º`Bitmap`å›¾åƒï¼Œæœ‰ä¸€ç‚¹å€¼å¾—ä¸€æï¼š`LibRaw`è¾“å‡ºçš„åƒç´ æ ¼å¼å’Œ`Bitmap`æœ‰äº›è®¸ä¸åŒï¼Œå…·ä½“ä½“ç°åœ¨çº¢è“ä¸¤è‰²éœ€è¦è°ƒæ¢ï¼Œä»£ç ä¸­ä½¿ç”¨`rgbImage.SwapRGB();`ç”¨æ¥è°ƒæ¢çº¢è‰²å’Œè“è‰²çš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯å°†`RGB24`è½¬æ¢æˆäº†`BGR24`ã€‚

è™½ç„¶è¿™ä¸ªç¤ºä¾‹åŸºäº`.ARW`ç…§ç‰‡ï¼Œä½†å®é™…ä¸Šå‡ ä¹æ‰€æœ‰`RAW`æ ¼å¼ç…§ç‰‡éƒ½æ˜¯æ”¯æŒçš„ï¼ŒåŒ…æ‹¬`.CR2`æˆ–è€…`.DNG`ï¼Œå¯ä»¥é€šè¿‡`RawContext.SupportedCameras`è·å–æ”¯æŒçš„ç›¸æœºåˆ—è¡¨ï¼Œæˆªæ­¢å½“å‰ç‰ˆæœ¬å®ƒæ”¯æŒäº†`1182`æ¬¾ç›¸æœºå‹å·ï¼š

    Console.WriteLine("Sdcb.LibRaw supported cameras:");
    foreach (string model in RawContext.SupportedCameras)
    {
    	Console.WriteLine(model);
    }
    

è¾“å‡ºå¦‚ä¸‹ï¼ˆæœ‰çœç•¥ï¼‰ï¼š

    Sdcb.LibRaw supported cameras:
    1: Adobe Digital Negative (DNG)
    2: AgfaPhoto DC-833m
    ...
    1057: Sony ILCE-1 (A1)
    ...
    1181: Zeiss ZX1
    1182: Zenit M
    

### 2\. WPFå’ŒOpenCVç¤ºä¾‹

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€äº›æ›´å¤æ‚çš„ç”¨ä¾‹ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ `WPF`ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç å°†`ProcessedImage`è½¬æ¢ä¸º`BitmapSource`ï¼š

    BitmapSource ProcessedImageToBitmapSource(ProcessedImage rgbImage)
    {
    	return BitmapSource.Create(rgbImage.Width, rgbImage.Height,
    		96, 96,
    		PixelFormats.Rgb24,
    		null,
    		rgbImage.AsSpan<byte>().ToArray(), 
    		rgbImage.Width * 3);
    }
    

å€¼å¾—ä¸€æçš„æ˜¯ `WPF` çš„å›¾ç‰‡ `BitmapSource` å¹¶ä¸éœ€è¦è°ƒæ¢ `R` å’Œ `B` ä¸¤ä¸ªé€šé“çš„é¢œè‰²ã€‚

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ `OpencvSharp4` ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç å°† `ProcessedImage` è½¬æ¢ä¸º`Mat`ï¼š

    Mat ProcessedImageToMat(ProcessedImage rgbImage)
    {
    	Mat mat = new Mat(rgbImage.Height, rgbImage.Width, MatType.CV_8UC3, rgbImage.AsSpan<byte>().ToArray());
    	Cv2.CvtColor(mat, mat, ColorConversionCodes.RGB2BGR);
    	return mat;
    }
    

è¯·æ³¨æ„ä¸Šé¢3ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘éƒ½ä½¿ç”¨äº†`.AsSpan<byte>().ToArray()`ç”¨æ¥å°†å†…å­˜å¤åˆ¶ä¸€ä»½ã€‚

è¿™æ ·ä¸€æ¥é¢å¤–ä¼šå¤åˆ¶ä¼šè®©æ€§èƒ½ç•¥å¾®é™ä½ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿`Bitmap`ã€`BitmapSource`æˆ–`Mat`çš„ç”Ÿå‘½å‘¨æœŸç”±è‡ªå·±æ¥ç®¡ç†ï¼Œå¦åˆ™å®ƒä»¬ä¼šå…±äº«ä½¿ç”¨`ProcessedImage`çš„å†…å­˜ï¼Œå¯¼è‡´æ„å¤–çš„æƒ…å†µã€‚

ä½†å¦‚æœä½ èƒ½æŒæ¡`ProcessedImage`çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¿è¯`ProcessedImage`ç”Ÿå‘½å‘¨æœŸæ¯”`Bitmap`/`BitmapSource`/`Mat`æ›´é•¿ï¼Œä½ å³å¯è§£é”0å†…å­˜å¤åˆ¶çš„åšæ³•ï¼ˆä»¥`OpenCV`ä¸ºä¾‹ï¼‰ï¼š

    // å°å¿ƒï¼Œä»£ç ç›´æ¥ä½¿ç”¨äº†ç”±ProcessedImageåˆ›å»ºçš„å†…å­˜
    Mat ProcessedImageToMatZeroCopy(ProcessedImage rgbImage)
    {
    	Mat mat = new Mat(rgbImage.Height, rgbImage.Width, MatType.CV_8UC3, rgbImage.DataPointer); // æ¢æˆrgbImage.DataPointer
    	Cv2.CvtColor(mat, mat, ColorConversionCodes.RGB2BGR);
    	return mat;
    }
    

### 3\. å›¾åƒåæœŸ

ä¸Šé¢ä»£ç å¾ˆç®€æ´ï¼Œä½†åˆ«è¢«è¿™ä¸ªç®€å•çš„å¤–è¡¨æ¬ºéª—äº†ï¼Œ`Sdcb.LibRaw`è¿˜æœ‰å¼ºå¤§å›¾åƒåæœŸèƒ½åŠ›ã€‚

`DcrawProcess()`å‡½æ•°æ”¯æŒä¼ å…¥ä¸€ä¸ª`Action<OutputParams>`ä½œä¸ºå‚æ•°ï¼Œä½ å¯ä»¥ä»è¿™ä¸ªå‚æ•°å®šä¹‰å¤šç§å›¾åƒåå¤„ç†åŠŸèƒ½ï¼Œä¾‹å¦‚ä½ å¯ä»¥è®¾ç½®Gammaæ›²çº¿çš„æŒ‡æ•°å’Œæ–œç‡ï¼Œè°ƒæ•´äº®åº¦ï¼Œç”šè‡³è®¾ç½®è£å‰ªåŒºåŸŸç­‰ï¼Œåƒè¿™æ ·ï¼š

    r.DcrawProcess(c =>
    {
        c.HalfSize = false; // å›¾ç‰‡åªä¿ç•™1/4å¤§å°
        c.UseCameraWb = true; // ä½¿ç”¨æœºå†…ç™½å¹³è¡¡ï¼Œfalseåˆ™ä¼šç”±UserMultipliersæ§åˆ¶ç™½å¹³è¡¡
        c.Gamma[0] = 0.35; // è°ƒæ•´Gammaæ›²çº¿æŒ‡æ•°
        c.Gamma[1] = 3.5;  // è°ƒæ•´Gammaæ›²çº¿æ–œç‡
        c.Brightness = 2.2f; // äº®åº¦
        c.Interpolation = true; // æ˜¯å¦æ‰§è¡Œåé©¬èµ›å…‹ï¼ˆdemosaicï¼‰æ“ä½œ
        c.OutputBps = 8; // è¾“å‡ºä½æ•°8ä½
        c.OutputTiff = false; // è¾“å‡ºä¸ºtiffæ–‡ä»¶ï¼Ÿfalseè¡¨ç¤ºè¾“å‡ºBitmap
        // c.Cropbox = new Rectangle(4000, 2000, 1500, 700); // è£åˆ‡
        // è¿˜æœ‰è®¸å¤šå…¶å®ƒè®¾ç½®å¯ä»¥è‡ªè¡Œæ¢ç´¢
    });
    

åŸå›¾ï¼š  
![](https://img2023.cnblogs.com/blog/233608/202308/233608-20230802085605055-375394601.png)

åº”ç”¨ç™½å¹³è¡¡ï¼š  
![](https://img2023.cnblogs.com/blog/233608/202308/233608-20230802085610942-1230961054.png)

æ‹‰ä¸€æ‹‰æ›²çº¿ï¼š  
![](https://img2023.cnblogs.com/blog/233608/202308/233608-20230802085616860-807506620.png)

### 4\. ä»`RAW`ç…§ç‰‡ä¸­è¯»å–ç¼©ç•¥å›¾

ç°åœ¨çš„`RAW`æ ¼å¼ç…§ç‰‡ä¸­å¾€å¾€ä¿å­˜ç€ä¸€å¼ æˆ–å¤šå¼ `JPEG`æ ¼å¼çš„ç¼©ç•¥å›¾ï¼Œç”¨`Sdcb.LibRaw`ä¹Ÿèƒ½è¯»å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå°†`ARW`ç…§ç‰‡ä¸­ç¬¬1å¼ ç¼©ç•¥å›¾è½¬æ¢ä¸º`Bitmap`çš„ç¤ºä¾‹ï¼š

    using Sdcb.LibRaw;
    
    using RawContext r = RawContext.OpenFile(@"C:\a7r3\DSC02653.ARW");
    using ProcessedImage image = r.ExportThumbnail(thumbnailIndex: 0);
    using Bitmap bmp = (Bitmap)Bitmap.FromStream(new MemoryStream(image.AsSpan<byte>().ToArray()));
    

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æˆ‘ä½¿ç”¨äº†`r.ExportThumbnail(thumbnailIndex: 0);`ï¼Œå®ƒå¯ä»¥å¯¼å‡ºç¬¬`0`å¼ ç¼©ç•¥å›¾ï¼Œè¯·æ³¨æ„è¿™ä¸ªæ˜¯ä¸€ä¸ªå¿«æ·å‡½æ•°ï¼Œå®ƒå†…éƒ¨ä¼šè°ƒç”¨äº†ä¸‹é¢2ä¸ªå‡½æ•°ï¼š

*   r.UnpackThumbnail()
*   r.MakeDcrawMemoryThumbnail()

è¯·æ³¨æ„å®ƒè½¬æ¢ä¸º`Bitmap`çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œç”±äºå®ƒçš„æ•°æ®æœ¬è´¨æ˜¯`JPEG`æ ¼å¼ï¼Œå› æ­¤ä¸å†éœ€è¦æ›´æ¢çº¢è‰²ã€è“è‰²çš„é€šé“ä½ç½®ï¼ŒåŒæ ·ä¹Ÿä¸éœ€è¦å…³æ³¨å®ƒçš„å®½åº¦å’Œé«˜åº¦ï¼ŒåŒæ ·çš„é“ç†å¦‚æœä½¿ç”¨`OpenCV`è§£ç ä¹Ÿåº”è¯¥ä½¿ç”¨`Cv2.ImDecode`ã€‚

### 5\. å°†`RAW`ç…§ç‰‡è½¬æ¢å¹¶ä¿å­˜ä¸ºæœ¬åœ°`tiff`æ–‡ä»¶

    using Sdcb.LibRaw;
    
    using RawContext r = RawContext.OpenFile(@"C:\a7r3\DSC02653.ARW");
    // r.SaveRawImage() is a shortcut for r.Unpack() + r.DcrawProcess() + r.WriteDcrawPpmTiff(fileName)
    r.SaveRawImage(@"C:\test\test.tiff");
    

åŒæ ·åœ°`r.SaveRawImage(@"C:\test\test.tiff");`ä¹Ÿæ˜¯`Sdcb.LibRaw`æä¾›çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œå®ƒå†…éƒ¨æŒ‰é¡ºåºè°ƒç”¨äº†ä¸‹é¢3ä¸ªå‡½æ•°ï¼š

*   r.Unpack()
*   r.DcrawProcess()
*   r.WriteDcrawPpmTiff()

### 5\. è·å–ç…§ç‰‡å…ƒæ•°æ®ä¿¡æ¯

ä»¥ä¸‹çš„ \`C#\`\` ä»£ç ä¸»è¦ç”¨äºä»æŒ‡å®šçš„ç…§ç‰‡æ–‡ä»¶è·å–å…¶å…ƒæ•°æ®ä¿¡æ¯ï¼Œç„¶åå°†å®ƒä»¬åœ¨æ§åˆ¶å°ä¸­è¾“å‡ºã€‚

    using RawContext r = RawContext.OpenFile(@"C:\a7r3\DSC02653.ARW");
    LibRawImageParams imageParams = r.ImageParams;
    LibRawImageOtherParams otherParams = r.ImageOtherParams;
    LibRawLensInfo lensInfo = r.LensInfo;
    
    Console.WriteLine($"ç›¸æœº: {imageParams.Model}");
    Console.WriteLine($"ç‰ˆæœ¬å·: {imageParams.Software}");
    Console.WriteLine($"ISO: {otherParams.IsoSpeed}");
    Console.WriteLine($"å¿«é—¨é€Ÿåº¦: 1/{1 / otherParams.Shutter:F0}s");
    Console.WriteLine($"ç„¦è·: {otherParams.FocalLength}mm");
    Console.WriteLine($"è‰ºæœ¯å®¶æ ‡ç­¾: {otherParams.Artist}");
    Console.WriteLine($"æ‹æ‘„æ—¥æœŸ: {new DateTime(1970, 1, 1, 8, 0, 0).AddSeconds(otherParams.Timestamp)}");
    Console.WriteLine($"é•œå¤´åç§°: {lensInfo.Lens}");
    

åœ¨æˆ‘çš„è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š

    ç›¸æœº: ILCE-7RM3
    ç‰ˆæœ¬å·: ILCE-7RM3 v3.10
    ISO: 100
    å¿«é—¨é€Ÿåº¦: 1/400s
    ç„¦è·: 50mm
    è‰ºæœ¯å®¶æ ‡ç­¾: Zhou Jie/sdcb
    æ‹æ‘„æ—¥æœŸ: 2023/1/26 12:54:01
    é•œå¤´åç§°: FE 50mm F1.2 GM
    

æ€§èƒ½ä¸æ–¹æ¡ˆæ¯”è¾ƒ
-------

### Sdcb.LibRaw

é¦–å…ˆè¿™æ˜¯ä½¿ç”¨ `Sdcb.LibRaw` çš„æ€§èƒ½æµ‹è¯•ä»£ç ï¼š

    var sw = Stopwatch.StartNew();
    using RawContext r = RawContext.OpenFile(@"C:\Users\ZhouJie\Pictures\a7r3\11030126\DSC02653.ARW");
    r.Unpack();
    r.DcrawProcess();
    Console.WriteLine($"è€—æ—¶ï¼š{sw.ElapsedMilliseconds}ms");
    

è¾“å‡ºå¦‚ä¸‹ï¼š

    è€—æ—¶ï¼š1627ms
    

### Windows Imaging Component

ä¹‹å‰çš„æ–‡ç« è¯´è¿‡ï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„`WIC`è¿›è¡ŒRAWç…§ç‰‡è§£ç ï¼š

    // éœ€è¦å®‰è£…NuGetåŒ…ï¼šVortices.Direct2D1
    Stopwatch sw = Stopwatch.StartNew();
    IWICImagingFactory2 wic = new IWICImagingFactory2();
    using IWICBitmapDecoder decoder = wic.CreateDecoderFromFileName(@"C:a7r3\DSC02653.ARW");
    using IWICFormatConverter converter = wic.CreateFormatConverter();
    converter.Initialize(decoder.GetFrame(0), PixelFormat.Format24bppBGR);
    var data = new byte[converter.Size.Width * 3 * converter.Size.Height];
    converter.CopyPixels(converter.Size.Width * 3, data);
    Console.WriteLine($"è€—æ—¶ï¼š{sw.ElapsedMilliseconds}ms");
    
    // ä¸‹é¢è½¬Bitmap
    // fixed (byte* pdata = data)
    // {
    // 	new System.Drawing.Bitmap(converter.Size.Width, converter.Size.Height, converter.Size.Width * 3, System.Drawing.Imaging.PixelFormat.Format24bppRgb, (IntPtr)pdata).DumpUnscaled();
    // }
    

è¾“å‡ºå¦‚ä¸‹ï¼š

    è€—æ—¶ï¼š2177ms
    

è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯å®ƒæ— æ³•å¯¹ `RAW` ç…§ç‰‡åšä¸€äº›åå¤„ç†ã€‚

### Magick.NET

å¦å¤–è¿™æ˜¯åŸºäº`Magick.NET-Q8-x64`çš„ä»£ç ï¼Œéå¸¸ç®€å•ï¼š

    Stopwatch sw = Stopwatch.StartNew();
    using MagickImage image = new MagickImage(@"C:\a7r3\DSC02653.ARW");
    Console.WriteLine($"è€—æ—¶ï¼š{sw.ElapsedMilliseconds}ms");
    

è¾“å‡ºå¦‚ä¸‹ï¼š

    è€—æ—¶ï¼š5496ms
    

è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯å®ƒæ˜æ˜¾æ…¢ä¸€äº›ï¼Œä¸”å®ƒçš„åå¤„ç†éƒ½å¹¶éåŸºäºæ‹œå°”æ•°æ®ï¼Œå› æ­¤åæœŸç©ºé—´æœ‰é™ã€‚

### åŸç”ŸCä»£ç 

å¦å¤–ä½œä¸ºå‚è€ƒï¼Œæˆ‘è¿˜å†™äº†ä¸€ä»½åŸºäº `LibRaw C API` çš„ä»£ç ï¼Œä»£ç å¦‚ä¸‹ï¼š

    #include <libraw\libraw.h>
    #include <chrono>
    
    int main()
    {
    	auto start = std::chrono::high_resolution_clock::now();
    	libraw_data_t* data = libraw_init(0);
    	libraw_open_file(data, "C:\\a7r3\\DSC02653.ARW");
    	libraw_unpack(data);
    	libraw_dcraw_process(data);
    	auto end = std::chrono::high_resolution_clock::now();
    	printf("è€—æ—¶: %lld ms\n", std::chrono::duration_cast<std::chrono::milliseconds>(end - start).count());
    
    	libraw_recycle(data);
    	libraw_close(data);
    }
    

è¾“å‡ºå¦‚ä¸‹ï¼š

    è€—æ—¶: 1619 ms
    

### æ¯”è¾ƒè¡¨æ ¼

æ–¹æ¡ˆåç§°

è€—æ—¶ï¼ˆmsï¼‰

è¯´æ˜

Sdcb.LibRaw

1627

Windows Imaging Component(WIC)

2177

åæœŸç©ºé—´æœ‰é™

Magick.NET

5496

åæœŸç©ºé—´æœ‰é™

åŸç”ŸCä»£ç 

1619

å¯è§ï¼Œ`Sdcb.LibRaw` æ€§èƒ½åœ¨ç¬¬ä¸€æ¢¯é˜Ÿï¼Œä¸”åå¤„ç†æ˜¯åŸºäºæ‹œå°”æ•°æ®ï¼Œèƒ½åŠ›è¾ƒå¼ºã€‚

ç»“è¯­
==

æˆ‘ç†è§£æœ‰ç›¸æœºã€éœ€è¦ä½¿ç”¨ä»£ç å¤„ç† `RAW` æ ¼å¼ç…§ç‰‡çš„æœ‹å‹ç¡®å®ä¸å¤šï¼Œä½†éšç€æ™ºèƒ½æ‰‹æœºçš„å‘å±•ï¼Œè®¸å¤šæ‰‹æœºä¹Ÿèƒ½æ‹å‡ºRAWæ ¼å¼ç…§ç‰‡äº†ï¼Œæˆ‘åšä¿¡è¿™ä¸ªå·¥å…·å°†ä¼šä¸ºé‚£äº›éœ€è¦å®ƒçš„äººå¸¦æ¥æå¤§çš„å¸®åŠ©ã€‚æˆ‘å°†ç»§ç»­åœ¨è¿™ä¸ªé¢†åŸŸä¸Šä»˜å‡ºåŠªåŠ›ï¼Œä¸º `Sdcb.LibRaw` æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œå¹¶è§£å†³å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚

ä¸Šè¿°å†…å®¹ä»…ä»…æ˜¯æˆ‘æ‰€æ‰“é€ çš„ `Sdcb.LibRaw` åº“ä¸­çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå®ƒçš„å¼ºå¤§åŠŸèƒ½å’Œé«˜æ•ˆæ€§èƒ½å°†ä¸ºä½ å¤„ç† `RAW` æ ¼å¼ç…§ç‰‡å¸¦æ¥å‰æ‰€æœªæœ‰çš„ä¾¿æ·ã€‚æˆ‘çœŸå¿ƒå¸Œæœ›æ›´å¤šçš„ `.NET` çˆ±å¥½è€…èƒ½å¤ŸåŠ å…¥æˆ‘ï¼Œä¸€èµ·æ¢ç´¢ `RAW` ç…§ç‰‡å¤„ç†çš„ä¸–ç•Œï¼Œ`Sdcb.LibRaw` å°†å§‹ç»ˆä¿æŒå¥½ç”¨ä¸”å…è´¹ï¼Œè®©æˆ‘ä»¬å…±åŒæœŸå¾…å®ƒçš„æ›´å¤šç²¾å½©ï¼

æœ‰å…´è¶£å°è¯• `Sdcb.LibRaw` çš„æœ‹å‹ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„ [Github](https://github.com/sdcb/Sdcb.LibRaw)ï¼Œä¹Ÿè¯·ç»™ä¸ª StarğŸŒŸ

å¦‚æœä½ å–œæ¬¢æˆ‘çš„å·¥ä½œï¼Œè¯·å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šã€DotNetéªšæ“ä½œã€‘

![DotNetéªšæ“ä½œ](https://img2018.cnblogs.com/blog/233608/201908/233608-20190825165420518-990227633.jpg)