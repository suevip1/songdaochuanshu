---
layout: post
title: "rnacoså®ç°raftå’Œç±»distroåè®®ï¼Œæ”¯æŒé›†ç¾¤éƒ¨ç½²"
date: "2023-09-18T00:57:28.578Z"
---
rnacoså®ç°raftå’Œç±»distroåè®®ï¼Œæ”¯æŒé›†ç¾¤éƒ¨ç½²
=============================

rnacosæ˜¯ä¸€ä¸ªç”¨rustå®ç°çš„nacosæœåŠ¡ã€‚ rnacosç›¸è¾ƒäºjava nacosæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªæä¾›ç›¸åŒåŠŸèƒ½ï¼Œå¯åŠ¨æ›´å¿«ã€å ç”¨ç³»ç»Ÿèµ„æºæ›´å°ã€æ€§èƒ½æ›´é«˜ã€è¿è¡Œæ›´ç¨³å®šçš„æœåŠ¡ã€‚ rnacosä¹‹å‰åªæ”¯æŒå•æœºéƒ¨ç½²ï¼Œä¸èƒ½æ°´å¹³æ‰©å®¹ï¼ŒåŒæ—¶å­˜åœ¨å•ç‚¹ç¨³å®šæ€§é—®é¢˜ï¼Œä¸å¤ªåˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚æ‰€ä»¥rnacosä¸€ç›´æœ‰è®¡åˆ’å¼€å‘æ”¯æŒé›†ç¾¤éƒ¨ç½²çš„åŠŸèƒ½ã€‚ ç›®å‰rnacos 0.3.1ç‰ˆæœ¬å·²æ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚

1\. rnacos ç®€ä»‹
-------------

[rnacos](https://github.com/heqingpan/rnacos)æ˜¯ä¸€ä¸ªç”¨rustå®ç°çš„nacosæœåŠ¡ã€‚

rnacosæ˜¯ä¸€ä¸ªè½»é‡ã€ å¿«é€Ÿã€ç¨³å®šã€é«˜æ€§èƒ½çš„æœåŠ¡ï¼›åŒ…å«æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€webç®¡ç†æ§åˆ¶å°åŠŸèƒ½ï¼Œæ”¯æŒå•æœºã€é›†ç¾¤éƒ¨ç½²ã€‚

rnacosè®¾è®¡ä¸Šå®Œå…¨å…¼å®¹æœ€æ–°ç‰ˆæœ¬nacosé¢å‘client sdk çš„åè®®ï¼ˆåŒ…å«1.xçš„http OpenApiï¼Œå’Œ2.xçš„grpcåè®®ï¼‰, æ”¯æŒä½¿ç”¨nacosæœåŠ¡çš„åº”ç”¨å¹³è¿åˆ° rnacosã€‚

rnacosç›¸è¾ƒäºjava nacosæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªæä¾›ç›¸åŒåŠŸèƒ½ï¼Œå¯åŠ¨æ›´å¿«ã€å ç”¨ç³»ç»Ÿèµ„æºæ›´å°ã€æ€§èƒ½æ›´é«˜ã€è¿è¡Œæ›´ç¨³å®šçš„æœåŠ¡ã€‚

2\. rnacosæ”¯æŒé›†ç¾¤éƒ¨ç½²
----------------

rnacosä¹‹å‰åªæ”¯æŒå•æœºéƒ¨ç½²ï¼Œä¸èƒ½æ°´å¹³æ‰©å®¹ï¼ŒåŒæ—¶å­˜åœ¨å•ç‚¹ç¨³å®šæ€§é—®é¢˜ï¼Œä¸å¤ªåˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚æ‰€ä»¥rnacosä¸€ç›´æœ‰è®¡åˆ’å¼€å‘æ”¯æŒé›†ç¾¤éƒ¨ç½²çš„åŠŸèƒ½ã€‚

ç›®å‰rnacos 0.3.1ç‰ˆæœ¬å·²æ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚å…¶ä¸­é…ç½®ä¸­å¿ƒé€šè¿‡raftåè®®æ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼Œæ³¨å†Œä¸­å¿ƒé€šè¿‡ç±»distroåè®®æ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚

rnacosä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š

![](https://img2023.cnblogs.com/blog/177267/202309/177267-20230918000100553-278416441.png)

### 2.1 ä¸ºä»€ä¹ˆåœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­ï¼Œé…ç½®ä¸­å¿ƒã€æ³¨å†Œä¸­å¿ƒéœ€è¦å®ç°ä¸¤ä¸ªä¸åŒçš„åè®®æ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼Ÿ

ä¸»è¦å› ä¸ºé…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒçš„ç‰¹ç‚¹ä¸ä¸€æ ·ã€‚

é…ç½®ä¸­å¿ƒçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œåœ¨å¤šä¸ªæœåŠ¡èŠ‚ç‚¹ä¸­çš„æ•°æ®éœ€è¦å¼ºä¸€è‡´ï¼Œraftæ˜¯ä¸€ä¸ªé€»è¾‘å®Œå¤‡çš„åˆ†é¡µå¼å…±è¯†åè®®ã€‚å®ç°raftåè®®åªè¦å¤§äºåŠæ•°çš„èŠ‚ç‚¹æ­£å¸¸ï¼Œå°±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ã€‚ åŒæ—¶å®ä¾‹raftåè®®å°±ç›¸å½“äºå®ç°ä¸€ä¸ªåˆ†é¡µå¼å­˜å‚¨ï¼Œé…ç½®ä¸­å¿ƒå¯ä»¥ä¸éœ€è¦é¢å¤–ä¾èµ– mysql ç­‰å¤–éƒ¨æ•°æ®åº“ï¼Œéƒ¨ç½²ä¾èµ–æ›´ç®€å•ã€‚ æ‰€ä»¥é…ç½®ä¸­å¿ƒé€‰æ‹©é€šè¿‡raftåè®®æ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚

æ³¨å†Œä¸­å¿ƒçš„æ•°æ®ä¸»è¦æ˜¯ä¸´æ—¶çš„æœåŠ¡å®ä¾‹æ•°æ®ï¼Œè¿™ç±»æ•°æ®ä¸éœ€è¦æŒä¹…åŒ–ï¼Œä¸è¿½æ±‚å¤šä¸ªæœåŠ¡èŠ‚ç‚¹ä¸­çš„æ•°æ®å¼ºä¸€è‡´ã€‚åŒæ—¶æ³¨å†Œä¸­å¿ƒæ›´å…³æ³¨åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¼‚å¸¸æ—¶èƒ½æä¾›å®Œæ•´çš„æœåŠ¡ï¼Œæ›´è§‚æ³¨é›†ç¾¤çš„è¯»å†™æ€§èƒ½ã€‚æ‰€ä»¥æ³¨å†Œä¸­å¿ƒä¸é€‰æ‹© raft åè®®ï¼Œè€Œæ˜¯é€šè¿‡ç±» distroåè®®æ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚

åŠŸèƒ½æ¨¡å—åè®®çš„å¯¹æ¯”ï¼š

æ¨¡å—

åè®®

å†™æ€§èƒ½

è¯»æ€§èƒ½

æ•°æ®ä¸€è‡´æ€§

å®¹é”™ç‡

é…ç½®ä¸­å¿ƒ

raft

ä¸€èˆ¬(åªæœ‰ä¸»èŠ‚ç‚¹å¯å†™)

é«˜,æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯è¯»

å¼ºä¸€è‡´

ä¸€èˆ¬,å¤§äºåŠæ•°èŠ‚ç‚¹æ­£å¸¸åˆ™å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡

æ³¨å†Œä¸­å¿ƒ

distro

é«˜(æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯å†™)

é«˜,æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯è¯»

ä¸€èˆ¬

é«˜,ä¸€ä¸ªèŠ‚ç‚¹èƒ½ä¸ä¾èµ–å…¶å®ƒä¾èµ–æä¾›æœåŠ¡

### 2.2 é…ç½®ä¸­å¿ƒraftåè®®

raftåè®®çš„ä¸»è¦é€»è¾‘ï¼š

1.  èŠ‚ç‚¹åŒºåˆ†è§’è‰²ï¼šleader(ä¸»èŠ‚ç‚¹),follower(ä»èŠ‚ç‚¹),candidate(é€‰ä¸¾èŠ‚ç‚¹);
2.  ç¨³å®šçŠ¶æ€æ˜¯ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¤šä¸ªä»èŠ‚ç‚¹ï¼›
3.  ä¸»èŠ‚ç‚¹è´Ÿè´£å†™å…¥ï¼Œå†™å…¥æ—¶éœ€è¦å…ˆæŠŠå†™å…¥æ—¥å¿—åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œè¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æ—¥å¿—æˆåŠŸåæ‰èƒ½æäº¤æ—¥å¿—åˆ°çŠ¶æ€æœºã€‚
4.  ä¸»èŠ‚ç‚¹éœ€è¦å®šæ—¶å‘å¿ƒè·³åˆ°ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹å¦‚æœè¶…æ—¶æœªæ”¶åˆ°å¿ƒè·³ï¼Œåˆ™ä¼šå‘èµ·é€‰ä¸¾ã€‚é€‰ä¸¾æ—¶æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„åŒæ„ï¼Œå°±å¯ä»¥åˆ‡æ¢æˆä¸»èŠ‚ç‚¹ã€‚

å…·ä½“åè®®å¯ä»¥å‚è€ƒ [raftåè®®è®ºæ–‡](https://docs.qq.com/doc/DY0VxSkVGWHFYSlZJ)

rnacos æ¥å…¥ raftçš„ä¸»è¦é€»è¾‘ï¼š

1.  åŸºäº async-raft åº“å®ç°raftåè®®ï¼Œä¸»è¦å®ç°ç½‘ç»œå±‚å’Œå­˜å‚¨å±‚ã€‚åœ¨ rnacosä¸­å­˜å‚¨å±‚çš„çŠ¶æ€æœºå°±æ˜¯é…ç½®ä¸­å¿ƒã€‚
2.  é…ç½®ä¸­å¿ƒæ¥å…¥raft åè®®çš„çŠ¶æ€æœºï¼Œç”± raft çŠ¶æ€æœºé©±åŠ¨æ›´æ–°é…ç½®ä¸­å¿ƒçš„å†…å®¹ã€‚

rnacosä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é…ç½®ä¸­å¿ƒè¯·æ±‚å¤„ç†ç¤ºä¾‹ï¼š

![](https://img2023.cnblogs.com/blog/177267/202309/177267-20230918000011833-343005355.png)

å†™å…¥:

1.  å®¢æˆ·ç«¯éšæœºå‘ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªæ›´æ–°é…ç½®è¯·æ±‚
2.  åœ¨è¯·æ±‚å…¥å£å±‚åŠ ä¸€ä¸ªraftè·¯ç”±åˆ¤æ–­ï¼Œå¦‚æœæœ¬èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹åˆ™å¤„ç†ï¼Œå¦åˆ™è·¯ç”±åˆ°æŒ‡å®šä¸»èŠ‚ç‚¹å¤„ç†
3.  ä¸»èŠ‚ç‚¹å†™å…¥è¯·æ±‚åˆ°raftæ—¥å¿—
4.  å°†è¯·æ±‚åŒæ­¥åˆ°å…¶å®ƒä»èŠ‚ç‚¹
5.  å¦‚æœè¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æ—¥å¿—æˆåŠŸï¼ˆåŒ…å«è‡ªèº«ï¼‰ï¼Œåˆ™æäº¤è¯·æ±‚æ—¥å¿—åˆ°çŠ¶æ€æœºä¸­ï¼Œé…ç½®å†™å…¥é…ç½®ä¸­å¿ƒã€‚ï¼ˆå…¶å®ƒä»èŠ‚ç‚¹çš„æäº¤åœ¨ä¸‹æ¬¡æ—¥å¿—åŒæ­¥æˆ–å¿ƒè·³æ—¶æäº¤ï¼‰
6.  è¿”å›å¤„ç†ç»“æœ

è¯·æ±‚ï¼š

1.  å®¢æˆ·ç«¯éšæœºå‘ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªæŸ¥è¯¢é…ç½®è¯·æ±‚
2.  æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹å’Œå•æœºå¤„ç†ä¸€æ ·ï¼Œç›´æ¥æŸ¥è¯¢æœ¬èŠ‚ç‚¹é…ç½®ä¸­å¿ƒæ•°æ®è¿”å›ã€‚

### 2.3 æ³¨å†Œä¸­å¿ƒç±»distroåè®®

åè®®ä¸»è¦é€»è¾‘ï¼š

1.  æ¯ä¸ªèŠ‚ç‚¹æœ‰å…¨é‡çš„æ•°æ®ï¼Œéƒ½å¯æä¾›æ³¨å†Œä¿¡æ¯æŸ¥è¯¢æœåŠ¡ã€‚
2.  æ³¨å†Œä¸­å¿ƒæ¯ä¸ªèŠ‚ç‚¹å¹³ç­‰ï¼ŒæŒ‰hashåˆ’åˆ†æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£çš„å†…å®¹ï¼›èŠ‚ç‚¹å¯¹è´Ÿè´£çš„æœåŠ¡å¯å†™ï¼Œå¦åˆ™è½¬å‘åˆ°å¯¹åº”è´Ÿè´£çš„èŠ‚ç‚¹å¤„ç†ã€‚
3.  é€šè¿‡ grpcåè®®æ³¨å†Œçš„æœåŠ¡ï¼Œæ¥æ”¶çš„èŠ‚ç‚¹ç›´æ¥å¤„ç†ã€‚
4.  ä¸€ä¸ªèŠ‚ç‚¹æ›´æ–°æœåŠ¡å®ä¾‹ä¿¡æ¯åå†åŒæ­¥ç»™å…¶å®ƒèŠ‚ç‚¹ã€‚

å…·ä½“åè®®å¯ä»¥å‚è€ƒjava nacos çš„distroåè®®å®ç° ã€‚  
rnacos å’Œ javaç‰ˆä¸»ä½“é€»è¾‘ç›¸åŒï¼Œä½†å®ç°çš„ç»†èŠ‚æœ‰äº›åŒºåˆ«ã€‚

rnacosä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„æ³¨å†Œä¸­å¿ƒè¯·æ±‚å¤„ç†ç¤ºä¾‹ï¼š

![](https://img2023.cnblogs.com/blog/177267/202309/177267-20230918000047346-1714651250.png)

http å†™å…¥ï¼š

1.  å®¢æˆ·ç«¯éšæœºå‘ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªæ³¨å†ŒæœåŠ¡å®ä¾‹è¯·æ±‚
2.  è¯·æ±‚è·³è¿‡æœåŠ¡è·¯ç”±åˆ¤æ–­ï¼Œå¦‚æœæœåŠ¡è·¯ç”±çš„èŠ‚ç‚¹æ˜¯æœ¬èŠ‚ç‚¹åˆ™å¤„ç†ï¼Œå¦åˆ™è·¯ç”±åˆ°æŒ‡å®šçš„å…¶å®ƒèŠ‚ç‚¹å¤„ç†
3.  æ”¶åˆ°æœ¬èŠ‚ç‚¹è´Ÿè´£çš„æœåŠ¡å®ä¾‹è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸­
4.  è¿”å›å¤„ç†ç»“æœ
5.  å¼‚æ­¥åŒæ­¥æ›´æ–°çš„æ•°æ®åˆ°å…¶å®ƒèŠ‚ç‚¹

grpc å†™å…¥ï¼ˆä¸è·¯ç”±ï¼Œæœ¬èŠ‚ç‚¹ç›´æ¥å¤„ç†ï¼‰ï¼š

1.  å®¢æˆ·ç«¯éšæœºå‘ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·grpcé•¿é“¾æ¥
2.  å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªæ³¨å†ŒæœåŠ¡å®ä¾‹è¯·æ±‚
3.  åƒå•æœºä¸€æ ·ï¼ŒæŠŠè¯·æ±‚æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸­
4.  è¿”å›å¤„ç†ç»“æœ
5.  å¼‚æ­¥åŒæ­¥æ›´æ–°çš„æ•°æ®åˆ°å…¶å®ƒèŠ‚ç‚¹

æŸ¥è¯¢ï¼š

1.  å®¢æˆ·ç«¯éšæœºå‘ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªæŸ¥è¯¢æœåŠ¡ä¿¡æ¯è¯·æ±‚
2.  æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹å’Œå•æœºå¤„ç†ä¸€æ ·ï¼Œç›´æ¥æŸ¥è¯¢æœ¬èŠ‚ç‚¹æ³¨å†Œä¸­å¿ƒæ•°æ®è¿”å›ã€‚

#### ä¸ºä»€ä¹ˆhttpçš„å†™å…¥ä¸grpcå†™å…¥çš„è·¯ç”±é€»è¾‘ä¸åŒï¼Ÿ

å› ä¸ºgrpcçš„å¿ƒè·³æ˜¯æŒ‰é•¿é“¾æ¥æ¥å¤„ç†ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯çš„é“¾æ¥æ®µå¼€ï¼Œåˆ™è¿™ä¸ªé“¾æ¥çš„æ‰€ç”¨è¯·æ±‚éƒ½å¤±æ•ˆã€‚ã€é«˜æ•ˆã€‘  
ç„¶å http çš„å®ä¾‹æ³¨å†Œæ˜¯æ— çŠ¶æ€çš„ï¼Œåªèƒ½é€šè¿‡å®šæ—¶å™¨æŒ‰æ³¨å†Œæ—¶é—´æ›´æ–°å®ä¾‹çš„çŠ¶æ€ï¼›åŒæ—¶æ³¨å†Œä¸­å¿ƒä¸­å®ä¾‹æ˜¯æŒ‰æœåŠ¡åˆ†ç±»ç»´æŠ¤çš„ï¼Œæ‰€ä»¥ http æ³¨å†Œçš„å®ä¾‹éœ€è¦æŒ‰æœåŠ¡åšè·¯ç”±ï¼Œè¿™æ ·æ‰èƒ½æ”¯æŒä¸åŒçš„èŠ‚ç‚¹è´Ÿè´£ä¸åŒèŒƒå›´çš„æœåŠ¡ã€‚ã€ä½æ•ˆã€‘

æ‰€ä»¥åœ¨æ³¨å†Œä¸­å¿ƒä½¿ç”¨grpcåè®®çš„æ€§èƒ½ä¼šæ¯”httpåè®®æ€§èƒ½å¥½å¾ˆå¤šã€‚

3\. æ€§èƒ½ä¸å®¹é‡
---------

rnacos æ”¯æŒé›†ç¾¤åå…¶æ€§èƒ½ä¸å®¹é‡çš„æ°´ä½æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ

ä¸‹é¢ç»™å‡ºä¸€ç»„åœ¨æˆ‘å°å¼ç”µè„‘(8æ ¸16çº¿ç¨‹+16å†…å­˜)çš„å‹æµ‹æ€§èƒ½å¯¹æ¯”æ•°æ®.

ä¸»è¦ä½¿ç”¨gooseå‹æµ‹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé¡¹ç›®ä¸­çš„å­å‹æµ‹å·¥ç¨‹ [loadtest](https://github.com/heqingpan/rnacos/tree/master/loadtest)

#### æ€§èƒ½å‹æµ‹ç»“æœ

æ¨¡å—

åœºæ™¯

å•èŠ‚ç‚¹qps

é›†ç¾¤qps

æ€»ç»“

é…ç½®ä¸­å¿ƒ

é…ç½®å†™å…¥,å•æœºæ¨¡å¼

1.5ä¸‡

1.5ä¸‡

é…ç½®ä¸­å¿ƒ

é…ç½®å†™å…¥,é›†ç¾¤æ¨¡å¼

1.8åƒ

1.5åƒ

æ¥å…¥raftåæ²¡æœ‰å……åˆ†ä¼˜åŒ–,å¾…ä¼˜åŒ–,ç†è®ºä¸Šå¯æ¥è¿‘å•æœºæ¨¡å¼

é…ç½®ä¸­å¿ƒ

é…ç½®æŸ¥è¯¢

8ä¸‡

n\*8ä¸‡

é›†ç¾¤çš„æŸ¥è¯¢æ€»qpsæ˜¯èŠ‚ç‚¹çš„å€æ•°

æ³¨å†Œä¸­å¿ƒ

æœåŠ¡å®ä¾‹æ³¨å†Œ,httpåè®®

1.2ä¸‡

1.0ä¸‡

æ³¨å†Œä¸­å¿ƒå•æœºæ¨¡å¼ä¸é›†ç¾¤æ¨¡å¼å†™å…¥çš„æ€§èƒ½ä¸€è‡´

æ³¨å†Œä¸­å¿ƒ

æœåŠ¡å®ä¾‹æ³¨å†Œ,grpcåè®®

1.2ä¸‡

1.2ä¸‡

grpcåè®®å‹æµ‹å·¥å…·æ²¡æœ‰æ”¯æŒï¼Œç›®å‰æ²¡æœ‰å®é™…å‹æµ‹ï¼Œç†è®ºä¸ä¼šæ¯”httpåè®®ä½

æ³¨å†Œä¸­å¿ƒ

æœåŠ¡å®ä¾‹å¿ƒè·³,httpåè®®

1.2ä¸‡

1.0ä¸‡

å¿ƒè·³æ˜¯æŒ‰å®ä¾‹è®¡ç®—å’ŒæœåŠ¡å®ä¾‹æ³¨å†Œä¸€è‡´å…±äº«qps

æ³¨å†Œä¸­å¿ƒ

æœåŠ¡å®ä¾‹å¿ƒè·³,grpcåè®®

8ä¸‡ä»¥ä¸Š

n\*8ä¸‡

å¿ƒè·³æ˜¯æŒ‰è¯·æ±‚é“¾æ¥è®¡ç®—,ä¸”ä¸è¿‡æ³¨å†Œä¸­å¿ƒå¤„ç†çº¿ç¨‹,æ¯ä¸ªèŠ‚ç‚¹åªéœ€ç®¡ç†å½“å‰èŠ‚ç‚¹çš„å¿ƒè·³ï¼Œé›†ç¾¤æ€»å¿ƒè·³qpsæ˜¯èŠ‚ç‚¹çš„å€æ•°

æ³¨å†Œä¸­å¿ƒ

æŸ¥è¯¢æœåŠ¡å®ä¾‹

3ä¸‡

n\*3ä¸‡

é›†ç¾¤çš„æŸ¥è¯¢æ€»qpsæ˜¯èŠ‚ç‚¹çš„å€æ•°

**æ³¨ï¼š** å…·ä½“ç»“æœå’Œå‹æµ‹ç¯å¢ƒæœ‰å…³

#### å‹æµ‹è®°å½•

æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢(å•æœº3ä¸‡ qps)ï¼š

![](https://img2023.cnblogs.com/blog/177267/202309/177267-20230918000305369-824488705.png)

é…ç½®ä¸­å¿ƒæŸ¥è¯¢ï¼Œä¸¤ä¸ªè¿›ç¨‹åˆ†åˆ«é™æµ4ä¸‡qpsåŒæ—¶å‹æµ‹(å…±8ä¸‡qps)ï¼Œå…¶ä¸­ä¸€ä¸ªçš„å‹æµ‹è®°å½•ï¼š

![](https://img2023.cnblogs.com/blog/177267/202309/177267-20230918000413618-874504518.png)

### å®¹é‡åˆ†æ

#### é…ç½®ä¸­å¿ƒ

1.  é…ç½®ä¸­å¿ƒçš„å•æœºæŸ¥è¯¢8ä¸‡qpsï¼Œå¾ˆé«˜ï¼Œåˆæ”¯æŒæ°´å¹³æ‰©å®¹ï¼›é›†ç¾¤åŸºæœ¬æ²¡æœ‰æŸ¥è¯¢ç“¶é¢ˆã€‚
2.  é…ç½®ä¸­å¿ƒæ‰€å ç”¨çš„å†…å­˜å’Œé…ç½®å†…å­˜æœ‰å…³ï¼Œåœ¨å†…å­˜æ²¡æœ‰æ»¡å‰ï¼ŒåŸºæœ¬æ²¡æœ‰ç“¶é¢ˆã€‚
3.  é…ç½®ä¸­å¿ƒé›†ç¾¤å†™å…¥æ—¶ç»Ÿä¸€åœ¨ä¸»èŠ‚ç‚¹å†™å…¥ï¼Œå†™å…¥å¯èƒ½æœ‰ç“¶é¢ˆï¼›ç›®å‰1.5åƒtps,åé¢ä¼˜åŒ–ååº”è¯¥èƒ½åˆ°1ä¸‡ tpsä»¥ä¸Šã€‚

#### æ³¨å†Œä¸­å¿ƒ

1.  æ³¨å†Œä¸­å¿ƒçš„å•æœºæŸ¥è¯¢3ä¸‡qpsï¼Œæ¯”è¾ƒé«˜ï¼Œåˆæ”¯æŒæ°´å¹³æ‰©å®¹ï¼›é›†ç¾¤åŸºæœ¬æ²¡æœ‰æŸ¥è¯¢ç“¶é¢ˆã€‚
2.  æ³¨å†Œä¸­å¿ƒæ‰€å ç”¨çš„å†…å­˜å’Œé…ç½®å†…å­˜æœ‰å…³ï¼Œåœ¨å†…å­˜æ²¡æœ‰æ»¡å‰ï¼ŒåŸºæœ¬æ²¡æœ‰ç“¶é¢ˆã€‚
3.  æ³¨å†Œä¸­å¿ƒé›†ç¾¤å†™å…¥æ—¶æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦å†™ä¸€éï¼Œæ•´ä½“é›†ç¾¤çš„å†™å…¥æ€§èƒ½tpså’Œå•æœºç†è®ºä¸Šç›¸å½“ã€‚
4.  httpåè®®(v1.xç‰ˆæœ¬)å’Œgrpcåè®®(v2.x)çš„å¿ƒè·³ç»´æŠ¤æœºåˆ¶ä¸åŒï¼›httpå¿ƒè·³æ˜¯æŒ‰å®ä¾‹è®¡ç®—å’ŒæœåŠ¡å®ä¾‹æ³¨å†Œä¸€è‡´å…±äº«qps, grpcçš„å¿ƒè·³æ˜¯æŒ‰è¯·æ±‚é“¾æ¥è®¡ç®—ä¸”ä¸è¿‡æ³¨å†Œä¸­å¿ƒå¤„ç†çº¿ç¨‹ã€‚æ‰€æœ‰è¿™ç±»åè®®ç†è®ºæ”¯æŒçš„å®¹é‡å·®åˆ«å¾ˆå¤§ã€‚

#### æ³¨å†Œä¸­å¿ƒé›†ç¾¤æ³¨å†Œå®¹é‡æ¨ç†

1.  httpåè®®æ³¨å†Œ+å¿ƒè·³qpsæ˜¯1ä¸‡ï¼Œæ¯ä¸ªå®ä¾‹5ç§’é’Ÿä¸€æ¬¡å¿ƒè·³ï¼›ç†è®ºä¸Šåªèƒ½æ”¯æŒ5ä¸‡æœåŠ¡å®ä¾‹å·¦å³ã€‚
2.  grpcåè®®ï¼Œæ³¨å†Œqpså‡è®¾ä¹Ÿæ˜¯1ä¸‡ï¼Œå¿ƒè·³qpså•å®ä¾‹8ä¸‡ï¼Œ3èŠ‚ç‚¹é›†ç¾¤æ€»å¿ƒè·³24ä¸‡ï¼›å¦‚æœå¹³å‡ä¸€ä¸ªåº”ç”¨å®ä¾‹1å°æ—¶é‡è¿ä¸€æ¬¡ï¼›æ”¯æŒæ³¨å†Œçš„æœåŠ¡å®ä¾‹æ€»æ•°ä¸ºï¼š`60*60*10000` = 3600ä¸‡ï¼Œå¿ƒè·³æ”¯æŒçš„é“¾æ¥å®ä¾‹æ€»æ•°ä¸ºï¼š5\*24ä¸‡=120ä¸‡ä¸ªé“¾æ¥å®ä¾‹ï¼ˆå’Œé›†ç¾¤èŠ‚ç‚¹æœ‰å…³ï¼‰ã€‚

ç»“è®º:  
å¦‚æœä½¿ç”¨v1.0x httpåè®®ï¼Œæ”¯æŒçš„å®ä¾‹åœ¨5ä¸‡ä¸ªå·¦å³ã€‚  
å¦‚æœä½¿ç”¨v2.0x grpcåè®®ï¼Œç†è®ºä¸Šèƒ½åˆ°è¾¾åƒä¸‡å®ä¾‹ï¼ŒåŸºæœ¬æ²¡æœ‰ç“¶é¢ˆã€‚

4\. rnacos é›†ç¾¤éƒ¨ç½²
---------------

### 4.1 è·å–rnacosåº”ç”¨åŒ…

æ–¹å¼1ï¼šä» [github release](https://github.com/heqingpan/rnacos/releases) ä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„åº”ç”¨åŒ…ï¼Œè§£å‹åå³å¯è¿è¡Œã€‚

linux æˆ– mac

    # è§£å‹
    tar -xvf rnacos-x86_64-apple-darwin.tar.gz
    # è¿è¡Œ
    ./rnacos -e envfine
    

windows è§£å‹åç›´æ¥è¿è¡Œ rnacos.exe å³å¯ã€‚

æ–¹å¼2: é€šè¿‡docker è¿è¡Œ

    #stableæ˜¯æœ€æ–°æ­£å¼ç‰ˆæœ¬å·ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé•œåƒç‰ˆæœ¬å·ï¼Œå¦‚ï¼š qingpan/rnacos:v0.3.0
    docker pull qingpan/rnacos:stable  
    # åœ¨/path/rnacos/.env é…ç½®æ–‡ä»¶ä¸­é…ç½®å¥½è¿è¡Œå‚æ•°
    docker run --name mynacos -p 8848:8848 -p 9848:9848 -d -v /path/rnacos:/io qingpan/rnacos:stable
    

docker çš„å®¹å™¨è¿è¡Œç›®å½•æ˜¯ /ioï¼Œä¼šä»è¿™ä¸ªç›®å½•è¯»å†™é…ç½®æ–‡ä»¶

æ–¹å¼3ï¼šé€šè¿‡ cargo ç¼–è¯‘å®‰è£…

    # å®‰è£…
    cargo install rnacos
    # è¿è¡Œ
    rnacos -e envfile
    

æ–¹å¼4: ä¸‹è½½æºç ç¼–è¯‘è¿è¡Œ

    git clone https://github.com/heqingpan/rnacos.git
    cd rnacos
    cargo build --release
    cargo run --release -- -e envfile
    

æµ‹è¯•ã€è¯•ç”¨æ¨èä½¿ç”¨ç¬¬1ã€ç¬¬2ç§æ–¹å¼ï¼Œç›´æ¥ä¸‹è½½å°±å¯ä»¥ä½¿ç”¨ã€‚

åœ¨linuxä¸‹ç¬¬1ã€ç¬¬2ç§æ–¹å¼é»˜è®¤æ˜¯muslç‰ˆæœ¬(æ€§èƒ½æ¯”gnuç‰ˆæœ¬å·®ä¸€äº›)ï¼Œåœ¨ç”Ÿäº§æœåŠ¡å¯¹æ€§èƒ½æœ‰è¦æ±‚çš„å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬3ã€ç¬¬4ç§åœ¨å¯¹åº”ç¯å¢ƒç¼–è¯‘gnuç‰ˆæœ¬éƒ¨ç½²ã€‚

### 4.2 è¿è¡Œå‚æ•°è¯´æ˜

åŒä¸€ä¸ªåº”ç”¨åŒ…éœ€è¦æ”¯æŒä¸åŒåœºæ™¯ï¼Œå°±éœ€è¦æ”¯æŒè®¾ç½®è‡ªå®šä¹‰å‚æ•°ã€‚

rnacos è¿è¡Œå‚æ•°æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡ï¼Œæˆ–æŒ‡å®šé…ç½®æ–‡ä»¶æ–¹å¼è®¾ç½®ã€‚ å¦‚æœä¸è®¾ç½®åˆ™æŒ‰é»˜è®¤å‚æ•°è¿è¡Œã€‚

ä¾‹å­

    # ä»0.3.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒ -e env_file è¿è¡Œå‚æ•°
    ./rnacos -e env_file
    

å¦‚æœä¸æŒ‡å®šæ–‡ä»¶æ—¶ä¹Ÿä¼šå°è¯•ä»å½“å‰ç›®å½•ä¸‹.envæ–‡ä»¶åŠ è½½é…ç½®å‚æ•°

env\_fileå†…å®¹çš„æ ¼å¼æ˜¯

    KEY1=VALUE1
    KEY2=VALUE2
    KEY3=VALUE3
    

è¿è¡Œå‚æ•°ï¼š

å‚æ•°KEY

å†…å®¹æè¿°

é»˜è®¤å€¼

ç¤ºä¾‹

å¼€å§‹æ”¯æŒçš„ç‰ˆæœ¬

RNACOS\_HTTP\_PORT

rnacosç›‘å¬httpç«¯å£

8848

8848

0.1.x

RNACOS\_GRPC\_PORT

rnacosç›‘å¬grpcç«¯å£

é»˜è®¤æ˜¯ HTTPç«¯å£+1000

9848

0.1.x

RNACOS\_HTTP\_WORKERS

httpå·¥ä½œçº¿ç¨‹æ•°

cpuæ ¸æ•°

8

0.1.x

RNACOS\_CONFIG\_DB\_FILE

é…ç½®ä¸­å¿ƒçš„æœ¬åœ°æ•°æ®åº“æ–‡ä»¶åœ°å€ã€0.2.xåä¸åœ¨ä½¿ç”¨ã€‘

config.db

config.db

0.1.x

RNACOS\_CONFIG\_DB\_DIR

é…ç½®ä¸­å¿ƒçš„æœ¬åœ°æ•°æ®åº“sledæ–‡ä»¶å¤¹, ä¼šåœ¨ç³»ç»Ÿè¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»º

nacos\_db

nacos\_db

0.2.x

RNACOS\_RAFT\_NODE\_ID

èŠ‚ç‚¹id

1

1

0.3.0

RNACOS\_RAFT\_NODE\_ADDR

èŠ‚ç‚¹åœ°å€Ip:GrpcPort,å•èŠ‚ç‚¹è¿è¡Œæ—¶æ¯æ¬¡å¯åŠ¨éƒ½ä¼šç”Ÿæ•ˆï¼›å¤šèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œåªå–åŠ å…¥é›†ç¾¤æ—¶é…ç½®çš„å€¼

127.0.0.1:GrpcPort

127.0.0.1:9848

0.3.0

RNACOS\_RAFT\_AUTO\_INIT

æ˜¯å¦å½“åšä¸»èŠ‚ç‚¹åˆå§‹åŒ–,(åªåœ¨æ¯ä¸€æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆ)

èŠ‚ç‚¹1æ—¶é»˜è®¤ä¸ºtrue,èŠ‚ç‚¹é1æ—¶ä¸ºfalse

true

0.3.0

RNACOS\_RAFT\_JOIN\_ADDR

æ˜¯å¦å½“åšèŠ‚ç‚¹åŠ å…¥å¯¹åº”çš„ä¸»èŠ‚ç‚¹,LeaderIp:GrpcPortï¼›åªåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆ

ç©º

127.0.0.1:9848

0.3.0

RUST\_LOG

æ—¥å¿—ç­‰çº§:debug,info,warn,error;æ‰€æœ‰http,grpcè¯·æ±‚éƒ½ä¼šæ‰“infoæ—¥å¿—,å¦‚æœä¸è§‚æ³¨å¯ä»¥è®¾ç½®ä¸ºerrorå‡å°‘æ—¥å¿—é‡

info

error

0.3.0

æ³¨ï¼šä»v0.3.0å¼€å§‹ï¼Œé»˜è®¤å‚æ•°å¯åŠ¨çš„èŠ‚ç‚¹ä¼šè¢«å½“åšåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“å‰èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹çš„é›†ç¾¤éƒ¨ç½²ã€‚æ”¯æŒå…¶å®ƒæ–°å¢çš„ä»èŠ‚ç‚¹åŠ å…¥ã€‚

é…ç½®é›†ç¾¤è§„åˆ™

1.  æ‰€æœ‰çš„é›†ç¾¤èŠ‚ç‚¹éƒ½éœ€è¦è®¾ç½®RNACOS\_RAFT\_NODE\_ID,RNACOS\_RAFT\_NODE\_ADDR ,å…¶ä¸­ä¸åŒèŠ‚ç‚¹çš„node\_idå’Œ node\_addrä¸èƒ½ç›¸åŒï¼›node\_idä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œnode\_addrä¸º`ip:grpc_port`
2.  é›†ç¾¤ä¸»èŠ‚ç‚¹ï¼š åˆå§‹è®¾ç½®RNACOS\_RAFT\_AUTO\_INITä¸ºtrue ï¼ˆå¦‚æœèŠ‚ç‚¹ä¸º1ï¼Œé»˜è®¤æ˜¯ true,ä¸ç”¨é¢å¤–è®¾ç½®ï¼‰ã€‚
3.  é›†ç¾¤ä»èŠ‚ç‚¹ï¼š åˆå§‹è®¾ç½®RNACOS\_RAFT\_AUTO\_INITä¸ºfalse (èŠ‚ç‚¹é1,é»˜è®¤å°±æ˜¯false,ä¸ç”¨é¢å¤–è®¾ç½®)ï¼›å¦å¤–éœ€è¦è®¾ç½®RNACOS\_RAFT\_JOIN\_ADDRä¸ºå½“å‰ä¸»èŠ‚ç‚¹çš„åœ°å€ï¼Œä»¥æ–¹ä¾¿å¯åŠ¨æ—¶è‡ªåŠ¨åŠ å…¥é›†ç¾¤ä¸­ã€‚
4.  ç¬¬2ã€3ç‚¹åªæ˜¯ä¸ºäº†åˆå§‹åŒ–ç»„å»ºé›†ç¾¤ã€‚é›†ç¾¤è¿è¡Œèµ·æ¥ä¹‹åï¼Œåç»§å¯åŠ¨é…ç½®ä»raft dbä¸­åŠ è½½ã€‚
5.  é›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸è¦æ±‚ï¼Œå¯ä»¥æ˜¯1ã€2ã€3ã€4ã€... ï¼› ä¸è¿‡raftåè®®åªæ”¯æŒå°äºé›†ç¾¤åŠæ•°èŠ‚ç‚¹å¼‚å¸¸åç»§ç»­æä¾›å†™å…¥æœåŠ¡(æŸ¥è¯¢ä¸å½±å“)ã€‚ä¾‹å¦‚ï¼š3ä¸ªèŠ‚ç‚¹é›†ç¾¤æ”¯æŒ1ä¸ªèŠ‚ç‚¹å¼‚å¸¸åæä¾›å†™å…¥æœåŠ¡ï¼Œ2ä¸ªèŠ‚ç‚¹é›†ç¾¤å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸æ”¯æŒèŠ‚ç‚¹å¼‚å¸¸åæä¾›æœåŠ¡ã€‚
6.  ä»èŠ‚ç‚¹å¯ä»¥åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æŒ‰éœ€åŠ å…¥ã€‚æ¯”å¦‚åŸæ¥3ä¸ªèŠ‚ç‚¹ï¼Œå¯èƒ½åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åå¢åŠ 2ä¸ªèŠ‚ç‚¹æ‰©å®¹ã€‚

### 4.3 é›†ç¾¤å®ä¾‹

æŒ‰ä¸Šé¢çš„é…ç½®è§„åˆ™ï¼Œä¸‹é¢æˆ‘ä»¬é…ç½®ä¸€ä¸ª3èŠ‚ç‚¹é›†ç¾¤ä¾‹å­ã€‚

åˆå§‹åŒ–èŠ‚ä¿¡æ¯

1.  ä¸»èŠ‚ç‚¹idä¸º1ï¼Œåœ°å€ä¸º127.0.0.1:9848
2.  ç¬¬ä¸€ä¸ªä»èŠ‚ç‚¹idä¸º2ï¼Œåœ°å€ä¸º127.0.0.1:9849
3.  ç¬¬äºŒä¸ªä»èŠ‚ç‚¹idä¸º3ï¼Œåœ°å€ä¸º127.0.0.1:9849

æ­£å¼é›†ç¾¤éƒ¨ç½²çš„logç­‰çº§å»ºè®®è®¾ç½®ä¸º`warn`,ä¸æ‰“æ­£å¸¸çš„è¯·æ±‚æ—¥å¿—ï¼Œåªæ‰“æŠ¥è­¦æˆ–å¼‚å¸¸æ—¥å¿—ï¼Œå‡å°‘æ—¥å¿—é‡ã€‚

**é…ç½®ä¿¡æ¯å¦‚ä¸‹**

env01

    #file:env01 , Initialize with the leader node role
    RUST_LOG=warn
    RNACOS_HTTP_PORT=8848
    RNACOS_RAFT_NODE_ADDR=127.0.0.1:9848
    RNACOS_CONFIG_DB_DIR=db01
    RNACOS_RAFT_NODE_ID=1
    RNACOS_RAFT_AUTO_INIT=true
    

env02:

    #file:env02 , Initialize with the follower node role
    RUST_LOG=warn
    RNACOS_HTTP_PORT=8849
    RNACOS_RAFT_NODE_ADDR=127.0.0.1:9849
    RNACOS_CONFIG_DB_DIR=db02
    RNACOS_RAFT_NODE_ID=2
    RNACOS_RAFT_JOIN_ADDR=127.0.0.1:9848
    

env03:

    #file:env03 , Initialize with the follower node role
    RUST_LOG=warn
    RNACOS_HTTP_PORT=8850
    RNACOS_RAFT_NODE_ADDR=127.0.0.1:9850
    RNACOS_CONFIG_DB_DIR=db03
    RNACOS_RAFT_NODE_ID=3
    RNACOS_RAFT_JOIN_ADDR=127.0.0.1:9848
    

**æ³¨ï¼š** ä¸Šé¢çš„åœ°å€æ˜¯æœ¬æœºè¿è¡Œå¤šå®ä¾‹çš„åœ°å€ï¼Œå®é™…ä½¿ç”¨æ—¶æ¢æˆå…·ä½“çš„æœåŠ¡ipå’Œportå³å¯ã€‚

åˆ†åˆ«è¿è¡Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦å…ˆè¿è¡Œä¸»èŠ‚ç‚¹æˆåŠŸåå†è¿è¡Œ

å…ˆè¿è¡Œä¸»èŠ‚ç‚¹

    nohup ./rnacos -e env01 > n01.log &
    

ä¸»èŠ‚ç‚¹åŠŸèƒ½å¯åŠ¨åï¼Œå†è¿è¡Œä»èŠ‚ç‚¹

    nohup ./rnacos -e env02 > n02.log &
    nohup ./rnacos -e env03 > n03.log &
    

å®ä¾‹è¿‡ç¨‹ä¸­ä¸åŒçš„èŠ‚ç‚¹éœ€è¦åœ¨ä¸åŒçš„æœåŠ¡å™¨è¿è¡ŒæœåŠ¡ã€‚

### 4.4 è¿è¡Œåº”ç”¨ä½¿ç”¨é›†ç¾¤

é›†ç¾¤æœåŠ¡å¯åŠ¨åï¼Œå³å¯è¿è¡ŒåŸæœ‰çš„ nacos åº”ç”¨ã€‚

#### é…ç½®ä¸­å¿ƒhttp apiä¾‹å­

    echo "\npublish config t001:contentTest to node 1"
    curl -X POST 'http://127.0.0.1:8848/nacos/v1/cs/configs' -d 'dataId=t001&group=foo&content=contentTest'
    sleep 1
    
    echo "\nget config info t001 from node 1, value:"
    curl 'http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=t001&group=foo'
    
    echo "\nget config info t001 from node 2, value:"
    curl 'http://127.0.0.1:8849/nacos/v1/cs/configs?dataId=t001&group=foo'
    
    echo "\nget config info t001 from node 3, value:"
    curl 'http://127.0.0.1:8850/nacos/v1/cs/configs?dataId=t001&group=foo'
    sleep 1
    
    echo "\npublish config t002:contentTest02 to node 2"
    curl -X POST 'http://127.0.0.1:8849/nacos/v1/cs/configs' -d 'dataId=t002&group=foo&content=contentTest02'
    sleep 1
    
    echo "\nget config info t002 from node 1, value:"
    curl 'http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=t002&group=foo'
    
    echo "\nget config info t002 from node 2, value:"
    curl 'http://127.0.0.1:8849/nacos/v1/cs/configs?dataId=t002&group=foo'
    
    echo "\nget config info t002 from node 3, value:"
    curl 'http://127.0.0.1:8850/nacos/v1/cs/configs?dataId=t002&group=foo'
    
    

#### æ³¨å†Œä¸­å¿ƒhttp apiä¾‹å­

    echo "\nregister instance nacos.test.001 to node 1"
    curl -X POST 'http://127.0.0.1:8848/nacos/v1/ns/instance' -d 'port=8000&healthy=true&ip=192.168.1.11&weight=1.0&serviceName=nacos.test.001&groupName=foo&metadata={"app":"foo","id":"001"}'
    echo "\nregister instance nacos.test.001 to node 2"
    curl -X POST 'http://127.0.0.1:8849/nacos/v1/ns/instance' -d 'port=8000&healthy=true&ip=192.168.1.12&weight=1.0&serviceName=nacos.test.001&groupName=foo&metadata={"app":"foo","id":"002"}'
    echo "\nregister instance nacos.test.001 to node 3"
    curl -X POST 'http://127.0.0.1:8850/nacos/v1/ns/instance' -d 'port=8000&healthy=true&ip=192.168.1.13&weight=1.0&serviceName=nacos.test.001&groupName=foo&metadata={"app":"foo","id":"003"}'
    sleep 1
    echo "\n\nquery service instance nacos.test.001 from node 1, value:"
    curl "http://127.0.0.1:8848/nacos/v1/ns/instance/list?&namespaceId=public&serviceName=foo%40%40nacos.test.001&groupName=foo&clusters=&healthyOnly=true"
    echo "\n\nquery service instance nacos.test.001 from node 2, value:"
    curl "http://127.0.0.1:8849/nacos/v1/ns/instance/list?&namespaceId=public&serviceName=foo%40%40nacos.test.001&groupName=foo&clusters=&healthyOnly=true"
    echo "\n\nquery service instance nacos.test.001 from node 3, value:"
    curl "http://127.0.0.1:8850/nacos/v1/ns/instance/list?&namespaceId=public&serviceName=foo%40%40nacos.test.001&groupName=foo&clusters=&healthyOnly=true"
    echo "\n"
    
    

è¯¦ç»†ä½¿ç”¨è¯´æ˜å‚è€ƒ[rnacos book](https://heqingpan.github.io/rnacos/)

5\. æ¬¢è¿è¯•ç”¨ä¸å…±å»º
-----------

rnacoså•æœºç‰ˆæœ¬å‘å¸ƒå·²æœ‰4ä¸ªæœˆï¼ŒæœŸé—´æœ‰æ”¶åˆ°ä¸€äº›ä½¿ç”¨é—®é¢˜çš„åé¦ˆï¼Œç›®å‰ä¸»ä½“åŠŸèƒ½å·²ç»ç®—æ¯”è¾ƒç¨³å®šï¼Œæœ‰ä½¿ç”¨nacosçš„åŒå­¦æ¬¢è¿è¯•ç”¨ã€‚

é¡¹ç›®å·²å¼€æºåˆ° [github](https://github.com/heqingpan/rnacos) [gitee](https://gitee.com/hqp/rnacos)ã€‚

ä½¿ç”¨è¿‡ç¨‹ä¸­å’Œä»€ä¹ˆé—®é¢˜æˆ–å»ºè®®å¯ä»¥åˆ°githubæissuesåé¦ˆã€‚

å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©å°±ç»™ä¸ªstaré¼“åŠ±é¼“åŠ± ğŸ˜ƒ

å¯¹rnacoså¼€å‘æ„Ÿå…´è¶£çš„åŒå­¦ä¹Ÿæ¬¢è¿åˆ°githubærpå…±å»ºã€‚ rnacoså‘å¸ƒåå·²æœ‰ä¸€ä½åŒå­¦å‚äºå…±å»ºï¼Œéå¸¸æ„Ÿè°¢ä¸€èµ·å…±å»ºçš„åŒå­¦ã€‚