---
layout: post
title: "【Linux】(小白向)详解VirtualBox网络配置-配置Linux网络"
date: "2023-05-19T01:08:13.604Z"
---
【Linux】(小白向)详解VirtualBox网络配置-配置Linux网络
======================================

> 本文时间 2023-05-18  
> 作者：sugerqube漆瓷

本文面向新手，重在理解会舍弃不少精密的理论，还请大佬们见谅。  
**本文目标**：成功使用ssh工具登录linux，同时linux能连接外网。

网络基础
====

关于局域网
-----

一切网络的目的：**为了链接两台计算机**

### 知识点1：每台物理机应该有一个ip地址

windows用户可以在`win`+`R`输入`cmd`打开命令行使用ipconfig查看自己的ip  
IPv4 就是我这台电脑的ip地址192.168.1.117。  
注：192.XXX一般是**局域网**  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518174142507-544413029.png)

* * *

### 知识点2：存在物理链接的两台电脑可以互相访问

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518175050926-45355881.png)  
  
一般用在cmd窗口用`ping`检查连通性。  
  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518175238651-1372572128.png)  
  
用`ctrl`+`c`结束`ping`  
注：以上即以下情况介默认防火墙开放

**知识点2.1：防火墙可以添加规则限制上述的访问。**  
**知识点2.2：路由器一般兼具交换机的功能。**

* * *

### 知识点3：在到达最后一个“设备”前经过的节点，可以被等效忽略

知识点3.1:网关地址为直接连接的ip地址

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518210318764-1307701794.png)

举例一个常见网络架构

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518211812975-990903503.png)

以我的**A**为例，电脑的网线连接着路由器  
路由器**ip**为192.168.1.1  
所以**网关**地址为：192.168.1.1  
  
同时作为**同局域网**下的**B**可以直接被我访问。  
  
现在我想要访问sugerqube.org服务器的服务  
我的网络经过了路由器的网关  
路由器再经过112.X的（光纤）/（交换机），然后就可以等效为下图。

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518211903756-30979447.png)

显然我可以访问通局域网下的sugerqube。

再次强调，上述只是一种理解方式，真实的环境还要涉及防火墙和协议

简述VBox的网络（桥接模式）
===============

有上述基础 一个拓扑图就可以理解桥接模式是什么：  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518233648188-1529847885.png)  
这种模式胜在方便，但是有个缺点，他的ip是由真实路由器分配的，不方便我们ssh链接。  
当然可以像下文那样改配置文件固定ip，不过存在隐藏问题。  
如果是笔记本接校园网，你的网关将是变动的，不能定死  
笔者更喜欢下文的host-only模式不继续深入讨论桥接模式。

配置VBox的网络（HostOnly）
===================

VBox的配置
-------

有了上述基础，我们就可以很好的理解与配置VBox的网络了。

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518213318401-1110894113.png)

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518213414215-1276203238.png)  
  
  
**IPv4的地址**就相当于上述路由器的地址,是等一下我们linux里要配的网关地址。  
**DHCP服务器**，相当于平时路由器给我们分配ip地址，192.168.1.X的由来。

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518214357972-1877466329.png)

  
可以看到我们挂在在这个“路由器”下的虚拟机的ip地址范围应该在（101-254）  
服务器占用`100`地址，相当于上面的sugerqube提供服务的机子。

把虚拟机连上“VBox路由器”  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518214930739-2123556940.png)

启动配置Linux网络。

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518215716901-1116203803.png)

  
开机后使用`ip addr`查看ip，发现之前的`100`已经为我们分配了ip：192.168.137.120  
但是此时的故名思议是host-only，我们的实机没有什么关系。  
这里展示一个拓扑图：  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518221204707-79302218.png)  
所以很明显，现在我们的linux是不联网的。  
想要联网，需要把VBox插到我们真机的路由器上，当然不是真的插网线 ：）

真机的配置
-----

从控制面板-》网络和Internet-》网络链接，蓝色的理解为“VBox路由器”，红色的理解为真机“路由器”  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518221807966-918519899.png)  
右键以太网![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518221951958-1061206932.png)属性  
  
  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518222041837-1126551226.png)  
将他共享给VBox。

！！！！！！！！！  
在电脑重启后共享极有可能失效，需要重新共享（VBox的bug）。  
！！！！！！！！！

新的拓扑结构：  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518223719088-419792225.png)  
这时候就可以用我们的真机访问虚拟机了。

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518223832945-1216752665.png)  
  
  
但是此时Linux还不能访问互联网，因为现在的Linux的网络配置是按照之前的拓扑图生成的。  
这里我们手动改一下，顺便固定一下ip。

Centos配置
--------

因为真机可以ping通linux所以我们可以上我的ssh工具。  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518225234310-1799911824.png)  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518225245694-1935896436.png)  
  
  
注：bash窗口在手动关闭，物理通道断开，之前都可以保持链接，所以我们可以把ip改成其他，只是下次需要用新的ip连接。

配置文件地址`/etc/sysconfig/network-scripts/ifcfg-enp0s3`

  
因为是==只读文件==所以需要==权限==，在命令前加上sudo，或者切换为root用户。

使用命令  
`cd /etc/sysconfig/network-scripts/`：移动到文件夹  
`sudo vi ifcfg-enp0s3`：编辑文件  
![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518232609655-25308204.png)

可以看到 BOOTPROTO 是 ‘dhcp’就是我们上面看到的`100`服务器，是由他分配的意思，我们改成`static`（静态）  
然后我们再在文末添加我们需要的配置

    IPADDR=192.168.137.120
    GATEWAY=192.168.137.1
    NETMASK=255.255.255.0
    DNS1=114.114.114.114
    DNS2=8.8.8.8
    

解析：  
**gateway**是网关，就是我们上面拓扑图看到的插的路由器，就是VBox的192.168.137.1  
**netmask**是网络掩码，dns1和dns2，一般都是上述值，推荐自行深入了解。

注：vi编辑器，按`i`开始编辑，按`：`输入`wq`保存退出

重置一下网卡

    service network restart
    

![image](https://img2023.cnblogs.com/blog/2924373/202305/2924373-20230518232959178-326390915.png)

可以看到现在已经可以顺利访问互联网了。

关于Nat转换网络
=========

涉及比较多的深入计算机网络知识，  
且主机无法访问虚拟机，不符合本文目标，有机会单开详解。