---
layout: post
title: "åŸºäºŽ NNCF å’Œ  Optimum é¢å‘ Intel CPU å¯¹ Stable Diffusion ä¼˜åŒ–"
date: "2023-07-13T01:26:04.371Z"
---
åŸºäºŽ NNCF å’Œ ðŸ¤— Optimum é¢å‘ Intel CPU å¯¹ Stable Diffusion ä¼˜åŒ–
=======================================================

åŸºäºŽéšç©ºé—´çš„æ‰©æ•£æ¨¡åž‹ (Latent Diffusion Model)ï¼Œæ˜¯è§£å†³æ–‡æœ¬åˆ°å›¾ç‰‡ç”Ÿæˆé—®é¢˜ä¸Šçš„é¢ è¦†è€…ã€‚Stable Diffusion æ˜¯æœ€è‘—åçš„ä¸€ä¾‹ï¼Œå¹¿æ³›åº”ç”¨åœ¨å•†ä¸šå’Œå·¥ä¸šã€‚Stable Diffusion çš„æƒ³æ³•ç®€å•ä¸”æœ‰æ•ˆ: ä»Žå™ªå£°å‘é‡å¼€å§‹ï¼Œå¤šæ¬¡åŽ»å™ªï¼Œä»¥ä½¿ä¹‹åœ¨éšç©ºé—´é‡Œé€¼è¿‘å›¾ç‰‡çš„è¡¨ç¤ºã€‚

ä½†æ˜¯ï¼Œè¿™æ ·çš„æ–¹æ³•ä¸å¯é¿å…åœ°å¢žåŠ äº†æŽ¨ç†æ—¶é•¿ï¼Œä½¿å®¢æˆ·ç«¯çš„ä½“éªŒå¤§æ‰“æŠ˜æ‰£ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªå¥½çš„ GPU æ€»èƒ½æœ‰å¸®åŠ©ï¼Œç¡®å®žå¦‚æ­¤ï¼Œä½†å…¶æŸè€—å¤§å¤§å¢žåŠ äº†ã€‚å°±æŽ¨ç†è€Œè¨€ï¼Œåœ¨ 2023 å¹´ä¸ŠåŠå¹´ (H1â€™23)ï¼Œä¸€ä¸ªå¥½ CPU å®žä¾‹ ([r6i.2xlarge](https://aws.amazon.com/ec2/instance-types/r6g/)ï¼Œ8 vCPUs ï¼Œ64 GB å†…å­˜) ä»·æ ¼æ˜¯ 0.504 $/hï¼ŒåŒæ—¶ï¼Œç±»ä¼¼åœ°ï¼Œä¸€ä¸ªå¥½ GPU å®žä¾‹ ([g4dn.2xlarge](https://aws.amazon.com/ec2/instance-types/g4/)ï¼ŒNVIDIA T4ï¼Œ16 GB å†…å­˜) ä»·æ ¼æ˜¯ 0.75 $/h ï¼Œæ˜¯å‰è€…çš„è¿‘ 1.5 å€ã€‚

è¿™å°±ä½¿å›¾åƒç”Ÿæˆçš„æœåŠ¡å˜å¾—æ˜‚è´µï¼Œæ— è®ºæŒæœ‰è€…è¿˜æ˜¯ç”¨æˆ·ã€‚è¯¥é—®é¢˜åœ¨é¢å‘ç”¨æˆ·ç«¯éƒ¨ç½²å°±æ›´çªå‡ºäº†: å¯èƒ½æ²¡æœ‰ GPU èƒ½ç”¨ï¼è¿™è®© Stable Diffusion çš„éƒ¨ç½²å˜æˆäº†æ£˜æ‰‹çš„é—®é¢˜ã€‚

åœ¨è¿‡åŽ»äº”å¹´ä¸­ï¼Œ[OpenVINO](https://docs.openvino.ai/) é›†æˆäº†è®¸å¤šé«˜æ€§èƒ½æŽ¨ç†çš„ç‰¹æ€§ã€‚ å…¶ä¸€å¼€å§‹ä¸ºè®¡ç®—æœºè§†è§‰æ¨¡åž‹è®¾è®¡ï¼ŒçŽ°ä»Šä»åœ¨è®¸å¤šæ¨¡åž‹çš„æŽ¨ç†æ€§èƒ½ä¸Šå–å¾—æœ€ä½³è¡¨çŽ°ï¼ŒåŒ…æ‹¬ [Stable Diffusion](https://huggingface.co/blog/zh/stable-diffusion-inference-intel)ã€‚ç„¶è€Œï¼Œå¯¹èµ„æºæœ‰é™åž‹çš„åº”ç”¨ï¼Œä¼˜åŒ– Stable Diffusion è¿œä¸æ­¢è¿è¡Œæ—¶çš„ã€‚è¿™ä¹Ÿæ˜¯ OpenVINO [NNCF](https://github.com/openvinotoolkit/nncf)(Neural Network Compression Framework) å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚

åœ¨æœ¬åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†ç†æ¸…ä¼˜åŒ– Stable Diffusion æ¨¡åž‹çš„é—®é¢˜ï¼Œå¹¶æå‡ºå¯¹èµ„æºæœ‰é™çš„ç¡¬ä»¶ (æ¯”å¦‚ CPU) å‡è´Ÿçš„æµç¨‹ã€‚å°¤å…¶æ˜¯å’Œ PyTorch ç›¸æ¯”ï¼Œæˆ‘ä»¬é€Ÿåº¦æé«˜äº† 5.1 å€ï¼Œå†…å­˜å‡å°‘äº† 4 å€ã€‚

Stable Diffusion çš„ä¼˜åŒ–
--------------------

åœ¨ Stable Diffusion çš„ [ç®¡çº¿](https://huggingface.co/docs/diffusers/api/pipelines/stable_diffusion/overview) ä¸­ï¼ŒUNet çš„è¿è¡Œæ˜¯æœ€è®¡ç®—æ˜‚è´µçš„ã€‚å› æ­¤ï¼Œå¯¹æ¨¡åž‹çš„æŽ¨ç†é€Ÿåº¦ï¼Œé’ˆå¯¹ UNet çš„ä¼˜åŒ–èƒ½å¸¦æ¥è¶³å¤Ÿçš„æ•ˆç›Šã€‚

ç„¶è€Œäº‹å®žè¡¨æ˜Žï¼Œä¼ ç»Ÿçš„æ¨¡åž‹ä¼˜åŒ–æ–¹æ³•å¦‚ 8-bit çš„åŽè®­ç»ƒé‡åŒ–ï¼Œå¯¹æ­¤ä¸å¥æ•ˆã€‚ä¸»è¦åŽŸå› æœ‰ä¸¤ç‚¹: å…¶ä¸€ï¼Œé¢å‘åƒç´ é¢„æµ‹çš„æ¨¡åž‹ï¼Œæ¯”å¦‚è¯­ä¹‰åˆ†å‰²ã€è¶…åˆ†è¾¨çŽ‡ç­‰ï¼Œæ˜¯æ¨¡åž‹ä¼˜åŒ–ä¸Šæœ€å¤æ‚çš„ï¼Œå› ä¸ºä»»åŠ¡å¤æ‚ï¼Œå‚æ•°å’Œç»“æž„çš„æ”¹å˜ä¼šå¯¼è‡´æ— æ•°ç§å˜æ•°; å…¶äºŒï¼Œæ¨¡åž‹çš„å‚æ•°ä¸æ˜¯å¾ˆå†—ä½™ï¼Œå› ä¸ºå…¶åŽ‹ç¼©äº†å…¶æ•°ä»¥åƒä¸‡è®¡çš„ [æ•°æ®é›†](https://laion.ai/blog/laion-5b/) ä¸­çš„ä¿¡æ¯ã€‚è¿™ä¹Ÿæ˜¯ç ”ç©¶è€…ä¸å¾—ä¸ç”¨æ›´å¤æ‚çš„é‡åŒ–æ–¹æ³•æ¥ä¿è¯æ¨¡åž‹ä¼˜åŒ–åŽçš„ç²¾åº¦ã€‚ä¸¾ä¾‹è€Œè¨€ï¼Œé«˜é€š (Qualcomm) ç”¨åˆ†å±‚çŸ¥è¯†è’¸é¦ (layer-wise Knowledge Distillation) æ–¹æ³• ([AdaRound](https://arxiv.org/abs/2004.10568)) æ¥ [é‡åŒ–](https://www.qualcomm.com/news/onq/2023/02/worlds-first-on-device-demonstration-of-stable-diffusion-on-android) Stable Diffusionã€‚è¿™æ„å‘³ç€ï¼Œæ— è®ºå¦‚ä½•ï¼Œæ¨¡åž‹é‡åŒ–åŽçš„å¾®è°ƒæ˜¯å¿…è¦çš„ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä½•ä¸ç”¨ é‡åŒ–æ„ŸçŸ¥çš„è®­ç»ƒ ([Quantization-Aware Trainning, QAT](https://arxiv.org/abs/1712.05877))ï¼Œå…¶å¯¹åŽŸæ¨¡åž‹çš„å¾®è°ƒå’Œå‚æ•°é‡åŒ–æ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Ÿå› æ­¤ï¼Œæˆ‘ä»¬åœ¨æœ¬å·¥ä½œä¸­ï¼Œç”¨ token åˆå¹¶ ([Token Merging](https://arxiv.org/abs/2210.09461)) æ–¹æ³•ç»“åˆ [NNCF](https://github.com/openvinotoolkit/nncf), [OpenVINO](https://www.intel.com/content/www/us/en/developer/tools/openvino-toolkit/overview.html) å’Œ [Diffusers](https://github.com/huggingface/diffusers) å®žè·µäº†è¯¥æƒ³æ³•ã€‚

ä¼˜åŒ–æµç¨‹
----

æˆ‘ä»¬é€šå¸¸ä»Žè®­ç»ƒåŽçš„æ¨¡åž‹å¼€å§‹ä¼˜åŒ–ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬ä»Žå®å¯æ¢¦æ•°æ®é›† ([Pokemons dataset](https://huggingface.co/datasets/lambdalabs/pokemon-blip-captions)ï¼ŒåŒ…å«å›¾ç‰‡å’Œå¯¹åº”çš„æ–‡æœ¬æè¿°) ä¸Šå¾®è°ƒçš„ [æ¨¡åž‹](https://huggingface.co/svjack/Stable-Diffusion-Pokemon-en)ã€‚

æˆ‘ä»¬å¯¹ Stable Diffusion ç”¨ Diffusers ä¸­çš„ [å›¾ç‰‡ - æ–‡æœ¬å¾®è°ƒä¹‹ä¾‹](https://huggingface.co/docs/diffusers/training/text2image)ï¼Œç»“åˆ NNCF ä¸­çš„ QAT (å‚è§è®­ç»ƒçš„ [è„šæœ¬](https://github.com/huggingface/optimum-intel/tree/main/examples/openvino/stable-diffusion))ã€‚æˆ‘ä»¬åŒæ—¶æ”¹å˜äº†æŸå¤±å‡½æ•°ï¼Œä»¥åŒæ—¶å®žçŽ°ä»Žæºæ¨¡åž‹åˆ°éƒ¨ç½²æ¨¡åž‹çš„çŸ¥è¯†è’¸é¦ã€‚è¯¥æ–¹æ³•ä¸Žé€šå¸¸çš„çŸ¥è¯†è’¸é¦ä¸åŒï¼ŒåŽè€…æ˜¯æŠŠæºæ¨¡åž‹è’¸é¦åˆ°å°äº›çš„æ¨¡åž‹ã€‚æˆ‘ä»¬çš„æ–¹æ³•ä¸»è¦å°†çŸ¥è¯†æ•´ç†ä½œä¸ºé™„åŠ çš„æ–¹æ³•ï¼Œå¸®åŠ©æé«˜æœ€åŽä¼˜åŒ–çš„æ¨¡åž‹çš„ç²¾åº¦ã€‚æˆ‘ä»¬ä¹Ÿç”¨æŒ‡æ•°ç§»åŠ¨å¹³å‡æ–¹æ³• (Exponential Moving Average, EMA) è®©æˆ‘ä»¬è®­ç»ƒè¿‡ç¨‹æ›´ç¨³å®šã€‚æˆ‘ä»¬ä»…å¯¹æ¨¡åž‹åš 4096 æ¬¡è¿­ä»£ã€‚

åŸºäºŽä¸€äº›æŠ€å·§ï¼Œæ¯”å¦‚æ¢¯åº¦æ£€æŸ¥ (gradient checkpointing) å’Œ [ä¿æŒ EMA æ¨¡åž‹](https://github.com/huggingface/optimum-intel/blob/bbbe7ff0e81938802dbc1d234c3dcdf58ef56984/examples/openvino/stable-diffusion/train_text_to_image_qat.py#L941) åœ¨å†…å­˜ (RAM) è€Œä¸æ˜¯è™šæ‹Ÿå†…å­˜ (VRAM) ä¸­ã€‚æ•´ä¸ªä¼˜åŒ–è¿‡ç¨‹èƒ½ç”¨ä¸€å¼  GPU åœ¨ä¸€å¤©å†…å®Œæˆã€‚

é‡åŒ–æ„ŸçŸ¥çš„è®­ç»ƒä¹‹å¤–å‘¢ ?
------------

é‡åŒ–æ¨¡åž‹æœ¬èº«å°±èƒ½å¸¦æ¥æ¨¡åž‹æ¶ˆè€—ã€åŠ è½½ã€å†…å­˜ã€æŽ¨ç†é€Ÿåº¦ä¸Šçš„æ˜¾è‘—æé«˜ã€‚ä½†é‡åŒ–æ¨¡åž‹è›®å¤§çš„ä¼˜åŠ¿åœ¨èƒ½å’Œå…¶ä»–æ¨¡åž‹ä¼˜åŒ–æ–¹æ³•ä¸€èµ·ï¼Œè¾¾åˆ°åŠ é€Ÿçš„å¢žç›Šæ•ˆæžœã€‚

æœ€è¿‘ï¼ŒFacebook Research é’ˆå¯¹è§†è§‰ Transformer æ¨¡åž‹ï¼Œæå‡ºäº†ä¸€ä¸ª [Token Merging](https://arxiv.org/abs/2210.09461) æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„æœ¬è´¨æ˜¯ç”¨çŽ°æœ‰çš„æ–¹æ³• (å–å¹³å‡ã€å–æœ€å¤§å€¼ç­‰) æŠŠå†—ä½™çš„ token å’Œé‡è¦çš„ token èžåˆã€‚è¿™åœ¨ self-attention å—ä¹‹å‰å®Œæˆï¼ŒåŽè€…æ˜¯ Transformer æ¨¡åž‹æœ€æ¶ˆè€—ç®—åŠ›çš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå‡å° token çš„è·¨åº¦èƒ½å‡å°‘ self-attention å—æ¶ˆè€—çš„æ—¶é—´ã€‚è¯¥æ–¹æ³•ä¹Ÿå·²è¢« Stable Diffusion æ¨¡åž‹ [é‡‡ç”¨](https://arxiv.org/pdf/2303.17604.pdf)ï¼Œå¹¶åœ¨é¢å‘ GPU çš„é«˜åˆ†è¾¨çŽ‡ä¼˜åŒ–ä¸Šæœ‰å¯è§‚çš„è¡¨çŽ°ã€‚

æˆ‘ä»¬æ”¹è¿›äº† Token Merging æ–¹æ³•ï¼Œä»¥ä¾¿ç”¨ OpenVINOï¼Œå¹¶åœ¨æ³¨æ„åŠ› UNet æ¨¡åž‹ä¸Šé‡‡ç”¨ 8-bit é‡åŒ–ã€‚è¿™åŒ…å«äº†ä¸Šè¿°å«çŸ¥è¯†è’¸é¦ç­‰çš„æ‰€æœ‰æŠ€æœ¯ã€‚å¯¹é‡åŒ–è€Œè¨€ï¼Œå…¶éœ€è¦å¾®è°ƒï¼Œä»¥ä¿è¯æ•°å€¼ç²¾åº¦ã€‚æˆ‘ä»¬ä¹Ÿä»Ž [å®å¯æ¢¦æ•°æ®é›†](https://huggingface.co/datasets/lambdalabs/pokemon-blip-captions) ä¸Šè®­ç»ƒçš„ [æ¨¡åž‹](https://huggingface.co/svjack/Stable-Diffusion-Pokemon-en) å¼€å§‹ä¼˜åŒ–å’Œå¾®è°ƒã€‚ä¸‹å›¾ä½“çŽ°äº†æ€»ä½“çš„ä¼˜åŒ–å·¥ä½œæµç¨‹ã€‚

![](https://man-archives.oss-cn-hangzhou.aliyuncs.com/goofan/202307121519322.png)

ç»“æžœçš„æ¨¡åž‹åœ¨æœ‰é™èµ„æºçš„ç¡¬ä»¶ä¸Šæ˜¯é«˜åº¦æœ‰æ•ˆçš„ï¼Œå¦‚å®¢æˆ·æœºæˆ–è¾¹ç¼˜ CPUã€‚å¦‚ä¸Šæ–‡æ‰€è¿°ï¼ŒæŠŠ Token Merging æ–¹æ³•å’Œé‡åŒ–æ–¹æ³•å åŠ èƒ½å¸¦æ¥é¢å¤–çš„æŽ¨ç†å¢žç›Šã€‚

![Image 1](https://man-archives.oss-cn-hangzhou.aliyuncs.com/goofan/202307121519225.png)

PyTorch FP32ï¼ŒæŽ¨ç†æ—¶é•¿ï¼š230.5 ç§’ï¼Œå†…å­˜æ¶ˆè€—ï¼š3.44 GB

![Image 2](https://man-archives.oss-cn-hangzhou.aliyuncs.com/goofan/202307121519110.png)

OpenVINO FP32ï¼ŒæŽ¨ç†æ—¶é•¿ï¼š120 ç§’ (**1.9 å€**)ï¼Œå†…å­˜æ¶ˆè€—ï¼š3.44 GB

![Image 3](https://man-archives.oss-cn-hangzhou.aliyuncs.com/goofan/202307121519641.png)

OpenVINO 8-bitï¼ŒæŽ¨ç†å¸‚åœºï¼š59 ç§’ (**3.9 å€**)ï¼Œå†…å­˜æ¶ˆè€—ï¼š0.86 GB(**0.25 å€**)

![Image 4](https://man-archives.oss-cn-hangzhou.aliyuncs.com/goofan/202307121520495.png)

ToMe + OpenVINO 8-bit, æŽ¨ç†é€Ÿåº¦ï¼š44.6 ç§’ (**5.1 å€**)ï¼Œå†…å­˜æ¶ˆè€—ï¼š0.86 GB (**0.25 å€**)

ç”¨ä¸åŒæ¨¡åž‹ä¼˜åŒ–æ–¹æ³•çš„å›¾ç‰‡ç”Ÿæˆçš„ç»“æžœ [å±•ç¤º](https://huggingface.co/spaces/AlexKoff88/stable_diffusion)ã€‚è¾“å…¥æç¤ºè¯ä¸º â€œcartoon birdâ€ï¼Œéšæœºç§å­ä¸º 42ã€‚æ¨¡åž‹ç”¨ OpenVINO 2022.3ï¼Œæ¥è‡ª [Hugging Face Space](https://huggingface.co/docs/hub/spaces-overview)ï¼Œç”¨â€œCPU å‡çº§â€çš„å®žä¾‹: ç¬¬ä¸‰ä»£ IntelÂ® XeonÂ® Scalable Processorsï¼Œå’Œ IntelÂ® æ·±åº¦å­¦ä¹ åŠ é€ŸæŠ€æœ¯ã€‚

ç»“æžœ
--

æˆ‘ä»¬ç”¨ä¼˜åŒ–æ¨¡åž‹ä¸å®Œæ•´çš„æµç¨‹ä»¥å¾—åˆ°ä¸¤ç§æ¨¡åž‹: åŸºäºŽ 8-bit é‡åŒ–çš„å’ŒåŸºäºŽ Token Merging é‡åŒ–çš„ï¼Œå¹¶å’Œ PyTorch ä½œä¸ºåŸºå‡†æ¯”è¾ƒã€‚æˆ‘ä»¬ä¹ŸæŠŠåŸºå‡†å…ˆè½¬åŒ–æˆ vanilla OpenVINO (FP32) çš„æ¨¡åž‹ï¼Œä»¥ç”¨ä»¥åˆ†æžæ€§æ¯”è¾ƒã€‚

ä¸Šé¢çš„ç»“æžœå›¾å±•ç¤ºäº†å›¾åƒç”Ÿæˆå’Œéƒ¨åˆ†æ¨¡åž‹çš„ç‰¹æ€§ã€‚å¦‚ä½ æ‰€è§ï¼Œä»…è½¬åŒ–æˆ OpenVINO å°±å¸¦æ¥å¤§çš„æŽ¨ç†é€Ÿåº¦æé«˜ ( **1.9** å€)ã€‚ç”¨åŸºäºŽ 8-bit çš„é‡åŒ–åŠ é€Ÿå’Œ PyTorch ç›¸æ¯”å¸¦æ¥äº† **3.9** å€çš„æŽ¨ç†é€Ÿåº¦ã€‚é‡åŒ–çš„å¦å¤–ä¸€ä¸ªé‡è¦æé«˜åœ¨äºŽå†…å­˜æ¶ˆè€—å‡å°‘ï¼Œ0.25 å€ä¹‹äºŽ PyTorchï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†åŠ è½½é€Ÿåº¦ã€‚åœ¨é‡åŒ–ä¹‹ä¸Šåº”ç”¨ Token Merging (ToME) (**èžåˆæ¯”ä¸º 0.4**) å¸¦æ¥äº† **5.1 å€** çš„æé€Ÿï¼ŒåŒæ—¶æŠŠæ¨¡åž‹å†…å­˜æ¶ˆè€—ä¿æŒåœ¨åŽŸæ°´å¹³ä¸Šã€‚æˆ‘ä»¬ä¸æä¾›è¾“å‡ºç»“æžœä¸Šçš„è´¨é‡æ”¹å˜ï¼Œä½†å¦‚ä½ æ‰€è§ï¼Œç»“æžœè¿˜æ˜¯æœ‰è´¨é‡çš„ã€‚

ä¸‹é¢æˆ‘ä»¬å±•ç¤ºå°†æœ€ç»ˆä¼˜åŒ–ç»“æžœéƒ¨ç½²åœ¨ Intel CPU ä¸Šä»£ç ã€‚

    from optimum.intel.openvino import OVStableDiffusionPipeline
    
    # Load and compile the pipeline for performance.
    name = "OpenVINO/stable-diffusion-pokemons-tome-quantized-aggressive"
    pipe = OVStableDiffusionPipeline.from_pretrained(name, compile=False)
    pipe.reshape(batch_size=1, height=512, width=512, num_images_per_prompt=1)
    pipe.compile()
    
    # Generate an image.
    prompt = "a drawing of a green pokemon with red eyes"
    output = pipe(prompt, num_inference_steps=50, output_type="pil").images[0]
    output.save("image.png")
    
    

åœ¨ Hugging Face [Optimum Intel](https://huggingface.co/docs/optimum/main/en/intel/index) åº“ä¸­ä½ å¯ä»¥æ‰¾åˆ°è®­ç»ƒå’Œé‡åŒ– [ä»£ç ](https://github.com/huggingface/optimum-intel/tree/main/examples/openvino/stable-diffusion)ã€‚æ¯”è¾ƒä¼˜åŒ–è¿‡çš„å’ŒåŽŸæ¨¡åž‹çš„ notebook ä»£ç åœ¨ [è¿™é‡Œ](https://github.com/huggingface/optimum-intel/blob/main/notebooks/openvino/stable_diffusion_optimization.ipynb)ã€‚ä½ å¯ä»¥åœ¨ Hugging Face Hub ä¸Šæ‰¾åˆ° [OpenVINO](https://huggingface.co/OpenVINO) ä¸‹çš„ [è®¸å¤šæ¨¡åž‹](https://huggingface.co/models?library=openvino&sort=downloads)ã€‚å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ Hugging Face Spaces ä¸Šå»ºäº†ä¸€ä¸ª [demo](https://huggingface.co/spaces/AlexKoff88/stable_diffusion)ï¼Œä»¥è¿è¡Œ \[å¸¦ç¬¬ä¸‰ä»£ Intel Xeon Scalable çš„ r6id.2xlarge å®žä¾‹\]ã€‚

ä¸€èˆ¬çš„ Stable Diffusion æ¨¡åž‹å‘¢ï¼Ÿ
-------------------------

æ­£å¦‚æˆ‘ä»¬åœ¨å®å¯æ¢¦å›¾åƒç”Ÿæˆä»»åŠ¡ä¸­å±•çŽ°çš„ä¸€æ ·ï¼Œä»…ç”¨å°é‡çš„è®­ç»ƒèµ„æºï¼Œå¯¹ Stable Diffusion ç®¡çº¿å®žçŽ°é«˜å±‚æ¬¡çš„ä¼˜åŒ–æ˜¯å¯èƒ½çš„ã€‚åŒæ—¶ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œè®­ç»ƒä¸€èˆ¬çš„ Stable Diffusion æ¨¡åž‹æ˜¯ä¸€ä¸ª [æ˜‚è´µçš„ä»»åŠ¡](https://www.mosaicml.com/blog/training-stable-diffusion-from-scratch-part-2)ã€‚ä½†æ˜¯ï¼Œæœ‰å……è¶³çš„èµ„é‡‘å’Œç¡¬ä»¶èµ„æºï¼Œç”¨ä¸Šè¿°æ–¹æ³•ä¼˜åŒ–ä¸€èˆ¬çš„æ¨¡åž‹ç”Ÿæˆé«˜åˆ†è¾¨çŽ‡çš„æ¨¡åž‹æ˜¯å¯èƒ½çš„ã€‚æˆ‘ä»¬å”¯ä¸€çš„è­¦å‘Šæ˜¯å…³äºŽ Token Merging æ–¹æ³•ï¼Œå…¶ä¼šå‡å¼±æ¨¡åž‹å®¹å¿æ€§ã€‚è¿™é‡Œè¡¡é‡æ ‡å‡†æ˜¯ï¼Œè®­ç»ƒæ•°æ®è¶Šå¤æ‚ï¼Œä¼˜åŒ–æ¨¡åž‹æ—¶çš„èžåˆæ¯”å°±è¯¥è¶Šå°ã€‚

å¦‚æžœä½ ä¹äºŽè¯»æœ¬åšå®¢ï¼Œé‚£ä½ å¯èƒ½å¯¹å¦å¤–ä¸€ç¯‡ [åšå®¢](https://huggingface.co/blog/zh/stable-diffusion-inference-intel) æ„Ÿå…´è¶£ï¼Œå®ƒè®¨è®ºäº†åœ¨ç¬¬å››ä»£ Intel Xeon CPU ä¸Šå…¶ä»–äº’è¡¥çš„ Stable Diffusion æ¨¡åž‹ä¼˜åŒ–æ–¹æ³•ã€‚

* * *

> è‹±æ–‡åŽŸæ–‡: [https://hf.co/blog/train-optimize-sd-intel](https://hf.co/blog/train-optimize-sd-intel)
> 
> ä½œè€…: Alexander, Yury Gorbachev, Helena, Sayak Paul, Ella Charlaix
> 
> è¯‘è€…: Vermillion
> 
> å®¡æ ¡/æŽ’ç‰ˆ: zhongdongy (é˜¿ä¸œ)